/*
  filename: angular.integralui.min.js
  version : 2.2.0
  Copyright © 2014-2015 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui",[]).directive("iuiFocus",["$timeout","IntegralUIInternalService",function(e,d){return{restrict:"A",link:function(b,a,g){var c={active:!1};b.$watch(g.iuiFocus,function(a,b){a!=b&&h(a)},!0);var h=function(a){c=a?{active:d.isFieldAvailable(a.active,!1)}:{active:!1};p()},p=function(){if(c&&0!=c.active)var f=e(function(){a[0].focus();e.cancel(f)},1)};h(b.$eval(g.iuiFocus))}}}]).directive("iuiResize",["$window","$timeout","$interval","IntegralUIInternalService",function(e,d,b,a){return{restrict:"A",link:function(g,c,h,p){var f=c.parent(),m=angular.element(e),l=getComputedStyle(c[0]).opacity,l=l&&""!=l?l:1;c.css("opacity","0");var q=f[0].offsetWidth,n=f[0].offsetHeight,r=parseInt(getComputedStyle(c[0]).height,10),x=parseInt(getComputedStyle(c[0]).width,10),k=g.$eval(h.iuiResize),v=void 0!=k.delay?k.delay:100,t=function(){if(k=g.$eval(h.iuiResize)){var b=a.isFieldAvailable(k.ref,"window"),l=x,q=r,e=parseInt(a.isFieldAvailable(k.minWidth,0),10),n=parseInt(a.isFieldAvailable(k.minHeight,0),10),p=parseInt(a.isFieldAvailable(k.maxWidth,9999999),10),t=parseInt(a.isFieldAvailable(k.maxHeight,9999999),10);switch(b){case "parent":var u=a.getPadding(f[0]),b=f[0].clientWidth-(u.left+u.right),u=f[0].clientHeight-(u.top+u.bottom);f&&(k.width&&(l=Math.floor(k.width*b)),k.height&&(q=Math.floor(k.height*u)));break;case "page":k.width&&(l=Math.floor(k.width*m[0].innerWidth));k.height&&(q=Math.floor(k.height*m[0].innerHeight));break;default:k.width&&(l=Math.floor(k.width*m[0].outerWidth)),k.height&&(q=Math.floor(k.height*m[0].outerHeight))}l<e&&(l=e);l>p&&(l=p);q<n&&(q=n);q>t&&(q=t);c.css("width",l+"px");c.css("height",q+"px");var v=d(function(){g.$apply();d.cancel(v)},1)}},y=d(function(){t();if(0==v)c.css("opacity",l);else var a=l/3,f=b(function(){a>l?(c.css("opacity",l),b.cancel(f)):(c.css("opacity",a/l),a+=l/3)},10);d.cancel(y)},v),w=b(function(){k=g.$eval(h.iuiResize);if("parent"==a.isFieldAvailable(k.ref,"window")&&f[0].offsetWidth!=q||f[0].offsetHeight!=n)t(),q=f[0].offsetWidth,n=f[0].offsetHeight},v);g.$watch(h.iuiResize,function(a,f){a!=f&&t()},!0);m.bind("resize",function(f){k=g.$eval(h.iuiResize);"parent"!=a.isFieldAvailable(k.ref,"window")&&t()});g.$on("destroy",function(a){w&&b.cancel(w);m&&m.unbind("resize")})}}}]).directive("iuiClass",function(){return{restrict:"A",link:function(e,d,b){b.$observe("iuiClass",function(a,b){a!=b&&(d.removeAttr("class"),""!=a&&d.addClass(a))})}}}).directive("iuiStyle",function(){return{restrict:"A",link:function(e,d,b){b.$observe("iuiStyle",function(a,b){if(a!=b)for(var c=a.split(";"),h=0;h<c.length;h++){var e=c[h].split(":");2==e.length&&d.css(e[0],e[1])}})}}}).directive("iuiShow",function(){return{restrict:"A",link:function(e,d,b){b.$observe("iuiShow",function(a,g){a!=g&&("false"!=a?"true"==b.showDefault?d.css("display","inline"):d.css("display","block"):d.css("display","none"))})}}}).factory("IntegralUIPublicService",function(){var e=null;return{clearTempData:function(){e=null},getTempData:function(){return e},setTempData:function(d){e=d}}}).factory("IntegralUIDataService",function(){return function(e){if(!e)return null;var d=e,b="id",a="pid",g="items",c="text";this.updateDataFields=function(f){f&&(b=f.id?f.id:"id",a=f.pid?f.pid:"pid",g=f.objects?f.objects:"items",c=f.text?f.text:"text")};this.updateDataFields(d.fields);this.update=function(a){a&&(d=a,this.updateDataFields(d.fields))};var h=angular.isDefined(d.objects);this.clear=function(a,b){var c=this.getList(a);0<c.length&&d.events&&d.events.clear({e:{parent:a}});c.length=0;b&&b(a)};this.insertAt=function(a,b,c,g){this.insert(a,b,c,null,!1,g)};this.insert=function(f,m,c,g,e,r){h&&!1!==(d.events?d.events.objAdding({e:{obj:f}}):!0)&&f&&(f[a]=c?c[b]:"",c=this.getList(c),0>m||null===m||void 0===m?c.push(f):(m=Math.max(Math.min(m,c.length),0),c.splice(m,0,f)),f[b]||(f[b]=this.getUniqueId()),d.events&&d.events.objAdded({e:{obj:f}}),r&&r())};this.insertByRef=function(a,b,c,g){if(h&&a&&b){var d=this.getParent(b),e=this.getList(d),e=this.getIndexOf(b,e);c&&(e+=1);this.insert(a,e,d,b,c,g);return e}};this.removeAt=function(f,b,c,g){if(h){var e=null;f&&(c=this.getParent(f),e=this.getList(c),b=this.getIndexOf(f,e));if(null===b||void 0===b)return!1;e=this.getList(c);if(0<=b&&b<e.length&&(f=e[b],!1!==(d.events?d.events.objRemoving({e:{obj:f}}):!0)))return f[a]="",e.splice(b,1),d.events&&d.events.objRemoved({e:{obj:f}}),g&&g(f,e,b,c),!0}return!1};this.isIndexinRange=function(a){return h&&0<=a&&a<d.objects.length?!0:!1};this.moveObject=function(a,b){h&&this.isIndexinRange(a)&&this.isIndexinRange(b)&&d.objects.splice(b,0,d.objects.splice(a,1)[0])};this.getNewIndex=function(a,b,c){if(h&&a&&b)return a=this.getParent(b),a=this.getList(a),b=this.getIndexOf(b,a),c&&(b+=1),b};this.getObjectByIndex=function(a){return h&&this.isIndexinRange(a)?d.objects[a]:null};this.findObjectById=function(a){return a?p(d.objects,a):null};this.findObjectByText=function(a){return a?p(d.objects,a,"text"):null};var p=function(a,d,e){var h=null;if(a&&d)for(var n=0,r=!1;!h&&n<a.length;){switch(e){case "text":a[n][c]&&(r=a[n][c].toString()===d.toString());break;default:a[n][b]&&(r=a[n][b].toString()===d.toString())}h=r?a[n]:p(a[n][g],d,e);n++}return h};this.getIndexOf=function(a,c){var g=-1;c||(c=this.getList());if(a&&c)for(var d=0;d<c.length;d++)if(c[d][b]&&a[b]&&c[d][b].toString()===a[b].toString()){g=d;break}return g};this.getList=function(a){return a?(a[g]||(a[g]=[]),a[g]):d.objects};this.findParent=function(c,d){var e=null;if(c&&d)for(var h=0;!e&&h<d.length;)e=d[h][b]&&c[a]&&d[h][b].toString()===c[a].toString()?d[h]:this.findParent(c,d[h][g]),h++;return e};this.getParent=function(a){return a?this.findParent(a,d.objects):null};this.getUniqueId=function(a){function b(){return(65536*(1+Math.random())|0).toString(16).substring(1)}a=a||"-";return b()+b()+a+b()+a+b()+a+b()+a+b()+b()+b()}}}).factory("IntegralUIDragDrop",function(){var e={dropPos:-1,source:null,sourceCtrl:null,sourceCollection:null,sourceIndex:-1,target:null,type:""},d=function(b,a,d){return b>=d.left&&b<=d.right&&a>=d.top&&a<=d.bottom?!0:!1};return{clearData:function(){e={dropPos:-1,source:null,sourceCtrl:null,sourceCollection:null,sourceIndex:-1,target:null,type:""}},getData:function(){return e},setData:function(b){b&&(isNaN(b.dropPos)||(e.dropPos=b.dropPos),b.source&&(e.source=b.source),b.sourceCtrl&&(e.sourceCtrl=b.sourceCtrl),b.sourceCollection&&(e.sourceCollection=b.sourceCollection),isNaN(b.sourceIndex)||(e.sourceIndex=b.sourceIndex),b.target&&(e.target=b.target),b.type&&(e.type=b.type))},hitTest:function(b,a,g){return d(b,a,g)},getDropPos:function(b,a,g,c){if(g)a:{g={left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height};if("horizontal"===c){g.right=a.x+a.width/2;if(d(b.x,b.y,g)){b=1;break a}g.left=g.right;g.right=a.x+a.width}else{g.bottom=a.y+a.height/2;if(d(b.x,b.y,g)){b=1;break a}g.top=g.bottom;g.bottom=a.y+a.height}b=d(b.x,b.y,g)?2:-1}else"horizontal"===c?(c={left:a.x+a.width/4,top:a.y,right:a.x+3*a.width/4,bottom:a.y+a.height},d(b.x,b.y,c)?b=0:(c.right=c.left,c.left=a.x,d(b.x,b.y,c)?b=1:(c.left=a.x+3*a.width/4,c.right=a.x+a.width,b=d(b.x,b.y,c)?2:-1))):(c={left:a.x,top:a.y+a.height/4,right:a.x+a.width,bottom:a.y+3*a.height/4},d(b.x,b.y,c)?b=0:(c.bottom=c.top,c.top=a.y,d(b.x,b.y,c)?b=1:(c.top=a.y+3*a.height/4,c.bottom=a.y+a.height,b=d(b.x,b.y,c)?2:-1)));return b}}}).factory("IntegralUIInternalService",["$rootScope","$window",function(e,d){var b=null;return{getCtrl:function(a){e.$broadcast(a+"-get-ctrl");a=this.getTempData();this.clearTempData();return a?a:null},getUniqueId:function(a,b){function c(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var d=b||"-",d=c()+c()+d+c()+d+c()+d+c()+d+c()+c()+c();a&&(d=d.substring(0,a));return d},isBoolean:function(a){return a?"boolean"==typeof a:!1},isEnabled:function(a){return a||void 0===a?!0:!1},isEqual:function(a,b){return a&&b?a.toString()===b.toString():!1},isFieldAvailable:function(a,b){return void 0!=a?a:b},isImage:function(a){return a?a instanceof HTMLImageElement:!1},isNumber:function(a){return a?"number"==typeof a:!1},isObject:function(a){return a?"object"==typeof a&&null!=a&&!Array.isArray(a):!1},isPercent:function(a){return a&&(a=a.toString(),"%"==a.substring(a.length-1))?!0:!1},isSelected:function(a){return a&&a.selected?!0:!1},isString:function(a){return a?"string"==typeof a||a instanceof String:!1},clearTempData:function(){b=null},getTempData:function(){return b},setTempData:function(a){b=a},getBodyElem:function(a){for(var b=null;a;){if(a===document.getElementsByTagName("body")[0]){b=a;break}a=a.offsetParent}return b},checkHit:function(a,b,c){return a>=c.left&&a<=c.right&&b>=c.top&&b<=c.bottom?!0:!1},getMargin:function(a){return a?{top:parseInt(getComputedStyle(a)["margin-top"],10),right:parseInt(getComputedStyle(a)["margin-right"],10),bottom:parseInt(getComputedStyle(a)["margin-bottom"],10),left:parseInt(getComputedStyle(a)["margin-left"],10)}:{top:0,right:0,bottom:0,left:0}},getPadding:function(a){return a?{top:parseInt(getComputedStyle(a)["padding-top"],10),right:parseInt(getComputedStyle(a)["padding-right"],10),bottom:parseInt(getComputedStyle(a)["padding-bottom"],10),left:parseInt(getComputedStyle(a)["padding-left"],10)}:{top:0,right:0,bottom:0,left:0}},getMousePos:function(a){return{x:a.pageX?a.pageX:a.originalEvent?a.originalEvent.pageX:0,y:a.pageY?a.pageY:a.originalEvent?a.originalEvent.pageY:0}},getClientMousePos:function(a,b){if(a&&b){b=angular.element(b);var c=b[0].getBoundingClientRect(),e=angular.element(d)[0].pageXOffset,p=angular.element(d)[0].pageYOffset,f=this.getMousePos(a);f.x-=c.left+e;f.y-=c.top+p;return f}return{x:0,y:0}},getPageRect:function(a){if(a){a=angular.element(a);a=a[0].getBoundingClientRect();var b=angular.element(d)[0].pageXOffset,c=angular.element(d)[0].pageYOffset;a.left-=b;a.top-=c;a.right=a.left+a.width;a.bottom=a.top+a.height;return a}return{left:0,top:0,right:0,bottom:0}}}}]);