/*
  filename: jquery.integralui.menu.min.js
  version : 1.0.038
  Copyright © 2014 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
(function(f){f.widget("integralui.menu",f.integralui.widget,{version:"1.0.37",options:{alignment:"left",animationSpeed:400,dataFields:{content:"content",dataSource:null,icon:"icon",id:"id",link:"link",pid:"pid",text:"text",type:"type"},openOnHover:!1,rtl:!1,showIcons:!0},_create:function(){this._super();this.widgetName="menu";this.classNames={widget:"iui-menu",item:{active:"iui-menu-item-active",normal:"iui-menu-item-normal",hovered:"iui-menu-item-hovered"},marker:{top:"iui-menu-marker-top",left:"iui-menu-marker-left",bottom:"iui-menu-marker-bottom",right:"iui-menu-marker-right",expand:{down:"iui-menu-marker-expand-down",right:"iui-menu-marker-expand-right",up:"iui-menu-marker-expand-up:",left:"iui-menu-marker-expand-left"}},root:{normal:"iui-menu-item-root",hovered:"iui-menu-item-root-hovered"},separator:"iui-menuitem-separator"};this.element.addClass("iui-menu");this.activeMenus=[];this.isMenuActive=this.options.openOnHover;this.activeRootIndex=this.activeIndex=this.hoverIndex=this.prevHoverIndex=-1;this._initFromHTML()||(this.$root=f("<ul></ul>"),this.element.append(this.$root),this.suspendLayout(),this.options.dataFields&&this.loadData(this.options.dataFields.dataSource),this.resumeLayout());var a=this;a.element.off("mouseenter mouseleave").on({mouseenter:function(a){},mouseleave:function(b){a.prevHoverIndex=-1;a.hoverIndex=-1;a.isMenuActive&&!a.options.openOnHover||a._closeMenus(!1);a.options.openOnHover?a.$root.find("li").each(function(b){var d=f(this);d.removeClass(a.classNames.root.hovered+" "+a.classNames.item.active+" "+a.classNames.item.hovered);a._isIndexInRange(b)&&d.find("ul > li").length&&(a.options.rtl?0===a.currentList[b].level?d.addClass(a.classNames.marker.expand.down+"-rtl"):d.addClass(a.classNames.marker.expand.left):0===a.currentList[b].level?d.addClass(a.classNames.marker.expand.down):d.addClass(a.classNames.marker.expand.right))}):a.isMenuActive?a._updateActiveMenu(a.currentList[a.activeRootIndex]):a.$root.find("li").removeClass(a.classNames.root.hovered+" "+a.classNames.item.active+" "+a.classNames.item.hovered)}});f("body").bind("click",function(b){0==f(b.target).closest("iui-menu").length&&(a.isMenuActive=a.options.openOnHover,a._closeMenus(!1),a.$root.find("li > ul").hide(),a.$root.find("li").each(function(b){var d=f(this);d.removeClass(a.classNames.root.hovered+" "+a.classNames.item.active+" "+a.classNames.item.hovered);a._isIndexInRange(b)&&d.find("ul > li").length&&(a.options.rtl?0===a.currentList[b].level?d.addClass(a.classNames.marker.expand.down+"-rtl"):d.addClass(a.classNames.marker.expand.left):0===a.currentList[b].level?d.addClass(a.classNames.marker.expand.down):d.addClass(a.classNames.marker.expand.right))}))});this.element.append(this.$tw);this._s1t(this.twp)},_destroy:function(){var a=this.$root.find("li");0<a.length&&a.removeUniqueId();this.element.empty();this._super()},_initFromHTML:function(){this.$root=this.element.children("ul");if(0<this.$root.length){this.allowUpdate=!1;var a=this.$root.children("li");this._initRecur(a,null,0);this.allowUpdate=!0;this.refresh();return!0}return!1},_initRecur:function(a,b,c){var d=this;a.each(function(a,k){var h=d._extractItem(k,b,c);d.addItem(h,b);var g=f(k).children("ul").children("li");d._initRecur(g,h,c+1)})},_extractItem:function(a,b,c){a=f(a);var d="",e="",k="",h="text",g=null;0===c?a.addClass(this.classNames.root.normal):a.addClass(this.classNames.item.normal);a.children("ul > li").length&&(this.options.rtl?0===c?a.addClass(this.classNames.marker.expand.down+"-rtl"):a.addClass(this.classNames.marker.expand.left):0===c?a.addClass(this.classNames.marker.expand.down):a.addClass(this.classNames.marker.expand.right));a.attr("id")||a.uniqueId();this.options.showIcons&&(g=a.children("[data-element='icon']"),0<g.length&&(e=this._outerHtml(g)));g=a.children("[data-element='separator']");0<g.length?(d=this._outerHtml(g),h="separator"):(g=a.children("[data-element='content']"),0<g.length?(d=this._outerHtml(g),k=g.children("a").attr("href"),g.text(),h="content"):(g=a.children("a:last-of-type"),0<g.length?(k=g.attr("href"),g.text(),h="hyperlink"):(g=a.children("span:last-of-type"),0<g.length&&"icon"!==g.attr("data-element")&&g.text())));return{content:d,icon:e,id:a.attr("id"),level:c,link:k,pid:null!==b?b.id:"",text:g.text(),type:h}},_setOption:function(a,b){switch(a){case "alignment":this.options.alignment!==b&&(this.options.alignment="center"===b||"right"===b?b:"left",this.refresh());break;case "openOnHover":if(!0!==b&&!1!==b)return;this.isMenuActive=this.options.openOnHover=b;this.refresh();break;case "rtl":if(!0!==b&&!1!==b)return;this.options.rtl=b;this.refresh();break;case "showIcons":if(!0!==b&&!1!==b)return;this.options.showIcons=b;this.refresh()}this._super(a,b)},_click:function(a,b,c){a.preventDefault();this._isIndexInRange(c)&&((c=this.currentList[c])&&1===a.which&&this._triggerEvent("itemclick",c,{x:a.pageX,y:a.pageY}),this.options.openOnHover||((this.isMenuActive=!this.isMenuActive)?this._updateActiveMenu(c):(this.$root.find("li > ul").hide(),this.isMenuActive||0!==c.level||(this.options.rtl?f(b).removeClass(this.classNames.item.active).addClass(this.classNames.marker.expand.down+"-rtl"):f(b).removeClass(this.classNames.item.active).addClass(this.classNames.marker.expand.down)))));a.stopPropagation()},_mouseEnter:function(a,b,c){a.preventDefault();this._isIndexInRange(c)&&(this.hoverIndex=c,0===this.currentList[c].level&&(this.$root.find("li:eq("+this.activeRootIndex+")").removeClass(this.classNames.root.hovered+" "+this.classNames.item.active),this.activeRootIndex=c),this.hoverIndex!==this.prevHoverIndex&&(this.prevHoverIndex=this.hoverIndex,"separator"!==this.currentList[c].type&&(this._getParent(this.currentList[c])?f(b).addClass(this.classNames.item.hovered):f(b).addClass(this.classNames.root.hovered)),this._triggerEvent("itemhover",this.currentList[c]),this.isMenuActive&&this._updateActiveMenu(this.currentList[c])));a.stopPropagation()},_mouseLeave:function(a,b,c){a.preventDefault();this._isIndexInRange(c)&&(0===this.currentList[c].level?f(b).find("ul > li").length&&(this.options.rtl?f(b).addClass(this.classNames.marker.expand.down+"-rtl"):f(b).addClass(this.classNames.marker.expand.down)):(f(b).removeClass(this.classNames.item.hovered),f(b).find("ul > li").length&&(this.options.rtl?f(b).addClass(this.classNames.marker.expand.left):f(b).addClass(this.classNames.marker.expand.right))));this.isMenuActive&&!this.options.openOnHover||f(b).children("ul").hide()},_rebindEvents:function(){var a=this;a.$root.find("li").each(function(b){f(this).off("click mouseenter mouseleave").on({click:function(c){a._click(c,this,b)},mouseenter:function(c){a._mouseEnter(c,this,b)},mouseleave:function(c){a._mouseLeave(c,this,b)}})})},addItem:function(a,b){this._add(a,b)},clearItems:function(a){this._clear(a)},insertItemAfter:function(a,b){this._insertAfter(a,b)},insertItemAt:function(a,b,c){this._insertAt(a,b,c)},insertItemBefore:function(a,b){this._insertBefore(a,b)},removeItem:function(a){this._remove(a)},removeItemAt:function(a,b){this._removeAt(a,b)},loadData:function(a){var b=this,c=[];b.clearItems();a&&(a.forEach(function(a,e){var f={content:a[b.options.dataFields.content],icon:a[b.options.dataFields.icon],id:a[b.options.dataFields.id],link:a[b.options.dataFields.link],pid:a[b.options.dataFields.pid],text:a[b.options.dataFields.text],type:a[b.options.dataFields.type]},h=f.pid;if(null!==c[h]&&void 0!==c[h]){if(null===c[h].items||void 0===c[h].items)c[h].items=[];c[a.id]=f;c[h].items.push(f)}else c[a.id]=f,b.items.push(f)}),b.refresh());c.length=0},findItemById:function(a,b){return this._findItemById(a,b)},findItemByText:function(a,b){return this._findItemByText(a,b)},_getElemWidth:function(a){return this.$root.find("li:eq("+a+")").outerWidth(!0)},_getElemHeight:function(a){return this.$root.find("li:eq("+a+")").outerHeight(!0)},getItemElement:function(a){return a?this.$root.find("li[id='"+a.id+"']"):null},_checkExpandState:function(){return!0},_createElement:function(a,b){var c=this;a.level=b;a.opened=!1;if(null===a.id||void 0===a.id){var d=f("<li></li>");d.uniqueId();a.id=d.attr("id");d.remove()}d=this.classNames.item.normal;0===b&&(d=this.classNames.root.normal);var e="<li id="+a.id;a.pid&&(e+=" pid="+a.pid);e+=" class='"+d+"'>";this.options.showIcons&&a.icon&&(e+=a.icon);"separator"===a.type?e+="<hr data-element='separator' />":a.content?e+=a.content:a.link?e+="<a href='"+a.link+"'>"+a.text+"</a>":a.text&&(e+="<span>"+a.text+"</span>");a.items&&0<a.items.length&&(e+="<ul>",a.items.forEach(function(a,d){e+=c._createElement(a,b+1)}),e+="</ul>");return e+="</li>"},refresh:function(){this._super();var a=this;if(a._isUpdateAllowed()){a.$root.empty();var b=[];a.getList().forEach(function(c,d){b.push(a._createElement(c,0))});a.$root.append(b);b.length=0;a.element.append(a.$tw);a._updateWholeLayout()}},_updateWholeLayout:function(){var a=this;a._isUpdateAllowed()&&(a._updateCurrentList(),a.$root.css("text-align",a.options.alignment),a.options.rtl?a.element.css({direction:"rtl"}):a.element.css({direction:"ltr"}),a.$root.find("li > ul").hide(),a.$root.find("li").each(function(b){var c=f(this);a.options.rtl?c.css({"text-align":"right"}):c.css({"text-align":"left"});var d=a._getPaddingValue(c);c.find("ul > li").length&&(a.options.rtl?(d.left=16,c.attr("pid")?c.addClass(a.classNames.marker.expand.left):c.addClass(a.classNames.marker.expand.down+"-rtl")):(d.right=16,c.attr("pid")?c.addClass(a.classNames.marker.expand.right):c.addClass(a.classNames.marker.expand.down)));var e=0;a.options.showIcons&&a.currentList[b].icon&&(e=2);if(a.currentList[b].content||a.currentList[b].text)$childElem=c.children("[data-element='content']"),0===$childElem.length&&($childElem=c.children("a:last-of-type")),0===$childElem.length&&($childElem=c.children("span:last-of-type")),0<$childElem.length&&$childElem.css({"padding-left":function(){return a.options.rtl?d.left+"px":d.left+e+"px"},"padding-right":function(){return a.options.rtl?d.right+e+"px":d.right+"px"}})}),a._rebindEvents())},_adjustElemVertical:function(a,b){var c=f(b).outerHeight(),d=a.height();return d<c?((c-d)/2).toString()+"px":"0"},_getElemBlockPosition:function(a){var b=0;if(a){var c=this.$root.find("li:eq("+f.inArray(a,this.currentList)+")");c&&(b+=c.parent().outerWidth());for(a=this._getParent(a);null!=a;)0<a.level&&(c=this.$root.find("li:eq("+f.inArray(a,this.currentList)+")"))&&(b+=c.parent().outerWidth()),a=this._getParent(a)}return b},_closeMenus:function(a){for(var b=null,c=!1,d=this.currentList.length-1;0<=d;d--)if(b=this.currentList[d],c=a?0>f.inArray(b,this.activeMenus):0<=f.inArray(b,this.activeMenus))c=!0,b.opened&&b.items&&0<b.items.length&&(c=this._triggerEvent("close",b)),b.opened=!1,!1!==c&&(b=this.getItemElement(b),0<b.length&&b.children("ul").stop().fadeOut().hide())},_updateActiveMenu:function(a){var b=this;if(b.isMenuActive&&a){b.activeMenus.length=0;b.activeMenus.push(a);b.activeIndex=f.inArray(a,b.currentList);for(a=b._getParent(a);null!=a;)b.activeMenus.push(a),b.activeIndex=f.inArray(a,b.currentList),a=b._getParent(a);b._closeMenus(!0);b.activeMenus.forEach(function(a){var d=f.inArray(a,b.currentList);a=b.currentList[d];var e=b.$root.find("li:eq("+d+")"),d=0,k="auto",h="auto";switch(a.level){case 0:a.items&&e.addClass(b.classNames.item.active);d=e.position().top-b._getNumValueFromCSS(e.parent(),"padding-bottom")+e.innerHeight();b.options.rtl?(k=-1,e.children("ul").addClass(b.classNames.marker.top+"-rtl"),e.removeClass(b.classNames.marker.expand.down+"-rtl")):(h=-1,e.children("ul").addClass(b.classNames.marker.top),e.removeClass(b.classNames.marker.expand.down));break;default:d-=b._getNumValueFromCSS(e.parent(),"padding-top"),b.options.rtl?(k=e.parent().outerWidth()-8,e.children("ul").addClass(b.classNames.marker.right),e.removeClass(b.classNames.marker.expand.left)):(h=e.parent().outerWidth()-8,e.children("ul").addClass(b.classNames.marker.left),e.removeClass(b.classNames.marker.expand.right))}e=e.children("ul");e.css({top:d,right:k,left:h,"z-index":990+a.level});d=!0;0<e.length&&!a.opened&&(a.opened=!0,d=b._triggerEvent("open",a));!1!==d&&(b.options.allowAnimation?e.stop().fadeIn(b.options.animationSpeed):e.show())})}}})})(jQuery);