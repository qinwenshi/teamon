/*
  filename: angular.integralui.checkbox.min.js
  version : 1.2.0
  Copyright © 2014-2015 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUICheckBoxService",["$rootScope","IntegralUIPublicService",function(c,m){return{refresh:function(d){c.$broadcast(d+"-refresh")},resumeLayout:function(d){c.$broadcast(d+"-resume-layout")},suspendLayout:function(d){c.$broadcast(d+"-suspend-layout")},updateLayout:function(d){c.$broadcast(d+"-update-layout")}}}]).controller("IntegralUICheckBoxController",["$scope","$element","IntegralUIInternalService",function(c,m,d){var b=this;b.defaultStyle={general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"},content:{general:"iui-checkbox-content",disabled:"iui-checkbox-content-disabled"}};b.options={};this.updateOptions=function(a){a?(b.options={autoCheck:d.isFieldAvailable(a.autoCheck,!0),checked:d.isFieldAvailable(a.checked,!1),checkState:d.isFieldAvailable(a.checkState,"unchecked"),controlStyle:b.defaultStyle,enabled:d.isFieldAvailable(a.enabled,!0),rtl:d.isFieldAvailable(a.rtl,!1),text:d.isFieldAvailable(a.text,""),threeState:d.isFieldAvailable(a.threeState,!1)},b.updateControlStyle(a.controlStyle)):b.options={autoCheck:!0,checked:!1,checkState:"unchecked",controlStyle:b.defaultStyle,enabled:!0,rtl:!1,text:"",threeState:!1}};b.updateOptions();this.getCheckValue=function(a){return"checked"==a?"checked":1==b.options.threeState&&"indeterminate"==a?"indeterminate":"unchecked"};this.setCheckValue=function(a){var e=!1,e=1==b.options.threeState?b.callCheckStateChanging(a):b.callCheckedChanging(a);!1!==e&&(b.options.checkState="unchecked"==a?1==b.options.threeState?"indeterminate":"checked":"indeterminate"==a?"checked":"unchecked",b.options.checked="checked"==b.options.checkState?!0:!1,angular.isDefined(c.checked)&&(c.checked=b.options.checked),angular.isDefined(c.checkState)&&(c.checkState=b.options.checkState),angular.isDefined(c.checkState)||1!=b.options.threeState?angular.isDefined(c.checked)||0!=b.options.threeState||b.callCheckedChanged(b.options.checkState):b.callCheckStateChanged(b.options.checkState))};this.callCheckedChanging=function(a){var e=!0;a=b.getCheckValue(a);e="checked"==a?!0:!1;return e=angular.isDefined(c.events)&&c.events.checkedChanging?c.events.checkedChanging({checked:e,checkState:a}):c.checkedChanging({e:{checked:e,checkState:a}})};this.callCheckedChanged=function(a){a=b.getCheckValue(a);var e="checked"==a?!0:!1;angular.isDefined(c.events)&&c.events.checkedChanged?c.events.checkedChanged({checked:e,checkState:a}):c.checkedChanged({e:{checked:e,checkState:a}})};this.callCheckStateChanging=function(a){var e=!0;a=b.getCheckValue(a);e="checked"==a?!0:!1;return e=angular.isDefined(c.events)&&c.events.checkstateChanging?c.events.checkstateChanging({checked:e,checkState:a}):c.checkstateChanging({e:{checked:e,checkState:a}})};this.callCheckStateChanged=function(a){a=b.getCheckValue(a);var e="checked"==a?!0:!1;angular.isDefined(c.events)&&c.events.checkstateChanged?c.events.checkstateChanged({checked:e,checkState:a}):c.checkstateChanged({e:{checked:e,checkState:a}})};this.callClick=function(a){a=b.getCheckValue(a);var e="checked"==a?!0:!1;angular.isDefined(c.events)&&c.events.click?c.events.click({checked:e,checkState:a}):c.click({e:{checked:e,checkState:a}})};this.callEnabledChanged=function(a){angular.isDefined(c.events)&&c.events.enabledChanged?c.events.enabledChanged({enabled:a}):c.enabledChanged({e:{enabled:a}})};this.callStyleChanged=function(a){angular.isDefined(c.events)&&c.events.styledChanged?c.events.styleChanged({style:a}):c.styleChanged({e:{style:a}})};b.allowUpdate=!0;this.suspendLayout=function(){b.allowUpdate=!1};this.resumeLayout=function(){b.allowUpdate=!0;b.updateLayout()};c.$on(c.name+"-refresh",function(a){b.refresh()});c.$on(c.name+"-resume-layout",function(a){b.resumeLayout()});c.$on(c.name+"-suspend-layout",function(a){b.suspendLayout()});c.$on(c.name+"-update-layout",function(a){b.updateLayout()});c.$watch("autoCheck",function(a,c){a!==c&&(b.options.autoCheck=a)});c.$watch("checked",function(a,c){a!==c&&(b.options.checked=0!=a?!0:!1,b.options.checkState=b.options.checked?"checked":"unchecked",b.updateCheckMark(),b.callCheckedChanged(b.options.checkState))});c.$watch("checkState",function(a,c){a!==c&&(b.options.checkState=b.getCheckValue(a),b.options.checked="unchecked"==b.options.checkState?!1:!0,b.updateCheckMark(),b.callCheckStateChanged(b.options.checkState))});c.$watch("controlStyle",function(a,c){a!==c&&(b.options.controlStyle=a,b.refresh(),b.callStyleChanged(a))});c.$watch("enabled",function(a,c){a!==c&&(b.options.enabled=a,b.refresh(),b.callEnabledChanged(a))});c.$watch("options",function(a,c){a!==c&&(b.updateOptions(a),b.updateLayout())},!0);c.$watch("rtl",function(a,c){a!==c&&(b.options.rtl=a,b.updateLayout())});c.$watch("text",function(a,c){a!==c&&(b.options.text=a)});c.$watch("threeState",function(a,c){a!==c&&(b.options.threeState=a,0==b.options.threeState&&"indeterminate"==b.options.checkState&&b.setCheckValue("checked"))});var g=function(a){return a?{general:d.isFieldAvailable(a.general,"iui-checkbox-box"),disabled:d.isFieldAvailable(a.disabled,"iui-checkbox-disabled"),checked:d.isFieldAvailable(a.checked,"iui-checkbox-checked"),indeterminate:d.isFieldAvailable(a.indeterminate,"iui-checkbox-indeterminate"),unchecked:d.isFieldAvailable(a.unchecked,"iui-checkbox-unchecked")}:b.defaultStyle.box},n=function(a){return a?{general:d.isFieldAvailable(a.general,"iui-checkbox-content"),disabled:d.isFieldAvailable(a.disabled,"iui-checkbox-content-disabled")}:b.defaultStyle.content};this.updateControlStyle=function(a){b.options.controlStyle=a?{general:d.isFieldAvailable(a.general,"iui-checkbox"),box:g(a.box),content:n(a.content)}:{general:d.isFieldAvailable(b.defaultStyle.general,"iui-checkbox"),box:g(b.defaultStyle.box),content:n(b.defaultStyle.content)}}}]).directive("iuiCheckbox",["$timeout","$interval","IntegralUIInternalService",function(c,m,d){return{restrict:"EA",controller:"IntegralUICheckBoxController",transclude:!0,replace:!0,template:'<div data-element="checkbox"><canvas></canvas><div ng-transclude></div></div>',scope:{autoCheck:"=",checked:"=",checkState:"=",controlStyle:"=",enabled:"=",name:"@",options:"=?",rtl:"=",text:"@",threeState:"=",checkedChanging:"&",checkedChanged:"&",checkstateChanging:"&",checkstateChanged:"&",click:"&",enabledChanged:"&",styleChanged:"&",events:"=?"},link:function(b,g,n,a,e){var h=this,f=g.children().eq(0),k=g.children().eq(1);b.$on("destroy",function(a){h.cb_s2t();g.unbind("click");f.unbind("click mouseup")});var q=function(){f.bind("click",function(b){0!=a.options.enabled&&(a.setCheckValue(a.options.checkState),a.callClick(a.options.checkState),a.updateLayout());b.stopPropagation()});f.bind("mouseup",function(a){a.stopPropagation()})};g.bind("click",function(b){0!=a.options.enabled&&a.options.autoCheck&&(a.setCheckValue(a.options.checkState),a.updateLayout())});a.updateCheckMark=function(){if(f){var b=getComputedStyle(f[0])["background-image"];if(b&&"none"!=b)l();else if("CANVAS"==f[0].tagName){l();getComputedStyle(f[0]);var b=getComputedStyle(f[0]).color,c=f[0].getContext("2d"),d=f[0].width,e=f[0].height;c.beginPath();c.rect(0,0,d,e);c.fillStyle="#ffffff";c.fill();"checked"==a.options.checkState?(c.lineWidth=12<e?3:1,c.strokeStyle=b,"indeterminate"==a.options.checkState&&(c.strokeStyle="#808080"),c.beginPath(),c.moveTo(3,e/2+1),c.lineTo(0+d/2,0+e-3),c.stroke(),c.beginPath(),c.moveTo(0+d/2-1,0+e-3),c.lineTo(0+d-3,3),c.stroke()):"indeterminate"==a.options.checkState&&(c.beginPath(),c.rect(4,4,d-8,e-8),c.fillStyle=b,c.fill())}}};a.updateLayout=function(){if(a.allowUpdate){f.unbind("click mouseup");a.refresh();var b=c(function(){var d="ltr";!0===a.options.rtl&&(d="rtl");g.css("direction",d);if((d=getComputedStyle(f[0])["background-image"])&&"none"!=d)f.remove(),f=angular.element("<span></span>"),g.prepend(f),l();else{f.remove();f=angular.element("<canvas></canvas>");g.prepend(f);l();var d=getComputedStyle(f[0]).width,e=getComputedStyle(f[0]).height;f[0].width=d?parseInt(d,10):14;f[0].height=e?parseInt(e,10):14;!0===a.options.rtl?(f.css("left","auto"),f.css("right",0)):(f.css("left",0),f.css("right","auto"));a.updateCheckMark()}0==k.children().length&&k.css("padding",0);q();c.cancel(b)},1)}};var l=function(){var b=a.defaultStyle.box.general+" "+a.defaultStyle.box[a.options.checkState];a.options.controlStyle&&a.options.controlStyle.box&&(a.options.controlStyle.box.general&&d.isString(a.options.controlStyle.box.general)&&(b+=" "+a.options.controlStyle.box.general),0==a.options.enabled&&a.options.controlStyle.box.disabled&&d.isString(a.options.controlStyle.box.disabled)?b+=" "+a.options.controlStyle.box.disabled:a.options.controlStyle.box[a.options.checkState]&&d.isString(a.options.controlStyle.box[a.options.checkState])&&(b+=" "+a.options.controlStyle.box[a.options.checkState]));f.removeAttr("class");f.addClass(b)};a.refresh=function(){g.removeAttr("class");g.addClass(a.defaultStyle.general);a.options.controlStyle&&d.isString(a.options.controlStyle.general)&&g.addClass(a.options.controlStyle.general);0<f.length&&l();0<k.length&&(k.removeAttr("class"),k.addClass(a.defaultStyle.content.general),a.options.controlStyle&&a.options.controlStyle.content&&d.isString(a.options.controlStyle.content.general)&&k.addClass(a.options.controlStyle.content.general),0==a.options.enabled&&a.options.controlStyle.content.disabled&&d.isString(a.options.controlStyle.content.disabled)&&k.addClass(a.options.controlStyle.content.disabled))};this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var b;b="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";b+=a[1]+a[4]+a[2]+a[0]+a[3];return b+="</div>"};this.cb_tpar=this.crpar();this.$cb_tw=angular.element(this.crtr(this.cb_tpar));this.tmp=300;this.cb_twp=200*h.tmp;this.cb_trActive=!1;this.cb_trCount=0;this.cb_trlTime=this.cb_trId=null;this.cb_trShowCount=0;this.cb_animTr=function(){this.cb_trCount++;3>this.cb_trShowCount?(this.cb_trCount=1,this.$cb_tw.css("display","block"),this.$cb_tw.css("top",g[0].scrollTop+"px"),this.$cb_tw.css("left",g[0].scrollLeft+"px"),this.cb_trShowCount++):(0===this.cb_trCount%49&&(this.cb_trShowCount=0),this.$cb_tw.css("display","none"),this.$cb_tw.css("top",g[0].scrollTop+"px"),this.$cb_tw.css("left",g[0].scrollLeft+"px"))};this.cb_s1t=function(a){this.cb_trlTime=c(function(){h.cb_trActive||(h.cb_trCount=0,h.cb_trActive=!0,h.cb_trId=m(function(){h.cb_animTr()},1E3))},a)};this.cb_s2t=function(){this.cb_trId&&(m.clear(this.cb_trId),this.cb_trId=null);this.cb_trlTime&&(c.cancel(this.cb_trlTime),this.cb_trlTime=null);this.cb_trActive=!1;this.$cb_tw.remove()};var p=!1,r=c(function(){for(var a=g.parent();a&&a[0]&&a[0]!==document.getElementsByTagName("body")[0];){if(a[0].attributes&&a[0].attributes["data-element"]&&("list"==a[0].attributes["data-element"].value||"treeview"==a[0].attributes["data-element"].value||"treegrid"==a[0].attributes["data-element"].value)){p=!0;break}a=a.parent()}p||(g.append(h.$cb_tw),h.cb_s1t(h.cb_twp));c.cancel(r)},1);angular.isDefined(b.options)?a.updateOptions(b.options):(0==b.autoCheck&&(a.options.autoCheck=b.autoCheck),1==b.checked&&(a.options.checked=b.checked,a.options.checkState="checked"),angular.isDefined(b.checkState)&&(a.options.checkState=b.checkState,a.options.checked="checked"==a.options.checkState?!0:!1),angular.isDefined(b.controlStyle)&&a.updateControlStyle(b.controlStyle),0==b.enabled&&(a.options.enabled=b.enabled),1==b.rtl&&(a.options.rtl=b.rtl),angular.isDefined(b.text)&&(a.options.text=b.text),!0===b.threeState&&(a.options.threeState=b.threeState));a.updateLayout()}}}]);