/*
  filename: angular.integralui.combobox.min.js
  version : 1.1.0
  Copyright © 2014-2015 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUIComboBoxService",["$rootScope","IntegralUIPublicService",function(b,g){return{loadData:function(e,g,d){b.$broadcast(e+"-load-data",g,d)},findItemById:function(e,g){b.$broadcast(e+"-find-item-by-id",g);var d=this.getTempData();this.clearTempData();return d?d:null},findItemByText:function(e,g){b.$broadcast(e+"-find-item-by-text",g);var d=this.getTempData();this.clearTempData();return d?d:null},getList:function(e){b.$broadcast(e+"-get-list");e=this.getTempData();this.clearTempData();return e?e:[]},clearSelection:function(e){b.$broadcast(e+"-clear-selection")},selectedItem:function(e,g){if(g)b.$broadcast(e+"-set-selected-item",g);else{b.$broadcast(e+"-get-selected-item");var d=this.getTempData();this.clearTempData();return d?d:null}},refresh:function(e,g){b.$broadcast(e+"-refresh",g)},resumeLayout:function(e){b.$broadcast(e+"-resume-layout")},suspendLayout:function(e){b.$broadcast(e+"-suspend-layout")},updateLayout:function(e){b.$broadcast(e+"-update-layout")},updateView:function(e){b.$broadcast(e+"-update-view")}}}]).controller("IntegralUIComboBoxController",["$scope","$element","IntegralUIInternalService","IntegralUIComboBoxService",function(b,g,e,A){var d=this;d.defaultStyle={general:{disabled:"iui-combobox-disabled",normal:"iui-combobox"},button:{general:{disabled:"iui-combobox-button-disabled",focused:"iui-combobox-button-focused",hovered:"iui-combobox-button-hovered",normal:"iui-combobox-button"},dropdown:{disabled:"iui-combobox-button-dropdown-disabled",focused:"iui-combobox-button-dropdown-focused",hovered:"iui-combobox-button-dropdown-hovered",normal:"iui-combobox-button-dropdown"}},content:{disabled:"iui-combobox-content-disabled",focused:"iui-combobox-content-focused",hovered:"iui-combobox-content-hovered",normal:"iui-combobox-content"}};this.updateOptions=function(a){a?(d.options={dropDownHeight:e.isFieldAvailable(a.dropDownHeight,100),dropDownWidth:e.isFieldAvailable(a.dropDownWidth,200),enabled:e.isFieldAvailable(a.enabled,!0),integralHeight:e.isFieldAvailable(a.integralHeight,!0),itemIcon:e.isFieldAvailable(a.itemIcon,""),maxDropDownItems:e.isFieldAvailable(a.maxDropDownItems,7),rtl:e.isFieldAvailable(a.rtl,!1),selectedItem:e.isFieldAvailable(a.selectedItem,d.options.selectedItem?d.options.selectedItem:null),showIcons:e.isFieldAvailable(a.showIcons,!0)},d.updateDataFields(a.dataFields),d.updateControlStyle(a.controlStyle)):(d.options={controlStyle:d.defaultStyle,dropDownHeight:100,dropDownWidth:200,enabled:!0,integralHeight:!0,itemIcon:"",maxDropDownItems:7,rtl:!1,selectedItem:null,showIcons:!0},d.updateDataFields())};d.options={};this.updateDataFields=function(a){d.options.dataFields=a?{checkBoxSettings:a.checkBoxSettings?a.checkBoxSettings:"checkBoxSettings",checked:a.checked?a.checked:"checked",checkState:a.checkState?a.checkState:"checkState",content:a.content?a.content:"content",enabled:a.enabled?a.enabled:"enabled",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",items:a.items?a.items:"items",style:a.style?a.style:"style",text:a.text?a.text:"text",value:a.value?a.value:"value"}:{checkBoxSettings:"checkBoxSettings",checked:"checked",checkState:"checkState",content:"content",enabled:"enabled",icon:"icon",id:"id",items:"items",style:"style",text:"text",value:"value"};d.dataObj&&d.dataObj.updateDataFields(d.options.dataFields)};d.updateOptions();b.$on(b.name+"-load-data",function(a,c,b){d.loadData(c,b)});this.loadData=function(a,c){d.allowEvents=!1;d.updateDataFields(c);d.dataObj.clear(null,d.listIsCleared);angular.isDefined(b.items)&&(b.items=a);d.dataObj=new $dataService({objects:b.items,events:d.dataEvents,fields:d.getDataFields(d.options.dataFields)});d.updateLayout();d.allowEvents=!0};this.callClick=function(){angular.isDefined(b.events)&&b.events.click?b.events.click():b.click()};this.callDropDownClosing=function(){var a=!0;return a=angular.isDefined(b.events)&&b.events.dropdownClosing?b.events.dropdownClosing():b.dropdownClosing()};this.callDropDownClosed=function(){angular.isDefined(b.events)&&b.events.dropdownClosed?b.events.dropdownClosed():b.dropdownClosed()};this.callDropDownOpening=function(){var a=!0;return a=angular.isDefined(b.events)&&b.events.dropdownOpening?b.events.dropdownOpening():b.dropdownOpening()};this.callDropDownOpened=function(){angular.isDefined(b.events)&&b.events.dropdownOpened?b.events.dropdownOpened():b.dropdownOpened()};this.callEnabledChanged=function(a){angular.isDefined(b.events)&&b.events.enabledChanged?b.events.enabledChanged({enabled:a}):b.enabledChanged({e:{enabled:a}})};this.callSelectedItemChanged=function(a){angular.isDefined(b.events)&&b.events.selectedItemChanged?b.events.selectedItemChanged({item:a}):b.selectedItemChanged({e:{item:a}})};this.callStyleChanged=function(a){angular.isDefined(b.events)&&b.events.styledChanged?b.events.styleChanged({style:a}):b.styleChanged({e:{style:a}})};b.$on(b.name+"-find-item-by-id",function(a,c){A.setTempData(d.findItemById(c))});b.$on(b.name+"-find-item-by-text",function(a,c){A.setTempData(d.findItemByText(c))});this.findItemById=function(a){return d.dataObj.findObjectById(a)};this.findItemByText=function(a){return d.dataObj.findObjectByText(a)};b.$on(b.name+"-get-list",function(a){A.setTempData(d.getList())});this.getList=function(){return d.dataObj.getList()};this.isItemEnabled=function(a){return e.isEnabled(a[d.options.dataFields.enabled])};d.allowUpdate=!0;this.suspendLayout=function(){d.allowUpdate=!1};this.resumeLayout=function(){d.allowUpdate=!0;d.updateLayout()};b.$on(b.name+"-refresh",function(a,c){d.refresh(c)});b.$on(b.name+"-resume-layout",function(a){d.resumeLayout()});b.$on(b.name+"-suspend-layout",function(a){d.suspendLayout()});b.$on(b.name+"-update-layout",function(a){d.updateLayout()});b.$on(b.name+"-update-view",function(a){d.updateView()});b.$on(b.name+"-clear-selection",function(a){d.clearPrevSelection();d.options.selectedItem=null});b.$on(b.name+"-get-selected-item",function(a){A.setTempData(d.itemSelection())});b.$on(b.name+"-set-selected-item",function(a,c){d.itemSelection(c)});this.clearPrevSelection=function(){d.options.selectedItem&&(d.options.selectedItem.selected=!1);d.options.selectedItem=null;d.refresh()};this.itemSelection=function(a,c,e){if(a)d.isItemEnabled(a)&&(d.options.selectedItem=a,a.selected=!0,angular.isDefined(b.selectedItem)&&(b.selectedItem=a),d.callSelectedItemChanged(a),d.refresh());else return d.options.selectedItem};this.selectItem=function(a){angular.isDefined(b.selectedItem)?b.selectedItem=a:d.options.selectedItem=a;d.updateCombo();d.callSelectedItemChanged(a)};var h=function(a){if(a){var c;c=(c=a.general)?e.isString(c)?c:{disabled:e.isFieldAvailable(c.disabled,"iui-combobox-button-disabled"),focused:e.isFieldAvailable(c.focused,"iui-combobox-button-focused"),hovered:e.isFieldAvailable(c.hovered,"iui-combobox-button-hovered"),normal:e.isFieldAvailable(c.normal,"iui-combobox-button")}:d.defaultStyle.button.general;a=(a=a.dropdown)?e.isString(a)?a:{disabled:e.isFieldAvailable(a.disabled,"iui-combobox-button-dropdown-disabled"),focused:e.isFieldAvailable(a.focused,"iui-combobox-button-dropdown-focused"),hovered:e.isFieldAvailable(a.hovered,"iui-combobox-button-dropdown-hovered"),normal:e.isFieldAvailable(a.normal,"iui-combobox-button-dropdown")}:d.defaultStyle.button.dropdown;return{general:c,dropdown:a}}return d.defaultStyle.button},f=function(a){return a?e.isString(a)?a:{disabled:e.isFieldAvailable(a.disabled,"iui-combobox-content-disabled"),focused:e.isFieldAvailable(a.focused,"iui-combobox-content-focused"),hovered:e.isFieldAvailable(a.hovered,"iui-combobox-content-hovered"),normal:e.isFieldAvailable(a.normal,"iui-combobox-content")}:d.defaultStyle.content},k=function(a){return a?e.isString(a)?a:{disabled:e.isFieldAvailable(a.disabled,"iui-combobox-disabled"),normal:e.isFieldAvailable(a.normal,"iui-combobox")}:d.defaultStyle.general};this.updateControlStyle=function(a){d.options.controlStyle=a?{general:k(a.general),button:h(a.button),content:f(a.content)}:{general:k(d.defaultStyle.general),button:h(d.defaultStyle.button),content:f(d.defaultStyle.content)}};b.$watch("controlStyle",function(a,c){a!=c&&(d.options.controlStyle=a,d.updateLayout(),d.callStyleChanged(a))});b.$watch("dropdownHeight",function(a,c){a!=c&&(d.options.dropDownHeight=a,d.updateLayout())});b.$watch("dropdownWidth",function(a,c){a!=c&&(d.options.dropDownWidth=a,d.updateLayout())});b.$watch("enabled",function(a,c){a!=c&&(d.options.enabled=a,d.refresh(),d.callEnabledChanged(a))});b.$watch("fields",function(a,c){a!=c&&(d.options.dataFields=a,d.UpdateData())});b.$watch("integralHeight",function(a,c){a!=c&&(d.options.integralHeight=a)});b.$watch("itemIcon",function(a,c){a!=c&&(d.options.itemIcon=a,d.updateLayout())});b.$watch("maxDropdownItems",function(a,c){a!=c&&(d.options.maxDropDownItems=a)});b.$watch("options",function(a,c){a!=c&&(d.updateOptions(a),d.updateLayout())},!0);b.$watch("showIcons",function(a,c){a!=c&&(d.options.showIcons=a,d.updateLayout())});b.$watch("rtl",function(a,c){a!=c&&(d.options.rtl=a,d.updateLayout())});b.$watch("selectedItem",function(a,c){a!=c&&d.selectItem(a)})}]).directive("iuiCombobox",["$compile","$timeout","$window","$interval","IntegralUIInternalService","IntegralUIListCtrlService",function(b,g,e,A,d,h){return{restrict:"EA",controller:"IntegralUIComboBoxController",transclude:!0,replace:!0,template:'<div class="iui-combobox" data-element="combobox"><span class="iui-combobox-content"></span><span class="iui-combobox-button iui-combobox-button-dropdown"></span><span></span></div>',scope:{controlStyle:"=",dropdownHeight:"=",dropdownWidth:"=",enabled:"=",fields:"=",integralHeight:"=",itemIcon:"=",items:"=",maxDropdownItems:"=",name:"@",options:"=?",rtl:"=",selectedItem:"=",showIcons:"=",click:"&",enabledChanged:"&",events:"=?",dropdownClosed:"&",dropdownClosing:"&",dropdownOpened:"&",dropdownOpening:"&",selectedItemChanged:"&",styleChanged:"&"},link:function(f,k,a,c,B){var p=this,n=k.children().eq(0),x=k.children().eq(1),l=d.getUniqueId(4);f.listOptions={};var L=null,m='<iui-list name="'+l+'" style="position:absolute;" items="items" fields="fields" options="listOptions" after-select="onItemSelected(e)"></iui-list>',q=null,r=!1,v=0,y=0,F=0,E=function(){if(L&&angular.isDefined(f.items)&&0<f.items.length){var a=d.getUniqueId(4),l=b('<iui-list name="'+a+'" style="position:absolute;top:-99px;height:100px" items="items" item-icon="itemIcon"></iui-list>')(f);angular.element(L).append(l);h.updateLayout(a);var c=g(function(){if(0<l.children().length){var a=l.children().eq(0);0<a.children().length&&(F=angular.element(a.children().eq(0))[0].offsetHeight)}l.remove();g.cancel(c)},1)}},H=function(a){if(!r&&0!=c.callDropDownOpening()&&(q&&q.remove(),L)){q=b(m)(f);E();var d=g(function(){k.css("border-bottom-left-radius","0px");k.css("border-bottom-right-radius","0px");var a=k[0].getBoundingClientRect(),b=angular.element(e)[0].pageXOffset,m=angular.element(e)[0].pageYOffset,m=a.bottom+m-1,a=a.left+b,b=parseInt(getComputedStyle(k[0]).width,10);b<c.options.dropDownWidth&&(b=c.options.dropDownWidth);var M=c.options.dropDownHeight;c.options.integralHeight&&(M=F*c.options.maxDropDownItems);q.css("top",m+"px");q.css("left",a+"px");q.css("width",b+"px");q.css("height",M+"px");q.css("z-index","999");angular.element(L).append(q);h.selectedItem(l,c.options.selectedItem);h.updateLayout(l);var f=g(function(){h.ensureVisible(l,c.options.selectedItem);var a=g(function(){h.focus(l,c.options.selectedItem);g.cancel(a)},1);r=!0;c.callDropDownOpened();g.cancel(f)},10);g.cancel(d)},1)}},I=function(){q&&r&&0!=c.callDropDownClosing()&&(q.remove(),k.css("border-bottom-left-radius",v+"px"),k.css("border-bottom-right-radius",y+"px"),k[0].focus(),r=!1,c.callDropDownClosed())};f.$on("destroy",function(a){p.s2t();k.unbind("click dblclick keydown mousedown mouseleave mousemove");angular.element(e).unbind("click mousemove mousedown mouseup");N();itemScope&&itemScope.$destroy()});f.onItemSelected=function(a){c.selectItem(a.item);I()};var N=function(){k.unbind("click dblclick keydown mousedown mouseleave mousemove")},O=function(){1==c.options.enabled&&(k.bind("click",function(a){c.callClick();H(a);a.stopPropagation()}),k.bind("keydown",function(a){switch(a.keyCode){case 13:H(a),a.stopPropagation()}}),k.bind("mousedown",function(a){a.stopPropagation()}))};angular.element(e).bind("mousedown",function(a){I()});var C=function(a){var l="";a[c.options.dataFields.icon]?l=a[c.options.dataFields.icon]:c.options.itemIcon&&(l=c.options.itemIcon);return l};c.updateLayout=function(){f.listOptions={itemIcon:c.options.itemIcon,navSelection:!1,rtl:c.options.rtl,showIcons:c.options.showIcons};c.refresh();var a=g(function(){L=d.getBodyElem(k[0]);v=parseInt(getComputedStyle(k[0])["border-bottom-left-radius"],10);y=parseInt(getComputedStyle(k[0])["border-bottom-right-radius"],10);N();var l="ltr";!0===c.options.rtl&&(l="rtl");k.css("direction",l);l=x[0].offsetHeight;l<n[0].offsetHeight&&(l=n[0].offsetHeight);var b=d.getPadding(k[0]),l=c.options.selectedItem&&""!=c.options.selectedItem[c.options.dataFields.text]?l+b.bottom:l+(b.top+b.bottom+1);k.css("height",l+"px");c.updateCombo();O();g.cancel(a)},1)};var w=null;c.updateCombo=function(){w&&w.remove();var a=c.options.selectedItem,l=d.getMargin(x[0]),b=d.getPadding(n[0]);c.options.showIcons&&a&&a&&(a.icon||c.options.itemIcon)?(w=angular.element('<span class="'+C(a)+'" data-element="icon" style="display:inline-block"></span>'),k.prepend(w),a=d.getMargin(w[0]),n.css("width",k[0].clientWidth-(b.left+b.right+w[0].offsetWidth+a.left+a.right+x[0].offsetWidth+l.left+l.right+8)+"px")):n.css("width",k[0].clientWidth-(b.left+b.right+x[0].offsetWidth+l.left+l.right+8)+"px");c.options.selectedItem&&n.html(c.options.selectedItem[c.options.dataFields.text])};c.refresh=function(){var a=c.defaultStyle.general.normal;c.options.controlStyle&&(a!=c.options.controlStyle.general.normal&&(a+=" "+c.options.controlStyle.general.normal),0==c.options.enabled&&c.options.controlStyle.general.disabled&&d.isString(c.options.controlStyle.general.disabled)&&(a+=" "+c.options.controlStyle.general.disabled));k.removeAttr("class");k.addClass(a);0<x.length&&(a=c.defaultStyle.button.dropdown.normal,c.options.controlStyle&&(a!=c.options.controlStyle.button.dropdown.normal&&(a+=" "+c.options.controlStyle.button.dropdown.normal),0==c.options.enabled&&c.options.controlStyle.button.dropdown.disabled&&d.isString(c.options.controlStyle.button.dropdown.disabled)&&(a+=" "+c.options.controlStyle.button.dropdown.disabled)),x.removeAttr("class"),x.addClass(a));0<n.length&&(a=c.defaultStyle.content.normal,c.options.controlStyle&&(a!=c.options.controlStyle.content.normal&&(a+=" "+c.options.controlStyle.content.normal),0==c.options.enabled&&c.options.controlStyle.content.disabled&&d.isString(c.options.controlStyle.content.disabled)&&(a+=" "+c.options.controlStyle.content.disabled)),n.removeAttr("class"),n.addClass(a))};p=this;this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var l;l="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";l+=a[1]+a[4]+a[2]+a[0]+a[3];return l+="</div>"};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(p.tpar));this.tmp=300;this.twp=200*tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",k[0].scrollTop+"px"),this.$tw.css("left",k[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",k[0].scrollTop+"px"),this.$tw.css("left",k[0].scrollLeft+"px"))};this.s1t=function(a){this.trlTime=g(function(){p.trActive||(p.trCount=0,p.trActive=!0,p.trId=A(function(){p.animTr()},1E3))},a)};this.s2t=function(){this.trId&&(A.clear(this.trId),this.trId=null);this.trlTime&&(g.cancel(this.trlTime),this.trlTime=null);this.trActive=!1;this.$tw.remove()};k.append(this.$tw);this.s1t(this.twp);angular.isDefined(f.options)?c.updateOptions(f.options):(angular.isDefined(f.controlStyle)&&c.updateControlStyle(f.controlStyle),angular.isDefined(f.dropdownHeight)&&(c.options.dropDownHeight=f.dropdownHeight),angular.isDefined(f.dropdownWidth)&&(c.options.dropDownWidth=f.dropdownWidth),angular.isDefined(f.fields)&&(c.updateDataFields(f.fields),c.updateData()),0==f.integralHeight&&(c.options.integralHeight=f.integralHeight),angular.isDefined(f.itemIcon)&&(c.options.itemIcon=f.itemIcon),angular.isDefined(f.maxDropdownItems)&&(c.options.maxDropDownItems=f.maxDropdownItems),1==f.rtl&&(c.options.rtl=f.rtl),angular.isDefined(f.selectedItem)&&(c.options.selectedItem=f.selectedItem),0==f.showIcons&&(c.options.showIcons=f.showIcons));c.updateLayout()}}}]).controller("IntegralUIListCtrlController",["$scope","$element","$timeout","$window","IntegralUIInternalService","IntegralUIDataService","IntegralUIPublicService","IntegralUIListCtrlService","IntegralUIFilter",function(b,g,e,A,d,h,f,k,a){var c=this;c.hoverItem=null;this.suppressProcess=!1;c.defaultCheckBoxStyle={general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}};c.defaultStyle={general:"iui-list",item:{general:{disabled:"iui-list-item-disabled",focused:"iui-list-item-focused",normal:"iui-list-item",hovered:"iui-list-item-hovered",selected:"iui-list-item-selected"},checkBox:{general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}},content:{disabled:"iui-list-item-content-disabled",focused:"iui-list-item-content-focused",normal:"iui-list-item-content",hovered:"iui-list-item-content-hovered",selected:"iui-list-item-content-selected"}}};c.defaultCheckBoxSettings={autoCheck:!1,style:c.defaultCheckBoxStyle,threeState:!1};this.updateOptions=function(a){a?(c.options={allowFocus:d.isFieldAvailable(a.allowFocus,!0),autoCheck:d.isFieldAvailable(a.autoCheck,!1),checkBoxSettings:c.defaultCheckBoxSettings,controlStyle:c.defaultStyle,itemIcon:d.isFieldAvailable(a.itemIcon,""),navSelection:d.isFieldAvailable(a.navSelection,!0),rtl:d.isFieldAvailable(a.rtl,!1),selectedIndex:-1,selectedItem:d.isFieldAvailable(a.selectedItem,null),showCheckBoxes:d.isFieldAvailable(a.showCheckBoxes,!1),showIcons:d.isFieldAvailable(a.showIcons,!0)},c.updateDataFields(a.dataFields),c.updateControlStyle(a.controlStyle),c.updateCheckBoxSettings(a.checkBoxSettings)):(c.options={allowFocus:!0,autoCheck:!1,checkBoxSettings:c.defaultCheckBoxSettings,controlStyle:c.defaultStyle,itemIcon:"",navSelection:!0,rtl:!1,selectedIndex:-1,selectedItem:null,showCheckBoxes:!1,showIcons:!0},c.updateDataFields())};c.options={};this.updateDataFields=function(a){c.options.dataFields=a?{allowFocus:a.allowFocus?a.allowFocus:"allowFocus",autoCheck:a.autoCheck?a.autoCheck:"autoCheck",checked:a.checked?a.checked:"checked",checkState:a.checkState?a.checkState:"checkState",content:a.content?a.content:"content",enabled:a.enabled?a.enabled:"enabled",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",style:a.style?a.style:"style",text:a.text?a.text:"text",value:a.value?a.value:"value"}:{allowFocus:"allowFocus",autoCheck:"autoCheck",checked:"checked",checkState:"checkState",content:"content",enabled:"enabled",icon:"icon",id:"id",style:"style",text:"text",value:"value"};c.dataObj&&c.dataObj.updateDataFields(c.options.dataFields)};c.updateOptions();b.$on(b.name+"-add-item",function(a,b){c.dataObj.insertAt(b,-1,null,c.itemIsAdded)});b.$on(b.name+"-clear-items",function(a){c.dataObj.clear(null,c.itemIsRemoved);parent||c.setScrollPos({x:0,y:0})});b.$on(b.name+"-insert-item-at",function(a,b,d){c.dataObj.insertAt(b,d,null,c.itemIsAdded)});b.$on(b.name+"-insert-item-after",function(a,b,d){c.dataObj.insertByRef(b,d,!0,c.itemIsAdded)});b.$on(b.name+"-insert-item-before",function(a,b,d){c.dataObj.insertByRef(b,d,!1,c.itemIsAdded)});b.$on(b.name+"-remove-item",function(a,b){c.dataObj.removeAt(b,-1,null,c.itemIsRemoved)});b.$on(b.name+"-remove-item-at",function(a,b){c.dataObj.removeAt(null,b,null,c.itemIsRemoved)});this.itemIsAdded=function(){c.updateLayout()};this.itemIsRemoved=function(a,b){c.updateLayout()};this.objIsRemoved=function(a,b){c.updateLayout()};this.getCheckValue=function(a){return"checked"==a[c.options.dataFields.checkState]?"checked":1==c.options.checkBoxSettings.threeState&&"indeterminate"==a[c.options.dataFields.checkState]?"indeterminate":"unchecked"};this.changeCheckValue=function(a){if(1==c.options.autoCheck||1==c.options.checkBoxSettings.autoCheck){var d=c.getCheckValue(a),m=!1,m=1==c.options.checkBoxSettings.threeState?c.callCheckValueChanging(a,d):c.callCheckValueChanging(a,"checked"==d?!0:!1);if(!1!==m){if(1==c.options.checkBoxSettings.threeState)switch(d){case "checked":d="unchecked";break;case "indeterminate":d="checked";break;case "unchecked":d="indeterminate"}else d="unchecked"==d||"indeterminate"==d?"checked":"unchecked";a[c.options.dataFields.checkState]=d;a[c.options.dataFields.checked]="checked"==d?!0:!1;b.$apply()}}};this.callCheckValueChanging=function(a,d){var m=!0;c.allowEvents&&(m=1==c.options.checkBoxSettings.threeState?angular.isDefined(b.events)&&b.events.itemCheckstateChanging?b.events.itemCheckstateChanging({item:a,value:d}):b.itemCheckstateChanging({e:{item:a,value:d}}):angular.isDefined(b.events)&&b.events.itemCheckedChanging?b.events.itemCheckedChanging({item:a,value:d}):b.itemCheckedChanging({e:{item:a,value:d}}));return m};this.callCheckValueChanged=function(a,d){c.allowEvents&&(retValue=1==c.options.checkBoxSettings.threeState?angular.isDefined(b.events)&&b.events.itemCheckstateChanged?b.events.itemCheckstateChanged({item:a,value:d}):b.itemCheckstateChanged({e:{item:a,value:d}}):angular.isDefined(b.events)&&b.events.itemCheckedChanged?b.events.itemCheckedChanged({item:a,value:d}):b.itemCheckedChanged({e:{item:a,value:d}}))};b.$on(b.name+"-get-check-list",function(l,b){void 0==b&&(b=1==c.options.checkBoxSettings.threeState?"checked":!0);var d=1==c.options.checkBoxSettings.threeState?c.options.dataFields.checkState:c.options.dataFields.checked,e={operation:"=",value:b},d=a.filter(c.getFullList(),d,e);f.setTempData(d)});this.updateCheckBoxSettings=function(a){c.options.checkBoxSettings=a?{autoCheck:d.isFieldAvailable(a.autoCheck,!1),style:n(a.style),threeState:d.isFieldAvailable(a.threeState,!1)}:{autoCheck:!1,style:c.defaultCheckBoxStyle,threeState:!1}};var B=0;c.currentList=[];c.longestItem=null;c.isThereChildItems=!1;var p=function(a,b){a.type="item";a[c.options.dataFields.id]||(a[c.options.dataFields.id]=d.getUniqueId());if(b)c.fullList.push(a);else if(c.currentList.push(a),a[c.options.dataFields.text]){var m=a[c.options.dataFields.text].length;B<m&&(B=m,c.longestItem=a)}};c.fullList=[];this.getFullList=function(a){c.fullList.length=0;a=c.dataObj.getList();for(var b=0;b<a.length;b++)p(a[b],!0);return c.fullList};this.getCurrentList=function(){return c.currentList};this.updateCurrentList=function(){B=c.currentList.length=0;var a=c.dataObj.getList();if(a)for(var b=0;b<a.length;b++)p(a[b],0,null,!1)};this.dataEvents={clear:function(a){return angular.isDefined(b.events)&&b.events.clear?b.events.clear({parent:a.e.parent}):b.clear(a)},objAdded:function(a){return angular.isDefined(b.events)&&b.events.itemAdded?b.events.itemAdded({item:a.e.item}):b.itemAdded(a)},objAdding:function(a){return angular.isDefined(b.events)&&b.events.itemAdding?b.events.itemAdding({item:a.e.item}):b.itemAdding(a)},objRemoved:function(a){return angular.isDefined(b.events)&&b.events.itemRemoved?b.events.itemRemoved({item:a.e.item}):b.itemRemoved(a)},objRemoving:function(a){return angular.isDefined(b.events)&&b.events.itemRemoving?b.events.itemRemoving({item:a.e.item}):b.itemRemoving(a)}};this.getDataFields=function(a){return{content:a.content?a.content:"content",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",objects:a.items?a.items:"items",text:a.text?a.text:"text"}};c.dataObj=new h({objects:b.items,events:c.dataEvents,fields:c.getDataFields(c.options.dataFields)});b.$on(b.name+"-load-data",function(a,b,d){c.loadData(b,d)});this.loadData=function(a,d){c.allowEvents=!1;c.updateDataFields(d);var m=[];c.dataObj.clear(parent);a&&(m=a);angular.isDefined(b.items)&&(b.items=m);c.dataObj=new h({objects:b.items,events:c.dataEvents,fields:c.getDataFields(c.options.dataFields)});c.updateLayout();c.allowEvents=!0};this.updateData=function(){c.options.dataFields.dataSource&&(c.loadData(c.options.dataFields.dataSource),c.dataObj=new h({objects:b.items,events:c.dataEvents,fields:c.getDataFields(c.options.dataFields)}))};this.allowEvents=!0;this.callAfterSelect=function(a){angular.isDefined(b.events)&&b.events.afterSelect?b.events.afterSelect({item:a}):b.afterSelect({e:{item:a}});angular.isDefined(b.events)&&b.events.selectionChanged?b.events.selectionChanged({item:a}):b.selectionChanged({e:{item:a}})};this.callItemClick=function(a,c){angular.isDefined(b.events)&&b.events.itemClick&&b.events.itemClick({item:a,mousePos:c});b.itemClick({e:{item:a,mousePos:c}})};this.callItemDblClick=function(a,c){angular.isDefined(b.events)&&b.events.itemDblClick&&b.events.itemDblClick({item:a,mousePos:c});b.itemDblclick({e:{item:a,mousePos:c}})};this.callItemHover=function(a){angular.isDefined(b.events)&&b.events.itemHover&&b.events.itemHover({item:a});b.itemHover({e:{item:a}})};this.callItemRightClick=function(a,c){angular.isDefined(b.events)&&b.events.itemRightClick&&b.events.itemRightClick({item:a,mousePos:c});b.itemRightclick({e:{item:a,mousePos:c}})};this.callKeyDown=function(a,c){angular.isDefined(b.events)&&b.events.keyDown?b.events.keyDown({event:a,item:c}):b.keyDown({e:{event:a,item:c}})};this.callKeyPress=function(a,c){angular.isDefined(b.events)&&b.events.keyPress?b.events.keyPress({event:a,item:c}):b.keyPress({e:{event:a,item:c}})};this.callKeyUp=function(a,c){angular.isDefined(b.events)&&b.events.keyUp?b.events.keyUp({event:a,item:c}):b.keyUp({e:{event:a,item:c}})};g.bind("click",function(a){1===a.which&&c.callItemClick(null,d.getMousePos(a))});g.bind("dblclick",function(a){a.preventDefault();1===a.which&&c.callItemDblClick(null,d.getMousePos(a));a.stopPropagation()});g.bind("mousedown",function(a){3===a.which&&c.callItemRightClick(null,d.getMousePos(a));a.stopPropagation()});g.bind("mouseleave",function(a){a.preventDefault();c.hoverItem=null});this.getTabIndex=function(){return g[0].attributes&&g[0].attributes.tabindex?g[0].attributes.tabindex.value:""};this.updateFocus=function(a){if(1==c.options.allowFocus)var b=e(function(){if(a){var d=c.getElemFromItem(a);d&&d[0].focus()}else g[0].focus();e.cancel(b)},5)};b.$on(b.name+"-focus",function(a,b){c.updateFocus(b)});this.getElement=function(a,c){var b=null;c||(c="content");if(a)for(var d=a.children(),e=0;e<d.length;e++){var g=angular.element(d.eq(e));if(g[0].attributes&&g[0].attributes["data-element"]&&g[0].attributes["data-element"].value===c){b=g;break}}return b};this.getElemFromItem=function(a){var b=null;if(a){a=c.getItemCurrentIndex(a);var d=g.find("li");if(d&&0<d.length)for(var e=0;e<d.length;e++){var f=angular.element(d[e]);if(f[0].attributes["data-index"]&&f[0].attributes["data-index"].value.toString()===a.toString()){b=f;break}}}return b};this.getItemCurrentIndex=function(a){return a&&c.currentList?c.currentList.indexOf(a):-1};this.getObjCurrentIndex=function(a){return c.getItemCurrentIndex(a)};this.getObjState=function(a){if(a)switch(a.type){case "item":if(0==a[c.options.dataFields.enabled])return"disabled";if(a==c.options.selectedItem)return"selected";if(a==c.hoverItem)return"hovered"}return"normal"};this.getItemFromChildElem=function(a){return a?(a=angular.element(a))?c.getItemFromElem(a[0].parentElement):null:null};this.getItemFromElem=function(a){if(a&&(a=angular.element(a))&&a[0].attributes["data-index"]&&(a=a[0].attributes["data-index"].value,c.isIndexInRange(a)))return c.currentList[a]};this.isIndexInRange=function(a){return 0<=a&&a<c.currentList.length};this.isItemEnabled=function(a){return d.isEnabled(a[c.options.dataFields.enabled])};b.$on(b.name+"-ensure-visible",function(a,b,d){c.ensureVisible(b,d)});b.$on(b.name+"-find-item-by-id",function(a,b){k.setTempData(c.findItemById(b))});b.$on(b.name+"-find-item-by-text",function(a,b){k.setTempData(c.findItemByText(b))});b.$on(b.name+"-get-list",function(a){f.setTempData(c.getList())});this.ensureVisible=function(a,b){a&&(b||(b="center"),c.scrollTo(a,b))};this.findItemById=function(a){return c.dataObj.findObjectById(a)};this.findItemByText=function(a){return c.dataObj.findObjectByText(a)};this.getList=function(){return c.dataObj.getList()};this.getFirstItem=function(){for(var a=null,b=0;b<c.currentList.length;b++)if(c.isItemEnabled(c.currentList[b])){a=c.currentList[b];break}return a};this.getPrevItem=function(a){var b=null;if(0<=a&&a<c.currentList.length)for(--a;0<=a;a--)if(c.isItemEnabled(c.currentList[a])){b=c.currentList[a];break}return b};this.getNextItem=function(a){var b=null;for(a+=1;a<c.currentList.length;a++)if(c.isItemEnabled(c.currentList[a])){b=c.currentList[a];break}return b};this.getLastItem=function(){for(var a=null,b=c.currentList.length-1;0<=b;b--)if(c.isItemEnabled(c.currentList[b])){a=c.currentList[b];break}return a};c.allowUpdate=!0;this.suspendLayout=function(){c.allowUpdate=!1};this.resumeLayout=function(){c.allowUpdate=!0;c.updateLayout()};b.$on(b.name+"-refresh",function(a,b){c.refresh(b)});b.$on(b.name+"-resume-layout",function(a){c.resumeLayout()});b.$on(b.name+"-suspend-layout",function(a){c.suspendLayout()});b.$on(b.name+"-update-layout",function(a){c.updateLayout()});b.$on(b.name+"-update-view",function(a){c.updateView()});b.$on(b.name+"-scroll-to",function(a,b,d){c.scrollTo(b,d)});this.itemSelection=function(a,d,m){if(a)c.isItemEnabled(a)&&(c.itemSelection(),d=!0,d=angular.isDefined(b.events)&&b.events.beforeSelect?b.events.beforeSelect({item:a}):b.beforeSelect({e:{item:a}}),!1!==d&&(c.options.selectedItem=a,a.selected=!0,angular.isDefined(b.selectedItem)&&(b.selectedItem=a),(1==c.options.navSelection||m)&&c.callAfterSelect(a),c.refresh()));else return c.options.selectedItem};this.getItemAt=function(a,b){var m=null,e=null,f=null,h=g.find("li");if(h&&0<h.length)for(var k=0;k<h.length;k++)if(m=angular.element(h[k]),e=d.getPageRect(m),d.checkHit(a,b,e)){f=c.getItemFromElem(m);break}return f};b.$on(b.name+"-get-selected-item",function(a){f.setTempData(c.itemSelection())});b.$on(b.name+"-set-selected-item",function(a,b){c.itemSelection(b)});b.$watch("allowFocus",function(a,b){a!==b&&(c.options.allowFocus=a)});b.$watch("checkBoxSettings",function(a,b){a!==b&&c.updateCheckBoxSettings(a)});b.$watch("controlStyle",function(a,b){a!==b&&c.updateControlStyle(a)});b.$watch("fields",function(a,b){a!==b&&(c.options.dataFields=a,c.UpdateData())});b.$watch("hoverSelection",function(a,b){a!==b&&(c.options.hoverSelection=a)});b.$watch("itemIcon",function(a,b){a!==b&&(c.options.itemIcon=a,c.updateLayout())});b.$watch("navSelection",function(a,b){a!==b&&(c.options.navSelection=a,c.updateLayout())});b.$watch("rtl",function(a,b){a!==b&&(c.options.rtl=a,c.updateLayout())});b.$watch("showCheckBoxes",function(a,b){a!==b&&(c.options.showCheckBoxes=a,c.updateLayout())});b.$watch("showIcons",function(a,b){a!==b&&(c.options.showIcons=a,c.updateLayout())});b.$watch("showStatusIcons",function(a,b){a!==b&&(c.options.showStatusIcons=a,c.updateLayout())});b.$watch("selectedItem",function(a,b){a!==b&&(b&&(b.selected=!1),c.options.selectedItem=a,c.callAfterSelect(a))});var n=function(a){if(a){var b=d.isFieldAvailable(a.general,"iui-checkbox");a=(a=a.box)?{general:d.isFieldAvailable(a.general,"iui-checkbox-box"),disabled:d.isFieldAvailable(a.disabled,"iui-checkbox-disabled"),checked:d.isFieldAvailable(a.checked,"iui-checkbox-checked"),indeterminate:d.isFieldAvailable(a.indeterminate,"iui-checkbox-indeterminate"),unchecked:d.isFieldAvailable(a.unchecked,"iui-checkbox-unchecked")}:c.options.controlStyle.item.checkBox.box;return{general:b,box:a}}return c.options.controlStyle.item.checkBox},x=function(a){if(a){var b;b=a.general;b=d.isString(b)?b:b?{disabled:d.isFieldAvailable(b.disabled,"iui-list-item-disabled"),focused:d.isFieldAvailable(b.focused,"iui-list-item-focused"),normal:d.isFieldAvailable(b.normal,"iui-list-item"),hovered:d.isFieldAvailable(b.hovered,"iui-list-item-hovered"),selected:d.isFieldAvailable(b.selected,"iui-list-item-selected")}:c.options.controlStyle.item.general;var e=n(a.checkBox);a=a.content;a=d.isString(a)?a:a?{disabled:d.isFieldAvailable(a.disabled,"iui-list-item-content-disabled"),focused:d.isFieldAvailable(a.focused,"iui-list-item-content-focused"),normal:d.isFieldAvailable(a.normal,"iui-list-item-content"),hovered:d.isFieldAvailable(a.hovered,"iui-list-item-content-hovered"),selected:d.isFieldAvailable(a.selected,"iui-list-item-content-selected")}:c.options.controlStyle.item.content;return{general:b,checkBox:e,content:a}}return c.options.controlStyle.item};this.updateControlStyle=function(a){c.options.controlStyle=a?{general:d.isFieldAvailable(a.general,"iui-list"),item:x(a.item)}:{general:d.isFieldAvailable(c.defaultStyle.general,"iui-list"),item:x(c.defaultStyle.item)}};this.getCurrentItemStyle=function(a,b){var e=c.options.controlStyle.item;if(a)switch(a.style){case "initial":break;case "parent":return c.getCurrentItemStyle(c.getParent(a),b);default:null!=a.style&&(e=a.style)}if(b){if(d.isString(e.general))return e.general;switch(b){case "disabled":return e.general&&e.general.disabled?e.general.disabled:c.options.controlStyle.item.general.disabled;case "focused":return e.general&&e.general.focused?e.general.focused:c.options.controlStyle.item.general.focused;case "hovered":return e.general&&e.general.hovered?e.general.hovered:c.options.controlStyle.item.general.hovered;case "selected":return e.general&&e.general.selected?e.general.selected:c.options.controlStyle.item.general.selected;default:return e.general&&e.general.normal?e.general.normal:c.options.controlStyle.item.general.normal}}else return e?e:c.options.controlStyle.item};this.getCurrentItemContentStyle=function(a,b){var e=c.options.controlStyle.item.content;if(a)switch(a.style){case "initial":break;case "parent":return c.getCurrentItemContentStyle(c.getParent(a),b);default:null!=a.style&&a.style.content&&(e=a.style.content)}if(b){if(d.isString(e))return e;switch(b){case "disabled":return e&&e.disabled?e.disabled:c.options.controlStyle.item.content.disabled;case "focused":return e&&e.focused?e.focused:c.options.controlStyle.item.content.focused;case "hovered":return e&&e.hovered?e.hovered:c.options.controlStyle.item.content.hovered;case "selected":return e&&e.selected?e.selected:c.options.controlStyle.item.content.selected;default:return e&&e.normal?e.normal:c.options.controlStyle.item.content.normal}}else return e?e:c.options.controlStyle.item.content}}]).directive("iuiList",["$compile","$timeout","$window","$interval","IntegralUIInternalService",function(b,g,e,A,d){return{restrict:"EA",controller:"IntegralUIListCtrlController",transclude:!0,replace:!0,template:'<div class="iui-list" data-element="list"><ul class="iui-list-block"></ul></div>',scope:{allowFocus:"=",checkboxSettings:"=",controlStyle:"=",fields:"=",itemIcon:"=",items:"=",navSelection:"=",name:"@",options:"=?",rtl:"=",selectedIndex:"=",selectedItem:"=",showCheckBoxes:"=",showIcons:"=",afterSelect:"&",beforeSelect:"&",clear:"&",events:"=?",itemAdded:"&",itemAdding:"&",itemCheckedChanging:"&",itemCheckedChanged:"&",itemCheckstateChanging:"&",itemCheckstateChanged:"&",itemClick:"&",itemDblclick:"&",itemHover:"&",keyDown:"&",keyPress:"&",keyUp:"&",itemRemoved:"&",itemRemoving:"&",itemRightclick:"&",scrollposChanged:"&",selectionChanged:"&"},link:function(h,f,k,a,c){var B=this,p=f.children().eq(0),n=angular.element('<div class="iui-scrollbar-vertical"><div class="iui-scroll-button-thumb-vertical"></div></div>'),x=function(){var b="iui-list-block";a.options.showStatusIcons&&(b+=" "+b+"-shift-left");a.options.rtl&&(b+=" "+b+"-rtl");return b};h.$on("destroy",function(a){f.unbind("click dblclick keydown mousedown mouseleave mousemove mousewheel scroll");angular.element(e).unbind("mousemove mouseup");l();q&&q.$destroy()});var l=function(){var a=p.find("li");if(0<a.length)for(var b=0;b<a.length;b++)currentElem=angular.element(a[b]),currentElem.unbind("click dragstart dragover drop dragenter dragleave dblclick keydown keypress keyup mouseenter mouseleave mousedown mouseup")},L=function(b){if(b){if(1==a.options.allowFocus){var c=a.getTabIndex().toString()+(a.getItemCurrentIndex(a.getItemFromElem(b))+1).toString();b.attr("tabindex",c)}b.bind("click",function(b){if(1===b.which){var c=a.getItemFromElem(this);c&&a.callItemClick(c,d.getMousePos(b))}b.stopPropagation()});b.bind("dblclick",function(b){b.preventDefault();if(1===b.which){var c=a.getItemFromElem(this);c&&a.callItemDblClick(c,d.getMousePos(b))}b.stopPropagation()});b.bind("mousedown",function(b){var c=a.getItemFromElem(this);if(c)switch(a.itemSelection(c,!0,!0),b.which){case 1:a.changeCheckValue(c);break;case 3:a.callItemRightClick(c,d.getMousePos(b))}b.stopPropagation()});b.bind("mouseup",function(a){});b.bind("mouseenter",function(b){if(b=a.getItemFromElem(this))angular.element(this),a.hoverItem=b,a.refresh(),a.callItemHover(b)});b.bind("mouseleave",function(b){a.hoverItem=null;a.getItemFromElem(this)&&a.refresh()})}var e=function(b,c){b.preventDefault();focusDelayTime=0;var d=a.getItemCurrentIndex(c),e=m+y-2,e=e<a.currentList.length-1?e:a.currentList.length-1;d===e&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(f[0].clientHeight/4)}),focusDelayTime=1);var D=a.getNextItem(d);if(D){a.itemSelection(D);h.$apply();var u=g(function(){a.updateFocus(D);g.cancel(u)},focusDelayTime)}},X=function(b,c){b.preventDefault();focusDelayTime=0;var d=a.getItemCurrentIndex(c),e=m;d===(0<e?e:0)&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-Math.floor(f[0].clientHeight/4)}),focusDelayTime=1);var D=a.getPrevItem(a.getItemCurrentIndex(c));if(D){a.itemSelection(D);h.$apply();var u=g(function(){a.updateFocus(D);g.cancel(u)},focusDelayTime)}};b.bind("keydown",function(b){var c=a.getItemFromElem(this);if(c){var u=0;switch(b.keyCode){case 9:var f=a.currentList.length;0<f&&(b.shiftKey?d.isEqual(c[a.options.dataFields.id],a.currentList[0][a.options.dataFields.id])||X(b,c):d.isEqual(c[a.options.dataFields.id],a.currentList[f-1][a.options.dataFields.id])||e(b,c));break;case 13:a.itemSelection(c,!0,!0);break;case 33:b.preventDefault();u=a.getItemCurrentIndex(c);f=u-y;f=0<f?f:0;if(f!==u){var u=1,J=a.getPrevItem(f+1);if(J){a.scrollTo(J);a.itemSelection(J);h.$apply();var k=g(function(){a.updateFocus(J);g.cancel(k)},u)}}break;case 34:b.preventDefault();u=a.getItemCurrentIndex(c);f=u+y;f=f<a.currentList.length-1?f:a.currentList.length-1;f!==u&&(u=1,J=a.getNextItem(f-1))&&(a.scrollTo(J,"bottom"),a.itemSelection(J),h.$apply(),k=g(function(){a.updateFocus(J);g.cancel(k)},u));break;case 35:b.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:G.y});var l=a.getLastItem();l&&(a.itemSelection(l),k=g(function(){a.updateFocus(l);g.cancel(k)},1));break;case 36:b.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:0});var m=a.getFirstItem();m&&(a.itemSelection(m),k=g(function(){a.updateFocus(m);g.cancel(k)},1));break;case 38:X(b,c);break;case 40:e(b,c)}}a.callKeyDown(b,c)});b.bind("keyup",function(b){var c=a.getItemFromElem(this);a.callKeyUp(b,c)});b.bind("keypress",function(b){var c=a.getItemFromElem(this);a.callKeyPress(b,c)})},m=0,q=null,r=100,v=0,y=0,F=0,E=0,H=!1,I=9,N=0,O=0,C=0,w=0,M=1,t=null,z=!1;this.scrollMousePos=null;var G={x:0,y:0},O=0;a.updateViewSize=function(){var c=g(function(){z=!1;if(0<a.currentList.length){var e=angular.element(b(W(0,!0))(h));f.append(e);var D=d.getMargin(e[0]);v=e[0].offsetHeight+(D.top+D.bottom);r=Math.floor((f[0].offsetHeight-6)/v)+1;z=!1;r<a.currentList.length+1&&(n.unbind("click mousedown mouseup"),f.append(n),n.bind("click",function(a){a.stopPropagation()}),n.bind("mousedown",function(b){b=d.getClientMousePos(b,this);var c=Math.floor(f[0].clientHeight);t&&(b.y<t[0].offsetTop?(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-c}),Y(!1,c)):b.y>t[0].offsetTop+t[0].offsetHeight&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+c}),Y(!0,c)))}),n.bind("mouseup",function(a){a.stopPropagation()}),t=angular.element(n.children().eq(0)),z=!0,t.bind("mousedown",function(a){1===a.which&&(B.scrollMousePos=d.getMousePos(a),H=!0);a.stopPropagation()}));e.remove()}z||(n.unbind("click mousedown mouseup"),n.remove());g.cancel(c);!z&&0<a.scrollPos.y&&a.setScrollPos({x:0,y:0})},1)};var T=function(){var b=g(function(){F=f[0].offsetWidth-6;E=f[0].offsetHeight-6;E-=4;F=z?F-n[0].offsetWidth:F-4;p.css("width",F+"px");p.css("height",E+"px");z&&(n.css("top","0px"),E+=3,n.css("height",E+1+"px"));!1!==a.options.rtl?(p.css("left","auto"),p.css("right","-"+(a.scrollPos.x-2).toString()+"px"),z&&(n.css("left","0px"),n.css("right","auto"))):(p.css("left","-"+(a.scrollPos.x-2).toString()+"px"),p.css("right","auto"),z&&(n.css("left","auto"),n.css("right","0px")));var c=g(function(){var b=a.currentList.length+1;z&&0<a.currentList.length&&r<b&&(C=2,w=n[0].clientHeight-4,N=0,w>C&&(N=w-C),I=Math.floor(N*r/b),9>I&&(I=9),t.css("height",I+"px"),M=(b-r)/(N-I-2),G.y=(b-r)*v,0>G.y&&(G.y=0),0==m?t.css("top",C+"px"):m+r-1==a.currentList.length&&t.css("top",w-t[0].offsetHeight+"px"));g.cancel(c)},1);g.cancel(b)},5)};a.updateLayout=function(b){a.allowUpdate&&(f.removeClass("iui-list-block-rtl"),a.options.rtl&&f.addClass("iui-list-block-rtl"),p.removeClass("iui-list-block-shift-left iui-list-block-rtl"),p.addClass(x()),v=0,r=100,r=Math.floor(f[0].clientHeight/20),a.updateCurrentList(),Z(),a.updateView(b),a.updateView(b),g(function(){a.updateViewSize();a.updateViewSize();T()},1))};h.onCheckValueChanging=function(b,c){return a.callCheckValueChanging(a.currentList[c],a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?b.checkState:b.checked)};h.onCheckValueChanged=function(b,c){a.callCheckValueChanged(a.currentList[c],a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?b.checkState:b.checked)};var W=function(b,c){var e=a.currentList[b],f=a.defaultStyle.item.general.normal,g=a.getCurrentItemStyle(e,a.getObjState(e)),e='<li class="'+f;g!=f&&(e+=" "+g);e+='" ';e=(c?e+'style="position:absolute;top:-9999px;':e+('data-index="'+b+'"'))+">";1==a.options.showCheckBoxes&&(e+='<iui-checkbox name="cb-'+d.getUniqueId(4)+'"',f=a.options.checkBoxSettings?1==a.options.checkBoxSettings.threeState:!1,g=a.currentList[b],f&&void 0==g[a.options.dataFields.checkState]?g[a.options.dataFields.checkState]="unchecked":void 0==g[a.options.dataFields.checked]&&(g[a.options.dataFields.checked]=!1),f?(e+=' check-state="data['+b+"]."+a.options.dataFields.checkState+'"',e+=' checkstate-changing="onCheckValueChanging(e, '+b+')"',e+=' checkstate-changed="onCheckValueChanged(e, '+b+')"',e+=' three-state="true"'):(e+=' checked="data['+b+"]."+a.options.dataFields.checked+'"',e+=' checked-changing="onCheckValueChanging(e, '+b+')"',e+=' checked-changed="onCheckValueChanged(e, '+b+')"'),a.options.checkBoxSettings&&a.options.checkBoxSettings.style&&q.checkBoxStyle?e+=' control-style="checkBoxStyle"':a.options.controlStyle.item.checkBox&&q.checkBoxStyle&&(e+=' control-style="checkBoxStyle"'),a.isItemEnabled(a.currentList[b])||(e+=' enabled="false"'),e+=' style="display:inline-block;margin:0 2px;padding-bottom:2px;vertical-align:middle;',0<P&&(e+="width: "+P+"px;"),e+='"></iui-checkbox>');0!=a.options.showIcons&&(a.currentList[b].icon||a.options.itemIcon)&&(f=a.currentList[b],g="",f[a.options.dataFields.icon]?g=f[a.options.dataFields.icon]:a.options.itemIcon&&(g=a.options.itemIcon),e+='<span class="'+g+'" data-element="icon"></span>');f=a.defaultStyle.item.content.normal;a.options.controlStyle.item.content.normal!=f&&(f+=" "+a.options.controlStyle.item.content.normal);g=a.getCurrentItemContentStyle(a.currentList[b],"normal");a.currentList[b].content?(e+='<div class="'+f+" "+g+'" data-element="content">',e+=a.currentList[b][a.options.dataFields.content],e+="</div>"):(e+='<span class="'+f+" "+g+'" data-element="content"',!c&&a.currentList[b].contextMenu&&(e+=' iui-contextmenu menu-items="data['+b+'].contextMenu"'),e+=">",e=c?e+a.currentList[b][a.options.dataFields.text]:e+("{{data["+b+"]."+a.options.dataFields.text+"}}"),e+="</span>");return e+="</li>"},P=0,Z=function(){if(1==a.options.showCheckBoxes){var c=angular.element(b('<iui-checkbox style="position:absolute;top:-9999px"></iui-checkbox>')(h));f.append(c);P=0;c&&0<c.children().length&&(P=parseInt(getComputedStyle(angular.element(c.children().eq(0))[0]).width,10));c.remove()}};a.updateView=function(c){var e=g(function(){H||T();l();p.empty();q&&q.$destroy();U(!1);a.currentList.length>=r&&m+r-1>a.currentList.length&&(m=a.currentList.length-r+1);if(m<a.currentList.length){q=h.$new();q.data=a.currentList;q.checkBoxStyle=a.options.checkBoxSettings.style;!q.checkBoxStyle&&a.options.controlStyle.item.checkBox&&(q.checkBoxStyle=a.options.controlStyle.item.checkBox);y=0;var c="";firstItemElem=c=null;for(var u=d.getMargin(),k=0,n=m;n<m+r&&n<a.currentList.length;n++)c=W(n),c=a.currentList[n].content?b(c)(h.$parent):b(c)(q),c=angular.element(c),p.append(c),u=d.getMargin(c[0]),k+=c[0].offsetHeight+(u.top+u.bottom),y++;if(0<y){n=null;c=p.find("li");if(0<c.length)for(var u=null,t=0;t<c.length;t++)u=angular.element(c[t]),(n=a.getItemFromElem(u))&&a.isItemEnabled(n)&&L(u);n=f[0].offsetHeight-6;v=k/y;r=Math.floor(n/v)+1;T()}a.refresh()}g.cancel(e)},1)};a.refresh=function(b){if(b){var c=null;switch(b.type){case "item":if(c=a.getElemFromItem(b)){c.removeAttr("class");c.addClass(a.defaultStyle.item.general.normal);c.addClass(a.options.controlStyle.item.general.normal);var d=a.getCurrentItemStyle(b,a.getObjState(b));d!=a.options.controlStyle.item.general.normal&&c.addClass(d);if(c=a.getElement(c))c.removeAttr("class"),c.addClass(a.defaultStyle.item.content.normal),c.addClass(a.options.controlStyle.item.content.normal),d=a.getCurrentItemContentStyle(b,a.getObjState(b)),d!=a.options.controlStyle.item.content.normal&&c.addClass(d)}}}else for(b=m;b<m+r&&b<a.currentList.length;b++)a.refresh(a.currentList[b])};var Q=!1,K=0,R=null,S=.5;a.isScrollBarVisible=function(){return z};a.scrollPos={x:0,y:0};a.getScrollPos=function(){return a.scrollPos};a.setScrollPos=function(b){b&&(b.x=0,0>b.y&&(b.y=0),b.y>G.y&&(b.y=G.y),a.scrollPos=b,O=Math.floor(a.scrollPos.y/(v*M)),b=C+O,z&&t&&t.css("top",b+"px"),U(),angular.isDefined(h.events)&&h.events.scrollPosChanged?h.events.scrollPosChanged({scrollPos:a.scrollPos}):h.scrollposChanged({e:{scrollPos:a.scrollPos}}))};var Y=function(b,c,d){Q||(K=0,Q=!0,R=A(function(){var d=c,e=a.getScrollPos();d||(0===K&&(K=5),K+=5+M,S+=.5,d=K+=Math.floor(S));e.y=b?e.y+d:e.y-d;a.setScrollPos(e);(0>=e.y||a.getScrollPos().y<e.y)&&V()},d?d:100))},V=function(){Q&&(R&&(A.cancel(R),R=null),Q=!1,K=0,S=.5)};a.cancelScrollTimer=function(){V()};a.scrollTo=function(b,c){if(b){var d=a.getItemCurrentIndex(b);if(a.isIndexInRange(d)){var e=0,f=d;switch(c){case "center":e=Math.floor(y/2);f=d>e?d-e:0;break;case "bottom":e=y-2,f=d>e?d-e:0}var h=g(function(){a.setScrollPos({x:a.scrollPos.x,y:f*v});g.cancel(h)},1)}}};var U=function(b,c){if(!(0==b&&0>=v)){newIndex=0<v?Math.floor(a.scrollPos.y/v):0;if(c||newIndex+r-1>a.currentList.length)newIndex=a.currentList.length-r+1;0>newIndex&&(newIndex=0);newIndex!==m&&(m=newIndex,0!=b&&a.updateView(!0))}};f.bind("scroll",function(a){f[0].scrollTop=0;f[0].scrollLeft=0});f.bind("mousewheel",function(b){b.preventDefault();a.hoverItem=null;var c=0;b.wheelDelta?c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail)):b.originalEvent&&(c=Math.max(-1,Math.min(1,b.originalEvent.wheelDelta||-b.originalEvent.detail)));a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(f[0].clientHeight/4)*c*-1});g(function(){var c=d.getMousePos(b),f=angular.element(e)[0].pageXOffset,g=angular.element(e)[0].pageYOffset;c.x-=f;c.y-=g;if(c=a.getItemAt(c.x,c.y))a.hoverItem=c,a.refresh()},1)});angular.element(e).bind("mousemove",function(b){if(H&&1===b.which){t[0].getBoundingClientRect();b=d.getMousePos(b);B.scrollMousePos||(B.scrollMousePos=b);var c=t[0].offsetTop+(b.y-B.scrollMousePos.y);c<C?c=C:c+t[0].offsetHeight>w&&(c=w-t[0].offsetHeight);t.css("top",c+"px");B.scrollMousePos=b;O=c-C;a.scrollPos.y=c+t[0].offsetHeight>=w?G.y:Math.floor(O*M*v);U(!0,a.scrollPos.y==G.y)}});angular.element(e).bind("mouseup",function(b){H&&a.updateView();V();B.scrollMousePos=null;H=!1});angular.isDefined(h.options)?a.updateOptions(h.options):(0==h.allowFocus&&(a.options.allowFocus=h.allowFocus),angular.isDefined(h.checkboxSettings)&&a.updateCheckBoxSettings(h.checkboxSettings),angular.isDefined(h.controlStyle)&&a.updateControlStyle(h.controlStyle),angular.isDefined(h.fields)&&(a.updateDataFields(h.fields),a.updateData()),angular.isDefined(h.itemIcon)&&(a.options.itemIcon=h.itemIcon),angular.isDefined(h.navSelection)&&(a.options.navSelection=h.navSelection),!0===h.rtl&&(a.options.rtl=h.rtl),angular.isDefined(h.selectedIndex)&&(a.options.selectedIndex=h.selectedIndex),angular.isDefined(h.selectedItem)&&(a.options.selectedItem=h.selectedItem),!0===h.showCheckBoxes&&(a.options.showCheckBoxes=h.showCheckBoxes),!1===h.showIcons&&(a.options.showIcons=h.showIcons));a.updateLayout()}}}]);