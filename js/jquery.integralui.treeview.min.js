/*
  filename: jquery.integralui.treeview.min.js
  version : 1.0.038
  Copyright © 2014 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
(function(f){f.widget("integralui.treeview",f.integralui.widget,{version:"1.0.038",options:{allowDrag:!1,allowDrop:!0,animationSpeed:200,dataFields:{content:"content",dataSource:null,expanded:"expanded",icon:"icon",id:"id",pid:"pid",statusIcon:"statusIcon",text:"text"},hoverSelection:!1,indent:5,itemIcon:"",itemSpacing:1,pathSeparator:"\\",rtl:!1,selectedIndex:-1,selectedItem:null,showIcons:!0,showStatusIcons:!1},_create:function(){this._super();dragItem=null;draggingStarted=!1;this.fullList=this.elemList=sourceTree=null;this.itemClass={content:{normal:"iui-treeview-item-content",hovered:"iui-treeview-item-content-hovered",selected:"iui-treeview-item-content-selected"},normal:"iui-treeview-item",hovered:"iui-treeview-item-hovered",selected:"iui-treeview-item-selected",disabled:"iui-treeview-item-disabled",expand:"iui-treeview-expand",collapse:"iui-treeview-collapse"};this.widgetName="treeview";this.element.addClass("iui-treeview");this.popupWindow=f("<div class='iui-treeview-drop-marker'><p class='iui-treeview-drop-marker-left'></p><p class='iui-treeview-drop-marker-middle'></p><p class='iui-treeview-drop-marker-right'></p></div>");this.selElem=null;this.dragSize={width:6,height:6};this.dragBounds={top:-1,right:-1,bottom:-1,left:-1};this.expandBoxSpace=0;this.hoverItem=this.hoverContentElem=null;this.mousePos={x:-1,y:-1};this.prevHoverItem=this.prevHoverContentElem=null;this.tempIndex=this.prevSelectedIndex=-1;this.hoverCount=0;this._initFromHTML()||(this.$root=f("<ul></ul>"),this.element.append(this.$root),this.suspendLayout(),this.options.dataFields&&this.loadData(this.options.dataFields.dataSource),this.resumeLayout());this.element.append(this.$tw);this._s1t(this.twp)},_bindEvents:function(){var a=this;a.element.off("clear mouseenter mouseleave mousemove mouseup itemremoving itemremoved scroll").on({mouseenter:function(b){a._mouseEnter(b)},mouseleave:function(b){a._mouseLeave(b)},mousemove:function(b){a._mouseMove(b)},mouseup:function(b){a._mouseUp(b)},scroll:function(){a._updateCurrentElements();a._triggerEvent("scrollposchanged")},clear:function(b){a.option("selectedItem",null)},itemremoving:function(b){a.prevSelectedIndex=a.options.selectedIndex},itemremoved:function(b){b=Math.max(Math.min(a.prevSelectedIndex,a.currentList.length-1),0);a.option("selectedIndex",b);0===a.currentList.length&&a._triggerEvent("selectionchanged")}});f("body").off("mouseup").on({mouseup:function(){a.popupWindow.remove();dragItem=sourceTree=null;draggingStarted=!1}})},_destroy:function(){this._stopHoverTimer();this._stopScrollTimer();this.element.off("clear mouseenter mouseleave mousemove mouseup itemremoving itemremoved scroll");0<this.fullList.length&&this.fullList.removeUniqueId();this.element.empty();this._super()},_initFromHTML:function(){this.$root=this.element.children("ul:first-of-type");return 0<this.$root.length?(this.allowUpdate=!1,this._initRecur(this.$root.children("li"),null),this.allowUpdate=!0,this.refresh(),!0):!1},_initRecur:function(a,b){var c=this;a.each(function(a,e){var h=c._extractItem(e,b);c.addItem(h,b);var g=f(e).children("ul").children("li");c._initRecur(g,h)})},_extractItem:function(a,b){var c=f(a),d="",e="",h="",g="",k=null;c.attr("id")||c.uniqueId();this.options.showStatusIcons&&(k=c.children("[data-element='statusIcon']"),0<k.length&&(h=this._outerHtml(k)));this.options.showIcons&&(k=c.children("[data-element='icon']"),0<k.length&&(e=this._outerHtml(k)));k=c.children("[data-element='content']");0<k.length?(d=this._outerHtml(k),g=k.text()):(k=c.children("span:last-of-type"),0<k.length&&(g=k.text()));return{content:d,expanded:this._getExpandValue(c.attr("data-expanded")),icon:e,id:c.attr("id"),pid:null!==b?b.id:"",statusIcon:h,text:g}},_setOption:function(a,b){switch(a){case "allowDrag":if(!0!==b&&!1!==b)return;this.options.allowDrag=b;break;case "allowDrop":if(!0!==b&&!1!==b)return;this.options.allowDrop=b;break;case "hoverSelection":if(!0!==b&&!1!==b)return;this.options.hoverSelection=b;break;case "indent":if(!f.isNumeric(b)||0>b||255<b)return;this.options.indent=b;this.refresh();break;case "itemIcon":this.options.itemIcon=b;this.refresh();break;case "itemSpacing":if(!f.isNumeric(b)||0>b||255<b)return;this.options.itemSpacing!==b&&(this.options.itemSpacing=b,this._updateItemSpacing(b));this.refresh();break;case "pathSeparator":this.options.pathSeparator!==b&&(this.options.pathSeparator=b);break;case "rtl":if(!0!==b&&!1!==b)return;this.options.rtl=b;this.refresh();break;case "selectedIndex":if(this._isIndexInRange(b))this._selectItem(this.currentList[b]);else return;break;case "selectedItem":if(!this._selectItem(b))return;break;case "showIcons":if(!0!==b&&!1!==b)return;this.options.showIcons=b;this.refresh();break;case "showStatusIcons":if(!0!==b&&!1!==b)return;this.options.showStatusIcons=b;this.refresh()}this._super(a,b)},_selectItem:function(a){if(!1!==this._triggerEvent("beforeselect",a)&&this.options.selectedItem!==a){var b=null;this.options.selectedItem&&(b=this._getContentElem(this.fullList.filter("li:eq("+f.inArray(this.options.selectedItem,this.currentList)+")")),0<b.length&&b.removeClass(this.itemClass.content.selected));this.options.selectedItem=a;this.options.selectedItem&&(b=this._getContentElem(this.fullList.filter("li:eq("+f.inArray(this.options.selectedItem,this.currentList)+")")),0<b.length&&b.addClass(this.itemClass.content.selected));this.options.selectedIndex=this.options.selectedItem?f.inArray(this.options.selectedItem,this.currentList):-1;a&&this._triggerEvent("afterselect",a);this._triggerEvent("selectionchanged");return!0}return!1},_mouseEnter:function(a){if(draggingStarted){var b=f.Event("dragenter",{dragItem:dragItem,mousePos:{x:a.pageX,y:a.pageY}});this.element.trigger(b);0===this.element.find(this.popupWindow).length&&this.element.append(this.popupWindow);this.popupWindow.hide();this.element.addClass("cursor-move")}else this.element.removeClass("cursor-move cursor-add cursor-no-drop");a.stopPropagation()},_mouseLeave:function(a){this.element.removeClass("cursor-move cursor-add cursor-no-drop");this._stopHoverTimer();this._stopScrollTimer();draggingStarted&&(this.popupWindow.hide(),a=f.Event("dragleave",{dragItem:dragItem,mousePos:{x:a.pageX,y:a.pageY}}),this.element.trigger(a))},_mouseMove:function(a){draggingStarted&&(a=f.Event("dragover",{dragItem:dragItem,targetItem:null,isDropAllowed:this._isDropAllowed(),dropPos:-1,mousePos:{x:a.pageX,y:a.pageY}}),this.element.trigger(a))},_mouseUp:function(a){this._completeDragDrop(a);a.stopPropagation()},_itemMouseEnter:function(a,b){this.hoverItem=this.findItemById(b.attr("id"),!0);draggingStarted||this.element.removeClass("cursor-move cursor-add cursor-no-drop");a.stopPropagation()},_itemMouseLeave:function(a,b,c){this.hoverItem=null;c.removeClass(this.itemClass.content.hovered);draggingStarted&&(this.popupWindow.hide(),this.element.removeClass("cursor-add cursor-no-drop"),dragItem&&this.element.addClass("cursor-move"));a.stopPropagation()},_itemMouseMove:function(a,b){draggingStarted&&(this.popupWindow.hide(),this.element.removeClass("cursor-add cursor-no-drop"),dragItem&&this.element.addClass("cursor-move"));this._processScroll(a);a.stopPropagation()},_itemMouseDown:function(a,b,c){var d=b.offset(),e=a.pageX-d.left,d=a.pageY-d.top,h=this._getPaddingValue(b);c={top:0,right:h.left,left:0,bottom:c};0===c.bottom&&(c.bottom=16);this.options.rtl&&(c.right=b.outerWidth(),c.left=c.right-h.right);this._hitTest(e,d,c)&&this.toggle(this.findItemById(b.attr("id"),!0));a.stopPropagation()},_itemContentClick:function(a,b){var c=this.findItemById(b.attr("id"),!0);c&&1===a.which&&this._triggerEvent("itemclick",c,{x:a.pageX,y:a.pageY});a.stopPropagation()},_itemContentDblClick:function(a,b){var c=this.findItemById(b.attr("id"),!0);c&&1===a.which&&(this.toggle(c),this._triggerEvent("itemdblclick",c,{x:a.pageX,y:a.pageY}));a.stopPropagation()},_itemContentMouseEnter:function(a,b,c){this.hoverItem=this.findItemById(b.attr("id"),!0);c.addClass(this.itemClass.content.hovered);this._triggerEvent("itemhover",this.hoverItem);this._startHoverTimer();a.stopPropagation()},_itemContentMouseLeave:function(a,b,c){c.removeClass(this.itemClass.content.hovered);this._stopHoverTimer();a.stopPropagation()},_itemContentMouseMove:function(a,b){var c=b.offset();this.mousePos.x=a.pageX-c.left;this.mousePos.y=a.pageY-c.top;this._processDragItem(a);this._processScroll(a);a.stopPropagation()},_itemContentMouseDown:function(a,b){var c=this.findItemById(b.attr("id"),!0);if(c)switch(a.which){case 1:this.option("selectedItem",c);draggingStarted=!1;this.dragBounds=this.options.allowDrag?{left:this.mousePos.x-this.dragSize.width/2,top:this.mousePos.y-this.dragSize.height/2,right:this.mousePos.x+this.dragSize.width/2,bottom:this.mousePos.y+this.dragSize.height/2}:{top:-1,right:-1,bottom:-1,left:-1};break;case 3:this._triggerEvent("itemrightclick",c,{x:a.pageX,y:a.pageY})}a.stopPropagation()},_itemContentMouseUp:function(a){this._completeDragDrop(a);this._stopScrollTimer();a.stopPropagation()},_itemRebindEvents:function(){var a=this;a.elemList&&a.elemList.each(function(b){var c=f(this),d=a._getContentElem(c),e=0;0<d.length&&(e=d.height());c.off("mouseenter mouseleave mousemove mousedown").on({mouseenter:function(b){a._itemMouseEnter(b,c)},mouseleave:function(b){a._itemMouseLeave(b,c,d)},mousemove:function(b){a._itemMouseMove(b,d)},mousedown:function(b){a._itemMouseDown(b,c,e)}});if(0<d.length)d.off("click dblclick mouseenter mouseleave mousemove mousedown mouseup").on({click:function(b){a._itemContentClick(b,c)},dblclick:function(b){a._itemContentDblClick(b,c)},mouseenter:function(b){a._itemContentMouseEnter(b,c,d)},mouseleave:function(b){a._itemContentMouseLeave(b,c,d)},mousemove:function(b){a._itemContentMouseMove(b,d)},mousedown:function(b){a._itemContentMouseDown(b,c)},mouseup:function(b){a._itemContentMouseUp(b,c)}})})},addItem:function(a,b){this._add(a,b)},clearItems:function(a){this._clear(a)},insertItemAfter:function(a,b){this._insertAfter(a,b)},insertItemAt:function(a,b,c){this._insertAt(a,b,c)},insertItemBefore:function(a,b){this._insertBefore(a,b)},removeItem:function(a){this._remove(a)},removeItemAt:function(a,b){this._removeAt(a,b)},loadData:function(a){var b=this,c=[];b.clearItems();a&&(a.forEach(function(a,e){var f={content:a[b.options.dataFields.content],expanded:a[b.options.dataFields.expanded],icon:a[b.options.dataFields.icon],id:a[b.options.dataFields.id],pid:a[b.options.dataFields.pid],text:a[b.options.dataFields.text],statusIcon:a[b.options.dataFields.statusIcon]},g=f.pid;if(null!==c[g]&&void 0!==c[g]){if(null===c[g].items||void 0===c[g].items)c[g].items=[];c[a.id]=f;c[g].items.push(f)}else c[a.id]=f,b.items.push(f)}),b.refresh());c.length=0},_completeDragDrop:function(a){this.options.allowDrop&&dragItem&&(this._processDropItem(a),dragItem=sourceTree=null);draggingStarted=!1;this.dragBounds={top:-1,right:-1,bottom:-1,left:-1};this.popupWindow.remove();this.element.removeClass("cursor-move cursor-add cursor-no-drop")},_getDropPos:function(a){if(a){var b=this.fullList.filter("li:eq("+f.inArray(a,this.currentList)+")");a=this._getElemBounds(b);b=this._getContentElem(b);0<b.length&&(a.y=2,a.height=b.outerHeight());var b={left:0,top:a.y+a.height/4+1,right:a.width,bottom:3*a.height/4-1},c=this.getScrollPos();this.options.rtl?(b.left=-9999,b.right=9999):0<c.x&&(b.right+=c.x);if(this._hitTest(this.mousePos.x,this.mousePos.y,b))return 0;b.bottom=b.top;b.top=0;if(this._hitTest(this.mousePos.x,this.mousePos.y,b))return 1;b.top=3*a.height/4-2;b.bottom=a.height-1;if(this._hitTest(this.mousePos.x,this.mousePos.y,b))return 2}return-1},_isDropAllowed:function(a){if(dragItem&&a){if(a===dragItem)return!1;for(a=this._getParent(a);null!=a;){if(a===dragItem)return!1;a=this._getParent(a)}}return draggingStarted&&this.options.allowDrop},_processDragItem:function(a){var b=this;b._startDragItem();if(draggingStarted&&null!==b.popupWindow&&void 0!==b.popupWindow&&(0===b.element.find(b.popupWindow).length&&(b.element.append(b.popupWindow),b.popupWindow.hide()),dragItem)){b.element.addClass("cursor-move");var c=this.hoverItem,d=b._isDropAllowed(c);a=f.Event("dragover",{dragItem:dragItem,targetItem:c,isDropAllowed:d,dropPos:e,mousePos:{x:a.pageX,y:a.pageY}});b.element.trigger(a);if(d)if(c){b.element.removeClass("cursor-no-drop");var e=b._getDropPos(c);if(0===e)b.element.addClass("cursor-add"),b.popupWindow.hide();else if(1===e||2===e){b.element.removeClass("cursor-add");var h=f.inArray(c,b.currentList),c=b.fullList.filter("li:eq("+h+")"),g=b._getElemBounds(c),c=b._getMarginValue(c);g.y+=c.top;c=0;b.isScrollBarVisible("vertical")&&(d=b.element.width(),a=b.$root.outerWidth(!0),a<d&&(c=d-a));d=b.getScrollPos();b.options.rtl||(g.width=0<d.x?b.element.width()-c-b.expandBoxSpace-g.x:g.width-2);a={top:function(){return 1===e?0===h?b.element.scrollTop()+g.y-3+"px":b.element.scrollTop()+g.y-3-b.options.itemSpacing/2+"px":b.element.scrollTop()+g.y+g.height-3+b.options.itemSpacing/2+"px"},width:g.width+"px"};a.left=b.options.rtl?g.x-c+"px":d.x+g.x+b.expandBoxSpace+1+"px";b.popupWindow.css(a).show()}}else b.element.removeClass("cursor-add cursor-no-drop");else b.element.addClass("cursor-no-drop"),b.popupWindow.hide()}},_processDropItem:function(a){var b=this.hoverItem,c=this._isDropAllowed(b),d=this._getDropPos(b);a=f.Event("dragdrop",{dragItem:dragItem,targetItem:b,isDropAllowed:c,dropPos:d,mousePos:{x:a.pageX,y:a.pageY}});this.element.trigger(a);if(c&&!1!==a.result){var e=dragItem;if(0===d&&b&&b.items)for(c=0;c<b.items.length;c++)if(b.items[c]===e)return;sourceTree?sourceTree.removeItem(dragItem):this.removeItem(dragItem);b?0===d?(e.pid=b.id,this.addItem(e,b)):1===d||2===d?(c=this._getParent(b),e.pid=c?c.id:"",1===d?this.insertItemBefore(e,b):this.insertItemAfter(e,b)):(e.pid="",this.addItem(e)):(e.pid="",this.addItem(e))}this.option("selectedItem",e)},_startDragItem:function(){if(this.options.allowDrag&&!draggingStarted&&this.hoverItem){var a=f.inArray(this.hoverItem,this.currentList);!this._isIndexInRange(a)||this._isEmpty(this.dragBounds)||this._hitTest(this.mousePos.x,this.mousePos.y,this.dragBounds)||(draggingStarted=!0,this.dragBounds={top:-1,right:-1,bottom:-1,left:-1},sourceTree=this,dragItem=this.hoverItem,this.dragBounds.right>this.dragBounds.left&&this.dragBounds.bottom>this.dragBounds.top&&(this.element.append(this.popupWindow),this.popupWindow.hide()))}},collapseAll:function(){this.suspendLayout();this._changeExpanded(!1);this.resumeLayout()},collapse:function(a){var b=this;if(a&&this._getExpandValue(a.expanded)){var c=f.inArray(a,b.currentList);if(b._isIndexInRange(c)&&!1!==b._triggerEvent("beforecollapse",a)){a.expanded=!1;var d=b.fullList.filter("[id="+a.id+"]"),e=b._getNextItem(a),h=-1;e&&(h=f.inArray(e,b.currentList));b._isIndexInRange(h)||(h=b.currentList.length);b.currentList.splice(c+1,h-c-1);var g=d.children("ul");b.options.rtl?d.removeClass(b.itemClass.collapse+"-rtl").addClass(b.itemClass.expand+"-rtl"):d.removeClass(b.itemClass.collapse).addClass(b.itemClass.expand);b.options.allowAnimation?(g.find("[data-element='statusIcon']").hide(),g.animate({height:0},{duration:b.options.animationSpeed,queue:!1,progress:function(){b._updateStatusIconLayout()},complete:function(){g.remove();b._updateWholeLayout();g.find("[data-element='statusIcon']").show();b._triggerEvent("aftercollapse",a)}})):(g.remove(),b._updateWholeLayout(),b._triggerEvent("aftercollapse",a))}}},_changeExpanded:function(a,b){for(var c=this.getList(b),d=0;d<c.length;d++)c[d].expanded=a,this._changeExpanded(a,c[d])},expandAll:function(){this.suspendLayout();this._changeExpanded(!0);this.resumeLayout()},expand:function(a){var b=this;if(a&&!this._getExpandValue(a.expanded)){var c=f.inArray(a,b.currentList);if(b._isIndexInRange(c)&&!1!==b._triggerEvent("beforeexpand",a)){a.expanded=!0;var d=b.fullList.filter("[id="+a.id+"]"),e=b.currentList[c].items;if(e){var h=f("<ul></ul>");this.tempIndex=c+1;for(c=0;c<e.length;c++)b._addItemToList(e[c]);for(var g=[],c=0;c<e.length;c++)g.push(b._createElement(e[c]));h.append(g);g.length=0;b.options.rtl?d.removeClass(b.itemClass.expand+"-rtl").addClass(b.itemClass.collapse+"-rtl").append(h):d.removeClass(b.itemClass.expand).addClass(b.itemClass.collapse).append(h);b._updateWholeLayout();if(b.options.allowAnimation){var k=d.html(),e=h.height();h.find("[data-element='statusIcon']").hide();h.css("height",0).show().animate({height:e+"px"},{duration:b.options.animationSpeed,queue:!1,progress:function(){b._updateStatusIconLayout()},complete:function(){d.html(k);h.show();b._updateWholeLayout();h.find("[data-element='statusIcon']").show();b._triggerEvent("afterexpand",a)}})}else b._triggerEvent("afterexpand",a)}}}},toggle:function(a){a&&a.items&&(0===a.items.length?a.expanded=!1:this._getExpandValue(a.expanded)?this.collapse(a):this.expand(a))},findItemById:function(a,b){return this._findItemById(a,b)},findItemByText:function(a,b){return this._findItemByText(a,b)},_addItemToList:function(a){var b=this;b.currentList.splice(b.tempIndex,0,a);b.tempIndex++;a.items&&0<a.items.length&&b.isItemExpanded(a)&&a.items.forEach(function(a,d){b._addItemToList(a)})},_getContentElem:function(a){var b=a.children("[data-element='content']");0===b.length&&(b=a.children("span:last-of-type"));return b},_getElemBounds:function(a,b){var c={x:0,y:0,width:0,height:0};a&&(c=a.position(),c={x:c.left,y:c.top,width:a.width(),height:a.height()},b&&(c.width=a.outerWidth(),c.height=a.outerHeight()));return c},_getExpandValue:function(a){return null===a||void 0===a||"true"===a?!0:"false"===a?!1:a},_getIconSize:function(a){var b={width:0,height:0},c="";this.options.itemIcon?c=this.options.itemIcon:this._isIndexInRange(a)&&(c=this.currentList[a].icon);c&&(a=f(c),this.element.append(a),b.width=a.outerWidth(),b.height=a.outerHeight(),a.remove());return b},_isEmpty:function(a){return null===a|void 0===a?!1:-1===a.left&&-1===a.top&&-1===a.right&&-1===a.bottom?!0:!1},_isStatusIconPresent:function(){return 0<this.$root.find("[data-element='statusIcon']").length?!0:!1},ensureVisible:function(a){if(a){if(!this.isItemVisible(a)){var b=this.options.allowAnimation;this.options.allowAnimation=!1;for(var c=[],d=this.getItemParent(a);d;)c.push(d),d=this.getItemParent(d);for(d=c.length-1;0<=d;d--)this.expand(c[d]);this.options.allowAnimation=b}a=this.getItemElement(a);0<a.length&&(a=a.position(),tempPos={x:a.left+this.element.scrollLeft()-this.element.width()/2,y:a.top+this.element.scrollTop()-this.element.height()/2},this.setScrollPos(tempPos))}},getFullPath:function(a){if(a){var b=a.text;for(a=this.getItemParent(a);a;)b=[a.text,this.options.pathSeparator,b].join(""),a=this.getItemParent(a);return b}return""},getItemAt:function(a,b){if(this.elemList)for(var c=0;c<this.elemList.length;c++){var d=f(this.elemList[c]),e=this._getContentElem(d),h=d.position(),e={left:h.left,top:h.top,right:h.left+d.innerWidth(),bottom:h.top+e.height()};if(this._hitTest(a,b,e))return this.findItemById(d.attr("id"),!0)}return null},getItemElement:function(a){return a?this.fullList.filter("[id='"+a.id+"']"):null},getItemLevel:function(a){var b=0;for(a=this.getItemParent(a);a;)b++,a=this.getItemParent(a);return b},isItemVisible:function(a){return this.findItemById(a.id,!0)?!0:!1},_processScroll:function(a){var b=this.element.offset();a=a.pageY-b.top;b=this.element.height();10>a?this._startScrollTimer(!1):a>b-10?this._startScrollTimer(!0):this._stopScrollTimer()},getScrollPos:function(){return{x:this.element.scrollLeft(),y:this.element.scrollTop()}},isScrollBarVisible:function(a){var b=this.element.width(),c=this.element.height(),d=this.$root.outerWidth(!0),e=this.$root.outerHeight(!0);switch(a){case "horizontal":if(d<b)return!0;break;case "vertical":if(e>c)return!0;break;default:if(d>b||e>c)return!0}return!1},setScrollPos:function(a){a&&this.element.scrollLeft(a.x).scrollTop(a.y)},_checkExpandState:function(a){return this._getExpandValue(a.expanded)},isItemExpanded:function(a){return this._checkExpandState(a)},_hoverTimerElapsed:function(){this.hoverCount+=100;500<this.hoverCount&&(this.hoverItem&&(this.options.hoverSelection&&this.option("selectedItem",this.hoverItem),draggingStarted&&this.expand(this.hoverItem)),this._stopHoverTimer())},_startHoverTimer:function(){if(draggingStarted||this.options.hoverSelection){var a=this;a.hoverCount=0;a.hoverTimerID=setInterval(function(){a._hoverTimerElapsed()},100)}},_stopHoverTimer:function(){this.hoverTimerID&&clearInterval(this.hoverTimerID);this.hoverCount=0},_scrollTimerElapsed:function(a){var b=this.element.scrollTop(),c=b;0===this.scrollCount&&(this.scrollCount=5);this.scrollCount+=10;b=a?b+this.scrollCount:b-this.scrollCount;this.element.scrollTop(b);this.element.scrollTop()===c&&this._stopScrollTimer()},_startScrollTimer:function(a){var b=this;!b.isScrollTimerActive&&draggingStarted&&(b.scrollCount=0,b.isScrollTimerActive=!0,b.scrollTimerID=setInterval(function(){b._scrollTimerElapsed(a)},100))},_stopScrollTimer:function(){this.scrollTimerID&&clearInterval(this.scrollTimerID);this.isScrollTimerActive=!1;this.scrollCount=0},_createElement:function(a){var b=this;if(!a.id){var c=f("<li></li>");c.uniqueId();a.id=c.attr("id");c.remove()}var d="<li id="+a.id;a.pid&&(d+=" data-pid="+a.pid);d+=" class='"+b.itemClass.normal;a.items&&0<a.items.length&&(d=b.isItemExpanded(a)?d+(" "+b.itemClass.collapse):d+(" "+b.itemClass.expand),b.options.rtl&&(d+="-rtl"));d+="'";a.expanded=b._getExpandValue(a.expanded);a.expanded||(d+=" data-expanded=false");d+=">";b.options.showStatusIcons&&a.statusIcon&&(d+=a.statusIcon);b.options.showIcons&&(a.icon?d+=a.icon:b.options.itemIcon&&(d+=b.options.itemIcon));d=a.content?d+a.content:d+("<span class='"+b.itemClass.content.normal+"'>"+a.text+"</span>");a.items&&0<a.items.length&&b.isItemExpanded(a)&&(d+="<ul>",a.items.forEach(function(a,c){d+=b._createElement(a)}),d+="</ul>");return d+="</li>"},_performRefreshBefore:function(a,b,c,d,e){if(this._isUpdateAllowed())switch(a){case "remove":b&&(a=f.inArray(b,this.currentList),b=this._getNextItem(b),d=-1,b&&(d=f.inArray(b,this.currentList)),this._isIndexInRange(d)||(d=this.currentList.length),this.currentList.splice(a,d-a),0<=a&&this.fullList.filter("li:eq("+a+")").remove(),c&&c.items&&1>=c.items.length&&this.fullList.filter("li:eq("+f.inArray(c,this.currentList)+")").removeClass(this.itemClass.collapse+" "+this.itemClass.collapse+"-rtl "+this.itemClass.expand+" "+this.itemClass.expand+"-rtl"))}},_peformInsertAsChild:function(a,b){var c=null,d=-1;b&&(d=f.inArray(b,this.currentList),c=this.fullList.filter("li:eq("+d+")"));if(c&&0<c.length&&b&&b.items)if(this._getExpandValue(b.expanded)){var e=c.children("ul");0===e.length&&(e=f("<ul></ul>"),c.append(e));this.tempIndex=d+b.items.length;this._addItemToList(a);e.append(this._createElement(a));this.options.rtl?c.removeClass(this.itemClass.expand+"-rtl").addClass(this.itemClass.collapse+"-rtl"):c.removeClass(this.itemClass.expand).addClass(this.itemClass.collapse)}else this.options.rtl?c.removeClass(this.itemClass.collapse+"-rtl").addClass(this.itemClass.expand+"-rtl"):c.removeClass(this.itemClass.collapse).addClass(this.itemClass.expand);else this._peformInsertAtEnd(a)},_peformInsertAtSpecificPos:function(a,b,c,d){c=f.inArray(c,this.currentList);0<=c&&($targetElem=this.fullList.filter("li:eq("+c+")"));if($targetElem&&0<$targetElem.length){if(d)if($targetElem=$targetElem.next("li"),d=this.findItemById($targetElem.attr("id"),!0))this.tempIndex=f.inArray(d,this.currentList);else{this._peformInsertAsChild(a,b);return}else this.tempIndex=c;$targetElem&&0<$targetElem.length?(this._addItemToList(a),$targetElem.before(this._createElement(a))):this._peformInsertAtEnd(a)}else this._peformInsertAtEnd(a)},_peformInsertAtEnd:function(a){this.tempIndex=this.currentList.length;this._addItemToList(a);this.$root.append(this._createElement(a))},_performRefreshAfter:function(a,b,c,d,e){if(this._isUpdateAllowed())switch(a){case "add":b&&(d?this._peformInsertAtSpecificPos(b,c,d,e):c?this._peformInsertAsChild(b,c):this._peformInsertAtEnd(b))}},refresh:function(){this._super();var a=this;if(a._isUpdateAllowed()){a.$root.empty();var b=[];a.getList().forEach(function(c,d){b.push(a._createElement(c))});a.$root.append(b);b.length=0;a.element.append(a.$tw);a._updateWholeLayout()}},_updateCurrentElements:function(){var a=this.fullList.length;0<a&&(this.leftIndex=0,this.middleIndex=Math.floor(a/2),this.rightIndex=a,a=this._checkRange(this.middleIndex),this.elemList=this.fullList.slice(a,a+100),this._itemRebindEvents())},_checkRange:function(a){0<=f(this.fullList[a]).position().top?this.rightIndex=a:this.leftIndex=a;this.middleIndex=this.leftIndex+Math.floor((this.rightIndex-this.leftIndex)/2);return 1>this.middleIndex-this.leftIndex?this.leftIndex:1>this.rightIndex-this.middleIndex?this.middleIndex:this._checkRange(this.middleIndex)},_updateItemSpacing:function(a){var b=this;--a;this.$root.find("li").css({"margin-top":a+"px","margin-bottom":a+"px"});this.$root.children("li:first-child").css("margin-top","0");this.$root.find("li:last-child").css("margin-bottom","0");b.$root.find("li").each(function(a){var d=f(this),e=0;0<b._getIconSize(a).width&&(e=2,a=b._getContentElem(d),0<a.length&&(e+="px",b.options.rtl?a.css("margin-right",e):a.css("margin-left",e)))})},updateLayout:function(a){if(!this.suppressCallBack){if(a){var b=f.inArray(a,this.currentList);this._getParent(a);0<=b&&(b=this.fullList.filter("li:eq("+b+")"),0<b.length&&b.replaceWith(this._createElement(a)))}this._updateWholeLayout()}},_updateStatusIconLayout:function(){var a=this;a.options.showStatusIcons?a.$root.find("[data-element='statusIcon']").css({position:"absolute",top:function(){var b=a.element.scrollTop();return f(this).parent().position().top+b+4+"px"},right:function(){return a.options.rtl?"3px":"auto"},left:function(){return a.options.rtl?"auto":"3px"}}):a.$root.find("[data-element='statusIcon']").hide()},_updateWholeLayout:function(){var a=this;a._isUpdateAllowed()&&(a._updateSelectedIndex(),a._isIndexInRange(a.options.selectedIndex)&&($contentElem=a._getContentElem(a.$root.find("li:eq("+a.options.selectedIndex+")")),0<$contentElem.length&&$contentElem.addClass(this.itemClass.content.selected)),a.expandBoxSpace=0,a.items.forEach(function(b,c){if(b.items&&0<b.items.length)return a.expandBoxSpace=16,!1}),a._updateItemSpacing(a.options.itemSpacing),a.options.rtl?(a.element.css({direction:"rtl"}),a.$root.css({direction:"rtl","padding-right":function(){return a.options.showStatusIcons&&a._isStatusIconPresent()?"16px":0}}).find("ul").css({"padding-left":0,"padding-right":a.options.indent+"px"}).end().find("li").css({"padding-left":0,"padding-right":a.expandBoxSpace+"px"}).find("[data-element='content']").addClass(a.itemClass.content.normal),a.$root.find("li.iui-treeview-expand").css({"background-position":"right 5px"}),a.$root.find("li.iui-treeview-collapse").css({"background-position":"right 2px"})):(a.element.css({direction:"ltr"}),a.$root.css({direction:"ltr","padding-left":function(){return a.options.showStatusIcons&&a._isStatusIconPresent()?"16px":0}}).find("ul").css({"padding-left":a.options.indent+"px","padding-right":0}).end().find("li").css({"padding-left":a.expandBoxSpace+"px","padding-right":0}).find("[data-element='content']").addClass(a.itemClass.content.normal)),a._updateStatusIconLayout(),a.fullList=a.$root.find("li"),a._updateCurrentElements())},_updateSelectedIndex:function(){if(0<this.currentList.length){if(0>this.options.selectedIndex&&this.options.selectedItem?this.options.selectedIndex=f.inArray(this.options.selectedItem,this.currentList):0<=this.options.selectedIndex&&!this.options.selectedItem&&this._isIndexInRange(this.options.selectedIndex)&&(this.options.selectedItem=this.currentList[this.options.selectedIndex]),0<=this.options.selectedIndex&&this.options.selectedItem){var a=f.inArray(this.options.selectedItem,this.currentList);this.options.selectedIndex!==a&&(this.options.selectedIndex=a)}}else this.options.selectedItem=null,this.options.selectedIndex=-1}})})(jQuery);