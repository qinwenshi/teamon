/*
  filename: angular.integralui.treegrid.min.js
  version : 2.2.0
  Copyright © 2014-2015 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUITreeGridService",["$rootScope",function(c){var d=null;return{addColumn:function(l,h){c.$broadcast(l+"-add-column",h)},clearColumns:function(l){c.$broadcast(l+"-clear-columns")},insertColumnAt:function(l,h,d){c.$broadcast(l+"-insert-column-at",h,d)},insertColumnBefore:function(l,h,d){c.$broadcast(l+"-insert-column-before",h,d)},insertColumnAfter:function(l,h,d){c.$broadcast(l+"-insert-column-after",h,d)},removeColumn:function(l,h){c.$broadcast(l+"-remove-column",h)},removeColumnAt:function(l,h){c.$broadcast(l+"-remove-column-at",h)},addRow:function(l,h,d){c.$broadcast(l+"-add-row",h,d)},clearRows:function(l,h){c.$broadcast(l+"-clear-rows",h)},insertRowAt:function(l,h,d,g){c.$broadcast(l+"-insert-row-at",h,d,g)},insertRowBefore:function(l,h,d){c.$broadcast(l+"-insert-row-before",h,d)},insertRowAfter:function(l,h,d){c.$broadcast(l+"-insert-row-after",h,d)},removeRow:function(l,d){c.$broadcast(l+"-remove-row",d)},removeRowAt:function(l,d,p){c.$broadcast(l+"-remove-row-at",d,p)},exportToJSON:function(l,d,p,g,N){c.$broadcast(l+"-export-json",d,p,g,N);l=this.getTempData();this.clearTempData();return l?l:""},loadData:function(l,d,p,g,N){c.$broadcast(l+"-load-data",d,p,g,N)},openEditor:function(l,d){c.$broadcast(l+"-open-editor",d)},closeEditor:function(l,d){c.$broadcast(l+"-close-editor",d)},collapse:function(l,d){c.$broadcast(l+"-collapse",d)},expand:function(l,d){c.$broadcast(l+"-expand",d)},expandColIndex:function(l,d){c.$broadcast(l+"-expand-col-index",d)},toggle:function(d,h){c.$broadcast(d+"-toggle",h)},filter:function(d,h,p){c.$broadcast(d+"-filter",h,p)},findRowById:function(d,h){c.$broadcast(d+"-find-row-by-id",h);var p=this.getTempData();this.clearTempData();return p?p:null},findRowByPath:function(d,h,p){c.$broadcast(d+"-find-row-by-path",h,p);d=this.getTempData();this.clearTempData();return d?d:null},findRowByText:function(d,h){c.$broadcast(d+"-find-row-by-text",h);var p=this.getTempData();this.clearTempData();return p?p:null},getRowParent:function(d,h){c.$broadcast(d+"-get-row-parent",h);var p=this.getTempData();this.clearTempData();return p?p:null},focus:function(d,h){c.$broadcast(d+"-focus",h)},clearTempData:function(){d=null},ensureVisible:function(d,h){c.$broadcast(d+"-ensure-visible",h)},getTempData:function(){return d},getRowLevel:function(d,h){c.$broadcast(d+"-get-row-level",h);var p=this.getTempData();this.clearTempData();return p?p:0},getFlatList:function(d,h){c.$broadcast(d+"-get-flat-list",h);var p=this.getTempData();this.clearTempData();return p?p:[]},getFullPath:function(d,h){c.$broadcast(d+"-get-full-path",h);var p=this.getTempData();this.clearTempData();return p?p:""},getList:function(d,h){c.$broadcast(d+"-get-list",h);var p=this.getTempData();this.clearTempData();return p?p:[]},setTempData:function(c){d=c},beginLoad:function(d,h){c.$broadcast(d+"-begin-load",h)},endLoad:function(d){c.$broadcast(d+"-end-load")},clearSelection:function(d){c.$broadcast(d+"-clear-selection")},selectedColumn:function(d,h){if(h)c.$broadcast(d+"-set-selected-column",h);else{c.$broadcast(d+"-get-selected-column");var p=this.getTempData();this.clearTempData();return p?p:null}},selectedRow:function(d,h){if(h)c.$broadcast(d+"-set-selected-row",h);else{c.$broadcast(d+"-get-selected-row");var p=this.getTempData();this.clearTempData();return p?p:null}},selectedRows:function(d){c.$broadcast(d+"-get-selected-rows");d=this.getTempData();this.clearTempData();return d?d:null},getScrollPos:function(d){c.$broadcast(d+"-get-scroll-pos");d=this.getTempData();this.clearTempData();return d?d:{x:0,y:0}},setScrollPos:function(d,h){c.$broadcast(d+"-set-scroll-pos",h)},scrollTo:function(d,h,p){c.$broadcast(d+"-scroll-to",h,p)},sort:function(d,h,p,g){c.$broadcast(d+"-sort",h,p,g)},refresh:function(d,h,p){c.$broadcast(d+"-refresh",h,p)},resumeLayout:function(d){c.$broadcast(d+"-resume-layout")},suspendLayout:function(d){c.$broadcast(d+"-suspend-layout")},updateLayout:function(d){c.$broadcast(d+"-update-layout")},updateView:function(d){c.$broadcast(d+"-update-view")}}}]).controller("IntegralUITreeGridController",["$scope","$element","$timeout","$window","$interval","IntegralUIInternalService","IntegralUIDataService","IntegralUITreeGridService","IntegralUIDragDrop","IntegralUIFilter",function(c,d,l,h,p,g,N,f,n,Va){var a=this;this.suppressProcess=!1;this.hoverCell=this.hoverRow=this.hoverColumn=null;this.showLoading=!1;a.defaultCheckBoxStyle={general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}};a.defaultStyle={general:"iui-treegrid",column:{general:{content:"iui-treegrid-column-cell-content",disabled:"iui-treegrid-column-disabled",normal:"iui-treegrid-column",hovered:"iui-treegrid-column-hovered",selected:"iui-treegrid-column-selected"},header:{content:"iui-treegrid-column-header-cell-content",disabled:"iui-treegrid-column-header-disabled",normal:"iui-treegrid-column-header",hovered:"iui-treegrid-column-header-hovered",selected:"iui-treegrid-column-header-selected"},body:{content:"iui-treegrid-column-body-cell-content",disabled:"iui-treegrid-column-body-disabled",normal:"iui-treegrid-column-body",hovered:"iui-treegrid-column-body-hovered",selected:"iui-treegrid-column-body-selected"},footer:{content:"iui-treegrid-column-footer-cell-content",disabled:"iui-treegrid-column-footer-disabled",normal:"iui-treegrid-column-footer",hovered:"iui-treegrid-column-footer-hovered",selected:"iui-treegrid-column-footer-selected"}},row:{general:{disabled:"iui-treegrid-row-disabled",focused:"iui-treegrid-row-focused",normal:"iui-treegrid-row",hovered:"iui-treegrid-row-hovered",selected:"iui-treegrid-row-selected"},checkBox:{general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}},expandBox:{general:"iui-treegrid-expand-box",animated:"iui-treegrid-expand-box-load",expanded:"iui-treegrid-expand-box-open",collapsed:"iui-treegrid-expand-box-close"},cell:{content:"iui-treegrid-row-cell-content",general:"iui-treegrid-row-cell",disabled:"iui-treegrid-row-cell-disabled",focused:"iui-treegrid-row-cell-focused",normal:"iui-treegrid-row-cell",hovered:"iui-treegrid-row-cell-hovered",selected:"iui-treegrid-row-cell-selected"}},cell:{content:"iui-treegrid-row-cell-content",general:"iui-treegrid-row-cell",disabled:"iui-treegrid-row-cell-disabled",focused:"iui-treegrid-row-cell-focused",normal:"iui-treegrid-row-cell",hovered:"iui-treegrid-row-cell-hovered",selected:"iui-treegrid-row-cell-selected"}};this.updateOptions=function(b){b?(a.options={allowAnimation:g.isFieldAvailable(b.allowAnimation,!0),allowCellFocus:g.isFieldAvailable(b.allowCellFocus,!0),allowColumnReorder:g.isFieldAvailable(b.allowColumnReorder,!1),allowDrag:g.isFieldAvailable(b.allowDrag,!1),allowDrop:g.isFieldAvailable(b.allowDrop,!0),allowFilter:g.isFieldAvailable(b.allowFilter,!1),allowFocus:g.isFieldAvailable(b.allowFocus,!0),animationSpeed:200,autoExpand:g.isFieldAvailable(b.autoExpand,!0),controlStyle:a.defaultStyle,editorSettings:{activate:"click"},expandColIndex:g.isFieldAvailable(b.expandColIndex,void 0!=a.options.expandColIndex?a.options.expandColIndex:0),fillSpace:g.isFieldAvailable(b.fillSpace,!1),gridLines:g.isFieldAvailable(b.gridLines,"both"),hoverSelection:g.isFieldAvailable(b.hoverSelection,!1),indent:g.isFieldAvailable(b.indent,15),labelEdit:g.isFieldAvailable(b.labelEdit,!1),loadRow:null,pathSeparator:g.isFieldAvailable(b.pathSeparator,"\\"),rtl:g.isFieldAvailable(b.rtl,!1),selectedColumn:g.isFieldAvailable(b.selectedColumn,a.options.selectedColumn?a.options.selectedColumn:null),selectedIndex:-1,selectedRow:g.isFieldAvailable(b.selectedRow,a.options.selectedRow?a.options.selectedRow:null),selectedRows:a.options.selectedRows?a.options.selectedRows:[],selectionMode:g.isFieldAvailable(b.selectionMode,"one"),showFooter:g.isFieldAvailable(b.showFooter,!0),showHeader:g.isFieldAvailable(b.showHeader,!0),showIcons:g.isFieldAvailable(b.showIcons,!0),sorting:g.isFieldAvailable(b.sorting,"none")},a.updateDataFields(b.dataFields),a.updateControlStyle(b.controlStyle)):(a.options={allowAnimation:!0,allowCellFocus:!0,allowColumnReorder:!1,allowDrag:!1,allowDrop:!0,allowFilter:!1,allowFocus:!0,animationSpeed:200,autoExpand:!0,controlStyle:a.defaultStyle,editorSettings:{activate:"click"},expandColIndex:0,fillSpace:!1,gridLines:"both",hoverSelection:!1,indent:15,labelEdit:!1,loadRow:null,pathSeparator:"\\",rtl:!1,selectedColumn:null,selectedIndex:-1,selectedRow:null,selectedRows:[],selectionMode:"one",showFooter:!0,showHeader:!0,showIcons:!0,sorting:"none"},a.updateDataFields())};a.options={};this.updateColumnFields=function(b){a.options.columnFields=b?{allowDrag:b.allowDrag?b.allowDrag:"allowDrag",allowDrop:b.allowDrop?b.allowDrop:"allowDrop",allowFilter:b.allowFilter?b.allowFilter:"allowFilter",comparer:b.comparer?b.comparer:"comparer",contentAlignment:b.contentAlignment?b.contentAlignment:"contentAlignment",contextMenu:b.contextMenu?b.contextMenu:"contextMenu",editorType:b.editorType?b.editorType:"editorType",editorSettings:b.editorSettings?b.editorSettings:"editorSettings",editorTemplate:b.editorTemplate?b.editorTemplate:"editorTemplate",filterParams:b.filterParams?b.filterParams:"filterParams",filterTemplate:b.filterTemplate?b.filterTemplate:"filterTemplate",fixedWidth:b.fixedWidth?b.fixedWidth:"fixedWidth",footerAlignment:b.footerAlignment?b.footerAlignment:"footerAlignment",footerTemplate:b.footerTemplate?b.footerTemplate:"footerTemplate",footerText:b.footerText?b.footerText:"footerText",headerAlignment:b.headerAlignment?b.headerAlignment:"headerAlignment",headerTemplate:b.headerTemplate?b.headerTemplate:"headerTemplate",headerText:b.headerText?b.headerText:"headerText",icon:b.icon?b.icon:"icon",id:b.id?b.id:"id",minWidth:b.minWidth?b.minWidth:"minWidth",maxWidth:b.maxWidth?b.maxWidth:"maxWidth",style:b.style?b.style:"style",visible:b.visible?b.visible:"visible",width:b.width?b.width:"width"}:{allowDrag:"allowDrag",allowDrop:"allowDrop",allowFilter:"allowFilter",comparer:"comparer",contentAlignment:"contentAlignment",contextMenu:"contextMenu",editorType:"editorType",editorSettings:"editorSettings",editorTemplate:"editorTemplate",filterParams:"filterParams",filterTemplate:"filterTemplate",fixedWidth:"fixedWidth",footerAlignment:"footerAlignment",footerTemplate:"footerTemplate",footerText:"footerText",headerAlignment:"headerAlignment",headerTemplate:"headerTemplate",headerText:"headerText",icon:"icon",id:"id",minWidth:"minWidth",maxWidth:"maxWidth",style:"style",visible:"visible",width:"width"};a.columnsObj&&a.columnsObj.updateDataFields(a.options.columnFields)};this.updateRowFields=function(b){a.options.rowFields=b?{allowDrag:b.allowDrag?b.allowDrag:"allowDrag",allowDrop:b.allowDrop?b.allowDrop:"allowDrop",allowFocus:b.allowFocus?b.allowFocus:"allowFocus",cells:b.cells?b.cells:"cells",content:b.content?b.content:"content",contextMenu:b.contextMenu?b.contextMenu:"contextMenu",enabled:b.enabled?b.enabled:"enabled",expanded:b.expanded?b.expanded:"expanded",hasChildren:b.hasChildren?b.hasChildren:"hasChildren",icon:b.icon?b.icon:"icon",id:b.id?b.id:"id",pid:b.pid?b.pid:"pid",rows:b.rows?b.rows:"rows",statusIcon:b.statusIcon?b.statusIcon:"statusIcon",style:b.style?b.style:"style",text:b.text?b.text:"text"}:{allowDrag:"allowDrag",allowDrop:"allowDrop",allowFocus:"allowFocus",cells:"cells",content:"content",contextMenu:"contextMenu",enabled:"enabled",expanded:"expanded",hasChildren:"hasChildren",icon:"icon",id:"id",pid:"pid",rows:"rows",statusIcon:"statusIcon",style:"style",text:"text"};a.rowsObj&&a.rowsObj.updateDataFields(a.options.rowFields)};this.updateCellFields=function(b){a.options.cellFields=b?{allowEdit:b.allowEdit?b.allowEdit:"allowEdit",cid:b.cid?b.cid:"cid",content:b.content?b.content:"content",contextMenu:b.contextMenu?b.contextMenu:"contextMenu",enabled:b.enabled?b.enabled:"enabled",labelEdit:b.labelEdit?b.labelEdit:"labelEdit",rid:b.rid?b.rid:"rid",style:b.style?b.style:"style",text:b.text?b.text:"text",value:b.value?b.value:"value"}:{allowEdit:"allowEdit",cid:"cid",content:"content",contextMenu:"contextMenu",enabled:"enabled",labelEdit:"labelEdit",rid:"rid",style:"style",text:"text",value:"value"}};this.updateDataFields=function(b){b?(a.updateColumnFields(b.column),a.updateRowFields(b.row),a.updateCellFields(b.cell)):(a.updateColumnFields(),a.updateRowFields(),a.updateCellFields())};a.updateOptions();c.$on(c.name+"-add-column",function(b,e){a.columnsObj.insertAt(e,-1,null,a.columnIsAdded)});c.$on(c.name+"-clear-columns",function(b){a.columnsObj.clear(null,a.columnsAreCleared)});c.$on(c.name+"-insert-column-at",function(b,e,c){a.columnsObj.insertAt(e,c,null,a.columnIsAdded)});c.$on(c.name+"-insert-column-after",function(b,e,c){a.columnsObj.insertByRef(e,c,!0,a.columnIsAdded)});c.$on(c.name+"-insert-column-before",function(b,e,c){a.columnsObj.insertByRef(e,c,!1,a.columnIsAdded)});c.$on(c.name+"-remove-column",function(b,e){a.columnsObj.removeAt(e,-1,null,a.columnIsRemoved)});c.$on(c.name+"-remove-column-at",function(b,e){a.columnsObj.removeAt(null,e,null,a.columnIsRemoved)});this.columnsAreCleared=function(b){a.options.selectedColumn&&(a.options.selectedColumn.selected=!1);a.options.selectedColumn=null;a.updateLayout()};a.columnIsAdded=function(){a.updateLayout()};a.columnIsRemoved=function(b,e){a.updateLayout()};c.$on(c.name+"-add-row",function(b,e,c){a.rowsObj.insertAt(e,-1,c,a.rowIsAdded)});c.$on(c.name+"-clear-rows",function(b,e){a.rowsObj.clear(e,a.rowsAreCleared)});c.$on(c.name+"-insert-row-at",function(b,e,c,k){a.rowsObj.insertAt(e,c,k,a.rowIsAdded)});c.$on(c.name+"-insert-row-after",function(b,e,c){a.rowsObj.insertByRef(e,c,!0,a.rowIsAdded)});c.$on(c.name+"-insert-row-before",function(b,e,c){a.rowsObj.insertByRef(e,c,!1,a.rowIsAdded)});c.$on(c.name+"-remove-row",function(b,e){a.rowsObj.removeAt(e,-1,null,a.rowIsRemoved)});c.$on(c.name+"-remove-row-at",function(b,e,c){a.rowsObj.removeAt(null,e,c,a.rowIsRemoved)});this.rowsAreCleared=function(b){b||(a.clearPrevSelection(),a.options.selectedRow=null,a.setScrollPos({x:0,y:0}));a.updateCurrentLayout()};this.rowIsAdded=function(){a.updateCurrentLayout()};this.rowIsRemoved=function(b,e,c){a.updateCurrentLayout()};this.objIsRemoved=function(b,e,c){a.updateCurrentLayout()};a.columnList=[];a.columnFilterList=[];this.updateColumnList=function(){a.columnList.length=0;a.columnFilterList.length=0;var b=a.columnsObj.getList();if(b)for(var e=0;e<b.length;e++){var c=b[e];c.type="column";c[a.options.columnFields.id]||(c[a.options.columnFields.id]=g.getUniqueId());if(0!=c[a.options.columnFields.visible]){var k=c[a.options.columnFields.filterParams],k=k?Va.createTree(k.conditions,k.formula):null;a.columnFilterList.push({cid:c[a.options.columnFields.id],tree:k});a.columnList.push(c)}}};var ib=function(b){for(var e=null,c=0;c<a.columnFilterList.length;c++)if(a.columnFilterList[c].cid==b){e=a.columnFilterList[c].tree;break}return e},y=function(b,e){if(0==a.options.allowFilter)return!0;var c=!0;if(b){for(var k=-1,d=null,g=null,f=0;f<b[a.options.rowFields.cells].length&&(c=!0,g=b[a.options.rowFields.cells][f],k=g[a.options.cellFields.cid],d=a.getColumnById(k),!d&&f<a.columnList.length&&(d=a.columnList[f]),d&&d[a.options.columnFields.filterParams]&&(c=d[a.options.columnFields.filterParams],d=g[a.options.cellFields.value]?g[a.options.cellFields.value]:g[a.options.cellFields.text],c=c.callback?c.callback(d,g,b):Va.match(d,c.conditions,c.formula,ib(k))),c);f++);if(c&&(e||a.isRowExpanded(b))&&(k=b[a.options.rowFields.rows])&&0<k.length){for(f=g=0;f<k.length;f++)(childPass=y(k[f],e))&&g++;0==g&&(c=!1)}}return c},M=a.options.indent;a.currentList=[];a.indentList=[];a.longestRow=null;a.isThereChildRows=!1;this.isThereVisibleChildren=function(b){var e=!1;if(b&&(b=b[a.options.rowFields.rows])&&0<b.length)for(var c=0;c<b.length;c++)if(y(b[c])){e=!0;break}return e};var F=function(b,e,c,k){b.type="row";b[a.options.rowFields.id]||(b[a.options.rowFields.id]=g.getUniqueId());c&&(b[a.options.rowFields.pid]=c);c=!0;var d=b[a.options.rowFields.cells];if(d&&0<d.length){c=y(b,k);a.isRowExpanded(b)&&b[a.options.rowFields.rows]&&0<b[a.options.rowFields.rows].length&&(c=c&&a.isThereVisibleChildren(b));for(var f=-1,h="label",l=null,l=null,n=0;n<a.columnList.length;n++){var l=a.columnList[n],f=l[a.options.columnFields.id],h=l[a.options.columnFields.editorType],l=l[a.options.columnFields.editorSettings],p=n;f&&(p=a.getCellIndexById(d,n,f));0<=p&&p<d.length&&(d[p].type="cell",d[p][a.options.cellFields.rid]=b[a.options.rowFields.id],a.setDefaultCellValue(d[p],h,l))}}c&&(k?a.fullList.push(b):(a.currentList.push(b),a.indentList.push(e)));return c},z=function(b,e,c,k){var d=!0;if(!b[a.options.rowFields.rows])return d=F(b,e,c,k);if(d=F(b,e,c,k)){c=0;var g=!0;if(k||a.isRowExpanded(b)){var f=b[a.options.rowFields.rows];if(f){a.applySorting(f);for(var h=0;h<f.length;h++)(g=z(f[h],e+M,b[a.options.rowFields.id],k))&&c++}}k||a.isThereChildRows||!(0<c||!a.isRowExpanded(b)&&b[a.options.rowFields.rows]&&0<b[a.options.rowFields.rows].length&&a.isThereVisibleChildren(b))||(a.isThereChildRows=!0)}return d};a.fullList=[];this.getFullList=function(){a.fullList.length=0;for(var b=a.rowsObj.getList(),e=0;e<b.length;e++)z(b[e],0,null,!0);return a.fullList};this.getCurrentList=function(){return a.currentList};this.updateCurrentList=function(){a.currentList.length=0;a.indentList.length=0;a.isThereChildRows=!1;var b=a.rowsObj.getList();if(b){a.applySorting(b);for(var e=0;e<b.length;e++)z(b[e],0,null,!1)}};this.columnEvents={clear:function(a){return angular.isDefined(c.events)&&c.events.clearColumns?c.events.clearColumns({parent:a.e.parent}):c.clearColumns(a)},objAdded:function(a){return angular.isDefined(c.events)&&c.events.columnAdded?c.events.columnAdded({column:a.e.column}):c.columnAdded(a)},objAdding:function(a){return angular.isDefined(c.events)&&c.events.rowAdding?c.events.columnAdding({column:a.e.column}):c.columnAdding(a)},objRemoved:function(a){return angular.isDefined(c.events)&&c.events.rowRemoved?c.events.columnRemoved({column:a.e.column}):c.columnRemoved(a)},objRemoving:function(a){return angular.isDefined(c.events)&&c.events.rowRemoving?c.events.columnRemoving({column:a.e.column}):c.columnRemoving(a)}};this.rowEvents={clear:function(a){return angular.isDefined(c.events)&&c.events.clearRows?c.events.clearRows({parent:a.e.parent}):c.clearRows(a)},objAdded:function(a){return angular.isDefined(c.events)&&c.events.rowAdded?c.events.rowAdded({row:a.e.row}):c.rowAdded(a)},objAdding:function(a){return angular.isDefined(c.events)&&c.events.rowAdding?c.events.rowAdding({row:a.e.row}):c.rowAdding(a)},objRemoved:function(a){return angular.isDefined(c.events)&&c.events.rowRemoved?c.events.rowRemoved({row:a.e.row}):c.rowRemoved(a)},objRemoving:function(a){return angular.isDefined(c.events)&&c.events.rowRemoving?c.events.rowRemoving({row:a.e.row}):c.rowRemoving(a)}};this.getRowFields=function(a){return{content:a.content?a.content:"content",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",pid:a.pid?a.pid:"pid",objects:a.rows?a.rows:"rows",subobjects:a.cells?a.cells:"cells",text:a.text?a.text:"text"}};a.columnsObj=new N({objects:c.columns,events:a.columnEvents,fields:a.options.columnFields});a.rowsObj=new N({objects:c.rows,events:a.rowEvents,fields:a.getRowFields(a.options.rowFields)});c.$on(c.name+"-load-data",function(b,e,c,k,d){a.loadData(e,c,k,d)});c.$on(c.name+"-export-json",function(b,e,c,k,d){f.setTempData(a.exportToJSON(e,c,k,d))});this.exportToJSON=function(b,e,c,k){var d=k,d=d?d:null,g=a.columnsObj.getList();b=JSON.stringify(g,b?b:[a.options.columnFields.allowDrag,a.options.columnFields.allowDrop,a.options.columnFields.allowFilter,a.options.columnFields.contentAlignment,a.options.columnFields.contextMenu,a.options.columnFields.editorType,a.options.columnFields.editorSettings,a.options.columnFields.editorTemplate,a.options.columnFields.filterParams,a.options.columnFields.filterTemplate,a.options.columnFields.fixedWidth,a.options.columnFields.footerAlignment,a.options.columnFields.footerTemplate,a.options.columnFields.footerText,a.options.columnFields.headerAlignment,a.options.columnFields.headerContent,a.options.columnFields.headerTemplate,a.options.columnFields.headerText,a.options.columnFields.icon,a.options.columnFields.id,a.options.columnFields.style,a.options.columnFields.visible,a.options.columnFields.width],d);k=k?k:null;d=!1!==c?a.getFullList():a.rowsObj.getList();e=e?e:[a.options.rowFields.allowCellFocus,a.options.rowFields.allowDrag,a.options.rowFields.allowDrop,a.options.rowFields.allowFocus,a.options.rowFields.cells,a.options.rowFields.content,a.options.rowFields.contextMenu,a.options.rowFields.enabled,a.options.rowFields.expanded,a.options.rowFields.hasChildren,a.options.rowFields.icon,a.options.rowFields.id,a.options.rowFields.pid,a.options.rowFields.statusIcon,a.options.rowFields.style,a.options.rowFields.text,a.options.cellFields.rid];0==c&&e.push(a.options.rowFields.rows);c=JSON.stringify(d,e,k);return'[\n{ "columns": '+b+' },\n{ "rows": '+c+" }\n]"};this.loadData=function(b,e,X,k){a.updateDataFields(X);var d=[],g=a.options.rowFields;a.rowsObj.clear(e,a.rowsAreCleared);if(b)if(!1!==k){var f=[];b.forEach(function(a,b){var e=a[g.pid];f[e]?(f[e][g.rows]||(f[e][g.rows]=[]),f[a[g.id]]=a,f[e][g.rows].push(a)):(f[a[g.id]]=a,d.push(a))});f.length=0}else d=b;if(e)for(e[a.options.rowFields.rows]=d,b=0;b<e[a.options.rowFields.rows].length;b++)e[a.options.rowFields.rows][b][a.options.rowFields.pid]=e[a.options.rowFields.id];else angular.isDefined(c.rows)&&(c.rows=d);a.rowsObj=new N({objects:c.rows,events:a.rowEvents,fields:a.getRowFields(a.options.rowFields)});a.updateLayout()};this.updateData=function(){a.options.rowFields.dataSource&&(a.loadData(a.options.rowFields.dataSource),a.rowsObj=new N({objects:c.rows,events:a.rowEvents,fields:a.getRowFields(a.options.rowFields)}))};var pa=!1;this.dragDropStatus=function(a){if(a)pa=a;else return pa};this.getDnDSource=function(a){return{text:a.dataTransfer?a.dataTransfer.getData("text"):a.originalEvent.dataTransfer?a.originalEvent.dataTransfer.getData("text"):""}};var Y=angular.element('<div class="iui-drop-marker" data-element="dropmark"></div>');this.getDropMarkLine=function(){return dropMarkLine};angular.element(h).bind("dragenter",function(b){a.dropMark()});angular.element(h).bind("dragend",function(b){a.removeDropMark();a.dragIcon&&angular.element(a.dragIcon).remove();a.cancelScrollTimer()});a.getMousePos=function(a){return{x:a.pageX?a.pageX:a.originalEvent?a.originalEvent.pageX:0,y:a.pageY?a.pageY:a.originalEvent?a.originalEvent.pageY:0}};this.getTreeName=function(){return angular.isDefined(c.name)?c.name:""};d.bind("dragenter",function(b){b.preventDefault();var e=n.getData();e.source||(e.source=a.getDnDSource(b));b={sourceTree:e.sourceCtrl?e.sourceCtrl.getTreeName():"",dragRow:e.source,targetTree:a.getTreeName(),targetRow:e.target,mousePos:a.getMousePos(b)};a.callDragEnter(b)});d.bind("dragover",function(b){b.preventDefault();if(a.isDropInRange(b)){var e=!0;b.dataTransfer?e="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(e="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(e){b.dataTransfer?b.dataTransfer.dropEffect=a.options.allowDrop?"move":"none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect=a.options.allowDrop?"move":"none");e=n.getData();e.source||(e.source=a.getDnDSource(b));n.setData({source:e.source,sourceCtrl:e.sourceCtrl,target:null,dropPos:-1});e={sourceTree:e.sourceCtrl?e.sourceCtrl.getTreeName():"",dragRow:e.source,targetTree:a.getTreeName(),targetRow:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:a.getMousePos(b)};a.callDragOver(e);e=a.getMousePos(b);b=e.y+16;var e=e.x+20,X=a.getDropMarkWindow();X.empty();X.append("<span class='iui-drop-marker-move-end'></span><span class='iui-drop-marker-title'>"+(c.name?c.name:"TreeGrid")+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:b,left:e});a.dropMark(!0)}}else a.dropMark(),b.dataTransfer?b.dataTransfer.dropEffect="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect="none")});d.bind("drop",function(b){b.preventDefault();a.dropMark();if(a.isDropInRange(b)){var e=!0;b.dataTransfer?e="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(e="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(e&&(e=n.getData(),e.source||(e.source=a.getDnDSource(b)),e.source)){var X={sourceTree:e.sourceCtrl?e.sourceCtrl.getTreeName():"",dragRow:e.source,targetTree:a.getTreeName(),targetRow:null,isDropAllowed:a.options.allowDrop,dropPos:-1,mousePos:a.getMousePos(b)};!1!==a.callDragDrop(X)&&(a.drop(e),c.$$phase||c.$apply())}}n.clearData();b.stopPropagation()});d.bind("dragleave",function(b){b.preventDefault();a.dropMark();var e=n.getData();e.source||(e.source=a.getDnDSource(b));b={sourceTree:e.sourceCtrl?e.sourceCtrl.getTreeName():"",dragRow:e.source,targetTree:a.getTreeName(),targetRow:e.target,mousePos:a.getMousePos(b)};a.callDragLeave(b);a.cancelScrollTimer()});d.bind("dragend",function(b){b.preventDefault();a.dropMark();n.getData().source||n.clearData()});d.bind("mouseleave",function(b){b.preventDefault();a.dropMark();a.hoverColumn=null;a.hoverRow=null;a.hoverCell=null});this.containsMousePos=function(a,e){return n.hitTest(a,e,{left:0,top:0,right:d[0].clientWidth,bottom:d[0].clientHeight})};this.isPopupActive=function(){return!1};var T=function(b,e){var c=a.options.rowFields;if(!b[c.cells]){b[c.cells]=[];var k={};k[a.options.cellFields.text]=b[e.text];b[c.cells].push(k)}b[c.rows]||(b[c.rows]=[]);b[c.rows].length=0;if(b[e.items]&&0<b[e.items].length)for(k=0;k<b[e.items].length;k++)b[c.rows].push(T(b[e.items][k],e));return b},ea=function(b,e){var c=!1;e.sourceCtrl&&(c=e.sourceCollection.removeAt(b,-1,null,e.sourceCtrl.objIsRemoved));c&&("item"==b.type&&(b=T(b,e.sourceCtrl.options.dataFields)),0===e.dropPos?a.rowsObj.insertAt(b,-1,e.target,a.rowIsAdded):1===e.dropPos||2===e.dropPos?1===e.dropPos?a.rowsObj.insertByRef(b,e.target,!1,a.rowIsAdded):a.rowsObj.insertByRef(b,e.target,!0,a.rowIsAdded):a.rowsObj.insertAt(b,-1,null,a.rowIsAdded))};this.setDropSelection=function(b,e){var c=b;!c&&0<=e&&e<a.currentList.length&&(c=a.currentList[e]);a.clearPrevSelection(c);a.rowSelection(c)};this.drop=function(b){if(b&&b.sourceCtrl){b.sourceCtrl.suppressProcess=!0;a.allowUpdate=!1;b.sourceCtrl.allowUpdate=!1;var e=b.source,c=-1;if(Array.isArray(b.source)){0<b.source.length&&(c=b.sourceCtrl.getObjCurrentIndex(b.source[b.source.length-1]));for(var k=[],d=0;d<b.source.length;d++){for(var g=!1,f=b.sourceCollection.getParent(b.source[d]);f;){if(b.sourceCtrl.isObjInSelList(f)){g=!0;break}f=b.sourceCollection.getParent(f)}g||k.push(b.source[d])}if(0<k.length)if(e=k[k.length-1],d=b.sourceCtrl.getObjCurrentIndex(k[0]),g=b.sourceCtrl.getObjCurrentIndex(e),d<=g)for(d=0;d<k.length;d++)ea(k[d],b);else for(d=k.length-1;0<=d;d--)ea(k[d],b)}else c=b.sourceCtrl.getObjCurrentIndex(b.source),ea(b.source,b);b.sourceCtrl!==a?(a.allowUpdate=!0,b.sourceCtrl.allowUpdate=!0,a.updateCurrentLayout(),b.sourceCtrl.updateCurrentLayout()):(a.allowUpdate=!0,a.updateCurrentLayout());b.sourceCtrl.multiSelection(!1);var h=l(function(){b.sourceCtrl!==a&&b.sourceCtrl.setDropSelection(null,c);a.setDropSelection(e);a.updateFocus(a.getObjCurrentIndex(e),0);l.cancel(h)},1);b.sourceCtrl.suppressProcess=!1}};this.isDragAllowed=function(b){return a.options.allowDrag?b&&(b[a.options.rowFields.allowDrag]||void 0===b[a.options.rowFields.allowDrag])?!0:!1:!1};this.isChildOf=function(b,e){var c=!1;if(b&&e){var d=e[a.options.rowFields.rows];if(d&&0<d.length)for(var f=0;f<d.length;f++){if(g.isEqual(b[a.options.rowFields.id],d[f][a.options.rowFields.id])){c=!0;break}else c=a.isChildOf(b,d[f]);if(c)break}}return c};this.isParentOf=function(b,e){var c=a.rowsObj.getParent(e);return b&&e&&c&&g.isEqual(b[a.options.rowFields.id],c[a.options.rowFields.id])?!0:!1};this.isDropAllowed=function(b,e,c){var d=a.options.allowDrop;if(d&&b&&e&&(d=e[a.options.rowFields.allowDrop]||void 0===e[a.options.rowFields.allowDrop]?!0:!1))if(Array.isArray(b))for(var f=0;f<b.length;f++){if(g.isEqual(b[f][a.options.rowFields.id],e[a.options.rowFields.id])||0===c&&a.isParentOf(e,b[f])||a.isChildOf(e,b[f])){d=!1;break}if(!d)break}else if(g.isEqual(b[a.options.rowFields.id],e[a.options.rowFields.id])||0===c&&a.isParentOf(e,b)||a.isChildOf(e,b))d=!1;return d};this.getDropMarkWindow=function(){for(var a=Y,e=angular.element(document.body).children(),c=0;c<e.length;c++){var d=angular.element(e[c]);if(d[0].attributes&&d[0].attributes["data-element"]&&"dropmark"===d[0].attributes["data-element"].value){a=d;break}}return a};this.dropMark=function(b,e){e||(e=a.getDropMarkWindow());if(e){var c="none";this.options.allowDrop&&(c=b?"block":"none");angular.element(e).css("display",c)}};this.updateDropMarkElem=function(a,e){a&&e&&(a.css("top",e.top+"px"),a.css("left",e.left+"px"),a.css("width",e.width+"px"))};c.$on(c.name+"-open-editor",function(b,e){a.openEditor(e)});c.$on(c.name+"-close-editor",function(b,e){a.closeEditor(e)});this.updateEditorSettings=function(b){a.options.editorSettings=b?{activate:g.isFieldAvailable(b.activate,"click")}:{activate:"click"}};this.allowEvents=!0;this.callAfterCollapse=function(a){angular.isDefined(c.events)&&c.events.afterCollapse&&c.events.afterCollapse({row:a});c.afterCollapse({e:{row:a}})};this.callAfterExpand=function(a){angular.isDefined(c.events)&&c.events.afterExpand&&c.events.afterExpand({row:a});c.afterExpand({e:{row:a}})};this.callAfterEdit=function(a){angular.isDefined(c.events)&&c.events.afterEdit&&c.events.afterEdit({cell:a});c.afterEdit({e:{cell:a}})};this.callAfterLabelEdit=function(a){angular.isDefined(c.events)&&c.events.afterLabelEdit&&c.events.afterLabelEdit({cell:a});c.afterLabelEdit({e:{cell:a}})};this.callAfterSelect=function(a){angular.isDefined(c.events)&&c.events.afterSelect?c.events.afterSelect({object:a}):c.afterSelect({e:{object:a}});angular.isDefined(c.events)&&c.events.selectionChanged?c.events.selectionChanged({object:a}):c.selectionChanged({e:{object:a}})};this.callBeforeCollapse=function(a){var e=!0;return e=angular.isDefined(c.events)&&c.events.beforeCollapse?c.events.beforeCollapse({row:a}):c.beforeCollapse({e:{row:a}})};this.callBeforeExpand=function(a){var e=!0;return e=angular.isDefined(c.events)&&c.events.beforeExpand?c.events.beforeExpand({row:a}):c.beforeExpand({e:{row:a}})};this.callBeforeEdit=function(a){var e=!0;return e=angular.isDefined(c.events)&&c.events.beforeEdit?c.events.beforeEdit({cell:a}):c.beforeEdit({e:{cell:a}})};this.callBeforeLabelEdit=function(a){var e=!0;return e=angular.isDefined(c.events)&&c.events.beforeLabelEdit?c.events.beforeLabelEdit({cell:a}):c.beforeLabelEdit({e:{cell:a}})};this.callCellValueChanging=function(b,e,d){var k=!0;a.allowEvents&&(k=angular.isDefined(c.events)&&c.events.cellvalueChanging?c.events.cellvalueChanging({row:b,cell:e,value:d}):c.cellvalueChanging({e:{row:b,cell:e,value:d}}));return k};this.callCellValueChanged=function(b,e,d){a.allowEvents&&(angular.isDefined(c.events)&&c.events.cellvalueChanged?c.events.cellvalueChanged({row:b,cell:e,value:d}):c.cellvalueChanged({e:{row:b,cell:e,value:d}}))};this.callColumnClick=function(a,e){angular.isDefined(c.events)&&c.events.columnClick&&c.events.columnClick({column:a,mousePos:e});c.columnClick({e:{column:a,mousePos:e}})};this.callColumnDblClick=function(a,e){angular.isDefined(c.events)&&c.events.columnDblclick&&c.events.columnDblclick({column:a,mousePos:e});c.columnDblclick({e:{column:a,mousePos:e}})};this.callColumnHover=function(a){angular.isDefined(c.events)&&c.events.columnHover&&c.events.columnHover({column:a});c.columnHover({e:{column:a}})};this.callColumnPosChanging=function(a,e){var d=!0;return d=angular.isDefined(c.events)&&c.events.columnPoschanging?c.events.columnPoschanging({sourceColumn:a,targetColumn:e}):c.columnPoschanging({e:{sourceColumn:a,targetColumn:e}})};this.callColumnPosChanged=function(a,e){angular.isDefined(c.events)&&c.events.columnPoschanged&&c.events.columnPoschanged({sourceColumn:a,targetColumn:e});c.columnPoschanged({e:{sourceColumn:a,targetColumn:e}})};this.callColumnRightClick=function(a,e){angular.isDefined(c.events)&&c.events.columnRightclick&&c.events.columnRightclick({column:a,mousePos:e});c.columnRightclick({e:{column:a,mousePos:e}})};this.callColumnSizeChanged=function(a,e){angular.isDefined(c.events)&&c.events.columnSizechanged&&c.events.columnSizechanged({column:a});c.columnSizechanged({e:{column:a}})};this.callDragEnter=function(a){angular.isDefined(c.events)&&c.events.dragEnter?c.events.dragEnter({sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,mousePos:a.mousePos}):c.dragEnter({e:{sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,mousePos:a.mousePos}})};this.callDragOver=function(a){var e=!0;return e=angular.isDefined(c.events)&&c.events.dragOver?c.events.dragOver({sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}):c.dragOver({e:{sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}})};this.callDragDrop=function(a){var e=!0;return e=angular.isDefined(c.events)&&c.events.dragDrop?c.events.dragDrop({sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}):c.dragDrop({e:{sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,isDropAllowed:a.isDropAllowed,dropPos:a.dropPos,mousePos:a.mousePos}})};this.callDragLeave=function(a){angular.isDefined(c.events)&&c.events.dragLeave?c.events.dragLeave({sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,mousePos:a.mousePos}):c.dragLeave({e:{sourceTree:a.sourceTree,dragRow:a.dragRow,targetTree:a.targetTree,targetRow:a.targetRow,mousePos:a.mousePos}})};this.callCellClick=function(a,e,d){angular.isDefined(c.events)&&c.events.cellClick&&c.events.cellClick({row:a,cell:e,mousePos:d});c.cellClick({e:{row:a,cell:e,mousePos:d}})};this.callRowClick=function(a,e){angular.isDefined(c.events)&&c.events.rowClick&&c.events.rowClick({row:a,mousePos:e});c.rowClick({e:{row:a,mousePos:e}})};this.callRowDblClick=function(a,e){var d=!0;return d=angular.isDefined(c.events)&&c.events.rowDblClick?c.events.rowDblClick({row:a,mousePos:e}):c.rowDblclick({e:{row:a,mousePos:e}})};this.callRowHover=function(a){angular.isDefined(c.events)&&c.events.rowHover&&c.events.rowHover({row:a});c.rowHover({e:{row:a}})};this.callRowRightClick=function(a,e){angular.isDefined(c.events)&&c.events.rowRightClick&&c.events.rowRightClick({row:a,mousePos:e});c.rowRightclick({e:{row:a,mousePos:e}})};this.callKeyDown=function(a,e){angular.isDefined(c.events)&&c.events.keyDown?c.events.keyDown({event:a,row:e}):c.keyDown({e:{event:a,row:e}})};this.callKeyPress=function(a,e){angular.isDefined(c.events)&&c.events.keyPress?c.events.keyPress({event:a,row:e}):c.keyPress({e:{event:a,row:e}})};this.callKeyUp=function(a,e){angular.isDefined(c.events)&&c.events.keyUp?c.events.keyUp({event:a,row:e}):c.keyUp({e:{event:a,row:e}})};this.callScrollPosChanged=function(){angular.isDefined(c.events)&&c.events.scrollPosChanged?c.events.scrollPosChanged({scrollPos:a.scrollPos}):c.scrollposChanged({e:{scrollPos:a.scrollPos}})};d.bind("click",function(b){1===b.which&&a.callRowClick(null,a.getMousePos(b))});d.bind("dblclick",function(b){b.preventDefault();1===b.which&&a.callRowDblClick(null,a.getMousePos(b));b.stopPropagation()});d.bind("mousedown",function(b){3===b.which&&a.callRowRightClick(null,a.getMousePos(b));a.removeDropDownList();a.closeFilterWindow();a.closeEditor();b.stopPropagation()});this.expandList=[];this.expandIndentList=[];var Ba=function(b,e,c){b.type="row";b[a.options.rowFields.id]||(b[a.options.rowFields.id]=g.getUniqueId());c&&(b[a.options.rowFields.pid]=c);c=!0;var d=b[a.options.rowFields.cells];if(d&&0<d.length){c=y(b);a.isRowExpanded(b)&&b[a.options.rowFields.rows]&&0<b[a.options.rowFields.rows].length&&(c=c&&a.isThereVisibleChildren(b));for(var f=-1,h="label",l=null,l=null,n=0;n<a.columnList.length;n++){var l=a.columnList[n],f=l[a.options.columnFields.id],h=l[a.options.columnFields.editorType],l=l[a.options.columnFields.editorSettings],p=n;f&&(p=a.getCellIndexById(d,n,f));0<=p&&p<d.length&&(d[p].type="cell",a.setDefaultCellValue(d[p],h,l))}}c&&(a.expandList.push(b),a.expandIndentList.push(e));return c},x=function(b,e,c){var d=!0;if(!b[a.options.rowFields.rows])return d=Ba(b,e+M,c);if(d=Ba(b,e+M,c)){c=0;var f=!0;if(a.isRowExpanded(b)){var g=b[a.options.rowFields.rows];if(g){a.applySorting(g);for(var h=0;h<g.length;h++)(f=x(g[h],e+M,b[a.options.rowFields.id]))&&c++}}!a.isThereChildRows&&(0<c||!a.isRowExpanded(b)&&b[a.options.rowFields.rows]&&0<b[a.options.rowFields.rows].length&&a.isThereVisibleChildren(b))&&(a.isThereChildRows=!0)}return d};this.expand=function(b){a.expandList.length=[];a.expandIndentList.length=[];if(!a.isRowExpanded(b)){var e=a.getRowCurrentIndex(b);if(b=a.getList(b)){a.applySorting(b);for(var c=0;c<b.length;c++)x(b[c],a.indentList[e],null)}if(0<a.expandList.length){a.allowEvents=!1;e++;Array.prototype.splice.apply(a.currentList,[e,0].concat(a.expandList));Array.prototype.splice.apply(a.indentList,[e,0].concat(a.expandIndentList));a.getRowScope()?a.updateView():a.updateLayout();var d=l(function(){a.updateViewSize();a.updateViewSize();a.updateScrollView();l.cancel(d);a.allowEvents=!0},1)}}};this.collapse=function(b){a.expandList.length=[];a.expandIndentList.length=[];if(a.isRowExpanded(b)){var e=null,c=!1,d=b,g=-1,f=a.getRowCurrentIndex(b);for(b=a.getParent(b);b&&!c;){e=a.getList(b);for(g=e.indexOf(d)+1;!c&&g<e.length;)d=e[g],0<a.getRowCurrentIndex(d)&&(c=!0),g++;c||(d=b);b=a.getParent(b)}if(!c&&d)for(e=a.getList(),g=e.indexOf(d)+1;g<e.length;)if(d=e[g],0<a.getRowCurrentIndex(d)){c=!0;break}else g++;f++;e=a.currentList.length-f;c&&(e=a.getRowCurrentIndex(d)-f);if(0<e){a.currentList.splice(f,e);a.indentList.splice(f,e);a.getRowScope()?a.updateView():a.updateLayout();var h=l(function(){a.updateViewSize();a.updateViewSize();a.updateScrollView();l.cancel(h);a.allowEvents=!0},1)}}};this.toggle=function(b,e){if(b){if(b[a.options.rowFields.hasChildren]||b[a.options.rowFields.rows]&&0!=b[a.options.rowFields.rows].length)if(!e||0==b[a.options.rowFields.expanded])if(!1!==e||0!=b[a.options.rowFields.expanded]){a.updateType="view";var c=void 0!==e?e:!1!==b[a.options.rowFields.expanded]?!0:!1,d=!0,d=void 0!==e?e?a.callBeforeExpand(b):a.callBeforeCollapse(b):c?a.callBeforeCollapse(b):a.callBeforeExpand(b);!1!==d&&(c=void 0!=e?e:!c,c!=b[a.options.rowFields.expanded]&&(0!=c?a.expand(b):a.collapse(b),b[a.options.rowFields.expanded]=c),a.isRowExpanded(b)?a.callAfterExpand(b):a.callAfterCollapse(b))}}else{c=a.getFullList();for(d=0;d<c.length;d++)c[d][a.options.rowFields.expanded]=e;a.updateCurrentLayout()}};c.$on(c.name+"-collapse",function(b,e){a.toggle(e,!1)});c.$on(c.name+"-expand",function(b,e){a.toggle(e,!0)});c.$on(c.name+"-expand-col-index",function(b,e){0<=e&&e<a.columnList.length&&(a.options.expandColIndex=e)});c.$on(c.name+"-toggle",function(b,e){a.toggle(e)});this.isFilteringAllowed=function(b){return b&&b[a.options.columnFields.allowFilter]};c.$on(c.name+"-filter",function(b,e,c){a.filter(e,c)});this.filter=function(b,e){if(b)b[a.options.columnFields.filterParams]=e;else for(var c=0;c<a.columnList.length;c++)b[a.options.columnFields.filterParams]=null;a.closeFilterWindow();a.updateCurrentLayout()};this.callGotFocus=function(a,e,d,k,g){angular.isDefined(c.events)&&c.events.gotFocus?c.events.gotFocus({event:a,row:e,cell:d,edit:void 0!=k?!0:!1,editValue:g}):c.gotFocus({e:{event:a,row:e,cell:d,edit:void 0!=k?!0:!1,editValue:g}})};this.callLostFocus=function(a,e,d,k,g){angular.isDefined(c.events)&&c.events.lostFocus?c.events.lostFocus({event:a,row:e,cell:d,edit:void 0!=k?!0:!1,editValue:g}):c.lostFocus({e:{event:a,row:e,cell:d,edit:void 0!=k?!0:!1,editValue:g}})};this.getTabIndex=function(){return d[0].attributes&&d[0].attributes.tabindex?d[0].attributes.tabindex.value:""};this.updateFocus=function(b,e){if(1==a.options.allowFocus)var c=l(function(){if(a.isRowIndexInRange(b)){var k=a.getElemFromRow(a.currentList[b]);k&&(1==a.options.allowCellFocus&&0<=e&&e<a.columnList.length?(k=a.getElemFromCell(b,e))&&k[0].focus():k[0].focus())}else d[0].focus();l.cancel(c)},5)};c.$on(c.name+"-focus",function(b,e){if(e){var c=-1,d=-1;switch(e.type){case "row":c=a.getRowCurrentIndex(e);a.updateFocus(c);break;case "cell":c=a.getCellRowIndex(e),d=a.getCellColumnIndex(e),a.updateFocus(c,d)}}else a.updateFocus()});var ua=!1;this.getCell=function(b,e){if(0<=b&&b<a.currentList.length){var c=a.currentList[b],d=a.getColumnRealIndex(e);0<=e&&e<a.columnList.length&&(d=a.getCellIndexById(c[a.options.rowFields.cells],e,a.columnList[e].id));if(c[a.options.rowFields.cells]&&0<=d&&d<c[a.options.rowFields.cells].length)return c[a.options.rowFields.cells][d]}return null};this.getCellObject=function(b,e){if(0<=b&&b<a.currentList.length){var c=a.currentList[b],d=a.getColumnRealIndex(e);0<=e&&e<a.columnList.length&&(d=a.getCellIndexById(c[a.options.rowFields.cells],e,a.columnList[e].id));if(c[a.options.rowFields.cells]&&0<=d&&d<c[a.options.rowFields.cells].length)return c[a.options.rowFields.cells][d]}return null};this.getCellIndexById=function(b,c,d){var k=-1;if(b){c=a.getColumnRealIndex(c);for(var g=0;g<b.length;g++)if(void 0==b[g][a.options.cellFields.cid]){k=c;break}else if(b[g][a.options.cellFields.cid]==d){k=g;break}}return k};this.getCellIndexFromRow=function(b,c){var d=-1;if(b&&c&&c[a.options.rowFields.cells])for(var k=0;k<c[a.options.rowFields.cells].length;k++)if(c[a.options.rowFields.cells][k]==b){d=k;break}return d};this.getCellColumnIndex=function(b){if(b)if(b[a.options.cellFields.cid]){if(b=a.getColumnById(b[a.options.cellFields.cid]))return a.getColumnCurrentIndex(b)}else return a.getCellColumnIndexFromRow(b);return-1};this.getCellColumnIndexFromRow=function(b){if(b&&b[a.options.cellFields.rid]){var c=a.findRowById(b[a.options.cellFields.rid]);if(c&&(c=c[a.options.rowFields.cells])&&0<c.length)return c.indexOf(b)}return-1};this.getCellRowIndex=function(b){return b&&b[a.options.cellFields.rid]&&(b=a.findRowById(b[a.options.cellFields.rid]))?a.getRowCurrentIndex(b):-1};this.getColumnById=function(b){for(var c=null,d=0;d<a.columnList.length;d++)if(a.columnList[d][a.options.columnFields.id]==b){c=a.columnList[d];break}return c};this.getColumnObject=function(b){return 0<=b&&b<a.columnList.length?a.columnList[b]:null};this.getRowObject=function(b){return 0<=b&&b<a.currentList.length?a.currentList[b]:null};this.isRowExpanded=function(b){return b?b[a.options.rowFields.expanded]||void 0===b[a.options.rowFields.expanded]?!0:!1:!0};this.getContentElement=function(a,c){var d=null;c||(c="cell-content");if(a&&0<a.children().length)for(var k=a.children(),g=0;g<k.length;g++){var f=angular.element(k.eq(g));if(f[0].attributes&&f[0].attributes["data-element"]&&f[0].attributes["data-element"].value==c){d=f;break}}return d};this.getElement=function(a,c){var d=null;c||(c="cell-content");if(a&&0<a.children().length){a=a.children().eq(0);for(var k=a.children(),g=0;g<k.length;g++){var f=angular.element(k.eq(g));if(f[0].attributes&&f[0].attributes["data-element"]&&f[0].attributes["data-element"].value==c){d=f;break}}}return d};this.getChildElement=function(a,c){var d=null;c||(c="content");if(a&&0<a.children().length)for(var k=a.children(),g=0;g<k.length;g++){var f=angular.element(k.eq(g));if(f[0].attributes&&f[0].attributes["data-element"]&&f[0].attributes["data-element"].value==c){d=f;break}}return d};this.getElemFromColumn=function(b,c){var d=null;if(b){var k=a.getColumnCurrentIndex(b),g=a.getHeaderElem();"footer"==c&&(g=a.getFooterElem());if(g&&(g=g.find("td"))&&0<g.length)for(var f=0;f<g.length;f++){var h=angular.element(g[f]);if(h[0].attributes["data-index"]&&h[0].attributes["data-index"].value.toString()===k.toString()){d=h;break}}}return d};this.getElemFromRow=function(b){var c=null;if(b){b=a.getRowCurrentIndex(b);var d=a.getRowElems();if(d&&0<d.length)for(var k=0;k<d.length;k++){var g=angular.element(d[k]);if(g[0].attributes["data-index"]&&g[0].attributes["data-index"].value.toString()===b.toString()){c=g;break}}}return c};this.getElemFromCell=function(b,c){var d=null;if(0<=b&&b<a.currentList.length){var g=a.getElemFromRow(a.currentList[b]);if(g&&(g=g.find("td"))&&0<g.length)for(var f=0;f<g.length;f++){var h=angular.element(g[f]);if(h[0].attributes["data-index"]&&h[0].attributes["data-index"].value.toString()===c.toString()){d=h;break}}}return d};this.getIndent=function(b){var c=0;if(b)for(parent=a.rowsObj.getParent(b);parent;)c+=a.options.indent,parent=a.rowsObj.getParent(parent);return c};this.getObjState=function(b){if(b)switch(b.type){case "column":if(1==b.selected)return"selected";if(b==a.hoverColumn)return"hovered";break;case "row":if(0==b[a.options.rowFields.enabled])return"disabled";if(1==b.selected)return"selected";if(b==a.hoverRow)return"hovered";break;case "cell":if(0==b[a.options.cellFields.enabled])return"disabled";if(1==b.selected)return"selected";if(b==a.hoverCell)return"hovered"}return"normal"};this.getRowAt=function(b,c){var d=null,k=null,f=null,h=a.getRowElems();if(h&&0<h.length)for(var l=0;l<h.length;l++)if(d=angular.element(h[l]),k=g.getPageRect(d),g.checkHit(b,c,k)){f=a.getRowFromElem(d);break}return f};this.getRowCurrentIndex=function(b){return b&&a.currentList?a.currentList.indexOf(b):-1};this.getObjCurrentIndex=function(b){return a.getRowCurrentIndex(b)};this.getRowFromChildElem=function(b){if(b&&(b=angular.element(b))){for(b=b.parent();b&&b[0].tagName&&"tr"!==b[0].tagName.toLowerCase();)b=b.parent();return b?a.getRowFromElem(b):null}return null};this.getColumnCurrentIndex=function(b){return b&&a.columnList?a.columnList.indexOf(b):-1};this.getColumnRealIndex=function(b){var c=a.columnsObj.getList();return 0<=b&&b<c.length&&b<a.columnList.length?c.indexOf(a.columnList[b]):-1};this.getColumnFromChildElem=function(b){return b?a.getColumnFromElem(b):null};this.getColumnFromElem=function(b){return b&&(b=angular.element(b))&&b[0].attributes["data-index"]&&(b=b[0].attributes["data-index"].value,0<=b&&b<a.columnList.length)?a.columnList[b]:null};this.getIndexFromElem=function(a){return a&&(a=angular.element(a))&&a[0].attributes["data-index"]?a[0].attributes["data-index"].value:-1};this.getRowFromElem=function(b){if(b&&(b=angular.element(b))&&b[0].attributes["data-index"]&&(b=b[0].attributes["data-index"].value,a.isRowIndexInRange(b)))return a.currentList[b]};this.isRowIndexInRange=function(b){return 0<=b&&b<a.currentList.length};this.isColIndexInRange=function(b){return 0<=b&&b<a.columnList.length};this.isRowEnabled=function(b){return b&&g.isEnabled(b[a.options.rowFields.enabled])};this.mouseButtonStatus=function(a){ua=a};c.$on(c.name+"-ensure-visible",function(b,c){a.ensureVisible(c)});c.$on(c.name+"-find-row-by-id",function(b,c){f.setTempData(a.findRowById(c))});c.$on(c.name+"-find-row-by-path",function(b,c,d){f.setTempData(a.findRowByPath(c,d))});c.$on(c.name+"-find-row-by-text",function(b,c){f.setTempData(a.findRowByText(c))});c.$on(c.name+"-get-full-path",function(b,c){f.setTempData(a.getFullPath(c))});c.$on(c.name+"-get-row-level",function(b,c){f.setTempData(a.getLevel(c))});c.$on(c.name+"-get-row-parent",function(b,c){f.setTempData(a.getParent(c))});c.$on(c.name+"-get-flat-list",function(b,c){c?f.setTempData(a.getFullList()):f.setTempData(a.currentList)});c.$on(c.name+"-get-list",function(b,c){f.setTempData(a.getList(c))});this.ensureVisible=function(b,c){if(b){for(var d=[],g=a.getParent(b);g;)d.push(g),g=a.getParent(g);for(g=d.length-1;0<=g;g--)d[g][a.options.rowFields.expanded]=!0;a.updateCurrentLayout();var f=l(function(){c=void 0!=c?c:"center";a.scrollTo(b,c);l.cancel(f)},100)}};this.findRowById=function(b){return a.rowsObj.findObjectById(b)};this.findRowByText=function(b){return a.rowsObj.findObjectByText(b)};this.findRowByPath=function(b,c){var d=null;c||(c=a.getFullList());for(var g=0;g<c.length;g++)if(a.getFullPath(c[g])==b){d=c[g];break}return d};this.getFullPath=function(b){var c="";if(b)for(c=b[a.options.rowFields.text],b=a.getParent(b);b;)c=[b[a.options.rowFields.text],a.options.pathSeparator,c].join(""),b=a.getParent(b);return c};this.getLevel=function(a){var c=0;for(a=this.getParent(a);a;)c++,a=this.getParent(a);return c};this.getParent=function(b){return a.rowsObj.getParent(b)};this.getList=function(b){return a.rowsObj.getList(b)};this.getFirstRow=function(){for(var b=null,c=0;c<a.currentList.length;c++)if(g.isEnabled(a.currentList[c][a.options.rowFields.enabled])){b=a.currentList[c];break}return b};this.getPrevRow=function(b){var c=null;if(0<=b&&b<a.currentList.length)for(--b;0<=b;b--)if(g.isEnabled(a.currentList[b][a.options.rowFields.enabled])){c=a.currentList[b];break}return c};this.getNextRow=function(b){var c=null;for(b+=1;b<a.currentList.length;b++)if(g.isEnabled(a.currentList[b][a.options.rowFields.enabled])){c=a.currentList[b];break}return c};this.getLastRow=function(){for(var b=null,c=a.currentList.length-1;0<=c;c--)if(g.isEnabled(a.currentList[c][a.options.rowFields.enabled])){b=a.currentList[c];break}return b};this.updateSelectionStatus=function(b){switch(b){case "shift":switch(a.options.selectionMode){case "multi-simple":a.multiSelection(!0);break;case "multi-extended":a.multiSelection(!0);break;default:a.multiSelection(!1)}break;case "ctrl":switch(a.options.selectionMode){case "multi-simple":a.multiSelection(!0);break;case "multi-extended":a.multiSelection(!0);break;default:a.multiSelection(!1)}}};d.bind("keydown",function(b){switch(b.keyCode){case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;default:(b.ctrlKey||b.metaKey)&&a.updateSelectionStatus("ctrl"),b.shiftKey&&a.updateSelectionStatus("shift")}});this.allowUpdate=!0;this.updateType="all";this.suspendLayout=function(){a.allowUpdate=!1};this.resumeLayout=function(){a.allowUpdate=!0;a.updateLayout()};c.$on(c.name+"-refresh",function(b,c,d){a.refresh(c,d)});c.$on(c.name+"-resume-layout",function(b){a.resumeLayout()});c.$on(c.name+"-suspend-layout",function(b){a.suspendLayout()});c.$on(c.name+"-update-layout",function(b){a.updateLayout()});c.$on(c.name+"-update-view",function(b){a.updateView()});angular.element('<div class="iui-load-window"></div>');c.$on(c.name+"-begin-load",function(b,c){if(c)a.options.loadRow=c;else{a.showLoading=!0;var g=d.children();0<g.length&&g.css("opacity","0")}});c.$on(c.name+"-end-load",function(b){a.options.loadRow=null;if(a.showLoading){a.showLoading=!1;var c=d.children();if(0<c.length)var g=333,f=p(function(){1E3<g?(c.css("opacity","1"),p.cancel(f)):(c.css("opacity",g/1E3),g+=333)},100)}});this.callLoadComplete=function(a){angular.isDefined(c.events)&&c.events.loadComplete?c.events.loadComplete():c.loadComplete()};c.$on(c.name+"-get-scroll-pos",function(b){f.setTempData(a.getScrollPos())});c.$on(c.name+"-set-scroll-pos",function(b,c){a.setScrollPos(c)});c.$on(c.name+"-scroll-to",function(b,c,d){a.scrollTo(c,d)});var t=!1;this.multiSelection=function(a){if(void 0!=a)t=a;else return t};this.columnSelection=function(b,e){if(b){var d=!0;a.options.selectedColumn&&(d=!g.isEqual(a.options.selectedColumn[a.options.columnFields.id],b[a.options.columnFields.id]));var f=!0,f=angular.isDefined(c.events)&&c.events.beforeSelect?c.events.beforeSelect({object:b}):c.beforeSelect({e:{object:b}});d&&!1!==f&&(a.options.selectedColumn&&(a.options.selectedColumn.selected=!1,a.refresh(a.options.selectedColumn)),a.options.selectedColumn=b,b.selected=!0,angular.isDefined(c.selectedColumn)&&(c.selectedColumn=b),a.refresh(a.options.selectedColumn),a.callAfterSelect(b))}else return a.options.selectedColumn};this.isRowSelected=function(a){return g.isSelected(a)};this.clearPrevSelection=function(b){for(var c=0;c<a.options.selectedRows.length;c++)b&&!g.isEqual(a.options.selectedRows[c][a.options.rowFields.id],b[a.options.rowFields.id])?a.options.selectedRows[c].selected=!1:b||(a.options.selectedRows[c].selected=!1);a.options.selectedRows.length=0;b&&0!=b[a.options.rowFields.enabled]&&a.options.selectedRows.push(b);a.refreshRows()};this.markSelColumn=function(){for(var b=0;b<a.columnList.length;b++)a.refresh(a.columnList[b])};this.rowSelection=function(b,e,d,f){if(b){if("none"!=a.options.selectionMode)if(a.isRowEnabled(b)){d=a.rowSelection();var h=!0;d&&(h=!g.isEqual(d[a.options.rowFields.id],b[a.options.rowFields.id]));var l=!0,l=angular.isDefined(c.events)&&c.events.beforeSelect?c.events.beforeSelect({object:b}):c.beforeSelect({e:{object:b}});if(!1!==l)if(h){h=!0;"multi-extended"==a.options.selectionMode&&(h=!a.isObjInSelList(b));h&&(ua&&e?a.clearPrevSelection():t||"multi-simple"===a.options.selectionMode||a.clearPrevSelection());a.options.selectedRow=b;if(ua&&e&&"one"!=a.options.selectionMode){if(e=a.getRowCurrentIndex(d),f=a.getRowCurrentIndex(b),e>f&&(d=e,e=f,f=d),a.isRowIndexInRange(e)&&a.isRowIndexInRange(f))for(;e<=f;e++)a.currentList[e].selected=!0,a.options.selectedRows.push(a.currentList[e])}else ua&&(t||"multi-simple"===a.options.selectionMode)?(e=null===b.selected||"undefined"===b.selected?!1:b.selected,b.selected=!e,b.selected?a.isObjInSelList(b)||a.options.selectedRows.push(b):a.options.selectedRows=a.options.selectedRows.filter(function(a){return a!=b})):(b.selected=!0,a.isObjInSelList(b)||a.options.selectedRows.push(b));angular.isDefined(c.selectedRow)&&(c.selectedRow=b);a.callAfterSelect(b);a.refresh(null,null,!0)}else if(t||"multi-simple"===a.options.selectionMode)e=null===b.selected||"undefined"===b.selected?!1:b.selected,f&&"undefined"!==f&&(e=f),b.selected=!e,b.selected?a.isObjInSelList(b)||a.options.selectedRows.push(b):a.options.selectedRows=a.options.selectedRows.filter(function(a){return a!=b}),a.callAfterSelect(b),a.refresh(null,null,!0)}else a.clearPrevSelection()}else return a.options.selectedRow};this.updateSelection=function(b,c){"multi-extended"==a.options.selectionMode&&0<a.options.selectedRows.length&&!c&&!t&&(a.clearPrevSelection(b),a.refresh(null,null,!0))};this.isObjInSelList=function(b){var c=!1,d=a.options.selectedRows;if(b&&d)for(var f=0;f<d.length;f++)if(g.isEqual(d[f][a.options.rowFields.id],b[a.options.rowFields.id])){c=!0;break}return c};this.markSelRows=function(){var b=a.getRowElems();if(b&&0<b.length)for(var c=0;c<b.length;c++){var d=a.getRowFromElem(b[c]);d&&a.refresh(d)}};c.$on(c.name+"-clear-selection",function(b){a.options.selectedColumn&&(a.options.selectedColumn.selected=!1);a.options.selectedColumn=null;a.clearPrevSelection();a.options.selectedRow=null});c.$on(c.name+"-get-selected-column",function(b){f.setTempData(a.columnSelection())});c.$on(c.name+"-set-selected-column",function(b,c){a.columnSelection(c)});c.$on(c.name+"-get-selected-row",function(b){f.setTempData(a.rowSelection())});c.$on(c.name+"-set-selected-row",function(b,c){var d=l(function(){a.rowSelection(c);l.cancel(d)},1)});c.$on(c.name+"-get-selected-rows",function(b){f.setTempData(a.options.selectedRows)});c.$watch("options",function(b,c){b!==c&&(a.updateOptions(b),a.updateLayout())},!0);c.$watch("allowCellFocus",function(b,c){b!==c&&(a.options.allowCellFocus=b)});c.$watch("allowColumnReorder",function(b,c){b!==c&&(a.options.allowColumnReorder=b)});c.$watch("allowFilter",function(b,c){b!==c&&(a.options.allowFilter=b)});c.$watch("allowFocus",function(b,c){b!==c&&(a.options.allowFocus=b)});c.$watch("allowDrag",function(b,c){b!==c&&(a.options.allowDrag=b,a.updateView())});c.$watch("allowDrop",function(b,c){b!==c&&(a.options.allowDrop=b,a.updateView())});c.$watch("autoExpand",function(b,c){b!==c&&(a.options.autoExpand=b)});c.$watch("controlStyle",function(b,c){b!==c&&a.updateControlStyle(b)});c.$watch("editorSettings",function(b,c){b!==c&&a.updateEditorSettings(b)});c.$watch("expandingColumnIndex",function(b,c){b!==c&&(a.options.expandColIndex=b)});c.$watch("fields",function(b,c){b!==c&&(a.updateDataFields(b),a.UpdateData())});c.$watch("fillSpace",function(b,c){b!==c&&(a.options.fillSpace=b)});c.$watch("gridLines",function(b,c){b!==c&&(a.options.gridLines=b,a.updateView())});c.$watch("hoverSelection",function(b,c){b!==c&&(a.options.hoverSelection=b)});c.$watch("rowIcon",function(b,c){b!==c&&(a.options.rowIcon=b,a.updateLayout())});c.$watch("labelEdit",function(b,c){b!==c&&(a.options.labelEdit=b)});c.$watch("pathSeparator",function(b,c){b!==c&&(a.options.pathSeparator=b)});c.$watch("rtl",function(b,c){b!==c&&(a.options.rtl=b,a.updateLayout())});a.resetSelection=function(){switch(a.options.selectionMode){case "none":a.clearPrevSelection();break;default:a.clearPrevSelection(a.rowSelection())}};c.$watch("selectionMode",function(b,c){b!==c&&(a.options.selectionMode=b,a.resetSelection())});c.$watch("showFooter",function(b,c){b!==c&&(a.options.showFooter=b,a.updateLayout())});c.$watch("showHeader",function(b,c){b!==c&&(a.options.showHeader=b,a.updateLayout())});c.$watch("showIcons",function(b,c){b!==c&&(a.options.showIcons=b,a.updateLayout())});c.$watch("selectedRow",function(b,c){b!==c&&(c&&(c.selected=!1),a.options.selectedRow=b,a.callAfterSelect(b))});this.sortComparer=this.sortColumn=null;c.$watch("sorting",function(b,c){b!==c&&(a.options.sorting=b)});c.$on(c.name+"-sort",function(b,c,d,g){a.sort(c,d,g)});this.sort=function(b,c,d){a.sortColumn=b;a.sortComparer=d;if("ascending"==c||"descending"==c||"none"==c)a.options.sorting=c;a.updateCurrentLayout()};this.getCellIndexInCollection=function(b,c,d){var g=-1;if(b)for(var f=0;f<b.length;f++)if(void 0==b[f][a.options.cellFields.cid]){g=c;break}else if(b[f][a.options.cellFields.cid]==d){g=f;break}return g};this.isSortingAllowed=function(){return"ascending"==a.options.sorting||"descending"==a.options.sorting};this.applySorting=function(b){if(b&&(!a.sortColumn||0!=a.sortColumn[a.options.columnFields.visible])){var c=a.getColumnCurrentIndex(a.sortColumn),d=0<=c?c:a.options.expandColIndex;if(d<a.columnList.length){var f=a.columnList[d][a.options.columnFields.id];a.sortColumn&&a.sortColumn[a.options.columnFields.comparer]?b.sort(a.sortColumn[a.options.columnFields.comparer]):a.sortComparer?b.sort(a.sortComparer):a.isSortingAllowed()&&b.sort(function(b,c){var e=null,h=null;if(b[a.options.rowFields.cells]){var l=a.getCellIndexInCollection(b[a.options.rowFields.cells],d,f);0<=l&&((e=b[a.options.rowFields.cells][l][a.options.cellFields.value])||(e=b[a.options.rowFields.cells][l][a.options.cellFields.text]),g.isObject(e)&&(e=e.value?e.value:e.text))}c[a.options.rowFields.cells]&&(l=a.getCellIndexInCollection(c[a.options.rowFields.cells],d,f),0<=l&&((h=c[a.options.rowFields.cells][l][a.options.cellFields.value])||(h=c[a.options.rowFields.cells][l][a.options.cellFields.text]),g.isObject(h)&&(h=h.value?h.value:h.text)));e=void 0!=e?e:null;h=void 0!=h?h:null;switch(a.options.sorting){case "ascending":if(e<h)return-1;if(e>h)return 1;break;case "descending":if(e>h)return-1;if(e<h)return 1;break;default:return 0}})}}};var H=function(b){if(b){var c=g.isFieldAvailable(b.general,"iui-treegrid-column"),d;d=(d=b.header)?{content:g.isFieldAvailable(d.content,"iui-treegrid-column-header-cell-content"),disabled:g.isFieldAvailable(d.disabled,"iui-treegrid-column-header-disabled"),normal:g.isFieldAvailable(d.normal,"iui-treegrid-column-header"),hovered:g.isFieldAvailable(d.hovered,"iui-treegrid-column-header-hovered"),selected:g.isFieldAvailable(d.selected,"iui-treegrid-column-header-selected")}:a.options.controlStyle.column.header;b=(b=b.footer)?{content:g.isFieldAvailable(b.content,"iui-treegrid-column-footer-cell-content"),disabled:g.isFieldAvailable(b.disabled,"iui-treegrid-column-footer-disabled"),normal:g.isFieldAvailable(b.normal,"iui-treegrid-column-footer"),hovered:g.isFieldAvailable(b.hovered,"iui-treegrid-column-footer-hovered"),selected:g.isFieldAvailable(b.selected,"iui-treegrid-column-footer-selected")}:a.options.controlStyle.column.footer;return{general:c,header:d,footer:b}}return a.options.controlStyle.column};this.getExpandBoxStyle=function(b){return b?{general:g.isFieldAvailable(b.general,"iui-treegrid-expand-box"),animated:g.isFieldAvailable(b.animated,"iui-treegrid-expand-box-load"),expanded:g.isFieldAvailable(b.expanded,"iui-treegrid-expand-box-open"),collapsed:g.isFieldAvailable(b.collapsed,"iui-treegrid-expand-box-close")}:a.options.controlStyle.row.expandBox};var K=function(b){if(b){var c;c=(c=b.general)?{disabled:g.isFieldAvailable(c.disabled,"iui-treegrid-row-disabled"),focused:g.isFieldAvailable(c.focused,"iui-treegrid-row-focused"),normal:g.isFieldAvailable(c.normal,"iui-treegrid-row"),hovered:g.isFieldAvailable(c.hovered,"iui-treegrid-row-hovered"),selected:g.isFieldAvailable(c.selected,"iui-treegrid-row-selected")}:a.options.controlStyle.row.general;var d;var f=b.checkBox;f?(d=g.isFieldAvailable(f.general,"iui-checkbox"),f=(f=f.box)?{general:g.isFieldAvailable(f.general,"iui-checkbox-box"),disabled:g.isFieldAvailable(f.disabled,"iui-checkbox-disabled"),checked:g.isFieldAvailable(f.checked,"iui-checkbox-checked"),indeterminate:g.isFieldAvailable(f.indeterminate,"iui-checkbox-indeterminate"),unchecked:g.isFieldAvailable(f.unchecked,"iui-checkbox-unchecked")}:a.options.controlStyle.row.checkBox.box,d={general:d,box:f}):d=a.options.controlStyle.row.checkBox;f=a.getExpandBoxStyle(b.expandBox);b=(b=b.cell)?{content:g.isFieldAvailable(b.content,"iui-treegrid-row-cell-content"),general:g.isFieldAvailable(b.general,"iui-treegrid-row-cell"),disabled:g.isFieldAvailable(b.disabled,"iui-treegrid-row-cell-disabled"),focused:g.isFieldAvailable(b.focused,"iui-treegrid-row-cell-focused"),normal:g.isFieldAvailable(b.normal,"iui-treegrid-row-cell"),hovered:g.isFieldAvailable(b.hovered,"iui-treegrid-row-cell-hovered"),selected:g.isFieldAvailable(b.selected,"iui-treegrid-row-cell-selected")}:a.options.controlStyle.row.cell;return{general:c,checkBox:d,expandBox:f,cell:b}}return a.options.controlStyle.row},fa=function(b){return b?{content:g.isFieldAvailable(b.content,"iui-treegrid-row-cell-content"),general:g.isFieldAvailable(b.general,"iui-treegrid-row-cell"),disabled:g.isFieldAvailable(b.disabled,"iui-treegrid-row-cell-disabled"),focused:g.isFieldAvailable(b.focused,"iui-treegrid-row-cell-focused"),normal:g.isFieldAvailable(b.normal,"iui-treegrid-row-cell"),hovered:g.isFieldAvailable(b.hovered,"iui-treegrid-row-cell-hovered"),selected:g.isFieldAvailable(b.selected,"iui-treegrid-row-cell-selected")}:a.options.controlStyle.cell};this.updateControlStyle=function(b){a.options.controlStyle=b?{general:g.isFieldAvailable(b.general,"iui-treegrid"),column:H(b.column),row:K(b.row),cell:fa(b.cell)}:{general:g.isFieldAvailable(a.defaultStyle.general,"iui-treegrid"),column:H(a.defaultStyle.column),row:K(a.defaultStyle.row),cell:fa(a.defaultStyle.cell)}};this.getCurrentColumnStyle=function(b,c,d){var g=a.options.controlStyle.column;b&&b.style&&(g=b.style);b=a.options.controlStyle.column.body;var f=g.body;switch(c){case "header":b=a.options.controlStyle.column.header;f=g.header;break;case "footer":b=a.options.controlStyle.column.footer,f=g.footer}if(d)switch(d){case "content":return f&&f.content?f.content:b.content;case "disabled":return f&&f.disabled?f.disabled:b.disabled;case "hovered":return f&&f.hovered?f.hovered:b.hovered;case "selected":return f&&f.selected?f.selected:b.selected;default:return f&&f.normal?f.normal:b.normal}else return c?f?f:b:g?g:a.options.controlStyle.column};this.getCurrentRowStyle=function(b,c){var d=a.options.controlStyle.row;if(b)switch(b[a.options.rowFields.style]){case "initial":break;case "parent":return a.getCurrentRowStyle(a.getParent(b),c);default:null!=b.style&&(d=b.style)}if(c){if(g.isString(d.general))return d.general;switch(c){case "disabled":return d.general&&d.general.disabled?d.general.disabled:a.options.controlStyle.row.general.disabled;case "focused":return d.general&&d.general.focused?d.general.focused:a.options.controlStyle.row.general.focused;case "hovered":return d.general&&d.general.hovered?d.general.hovered:a.options.controlStyle.row.general.hovered;case "selected":return d.general&&d.general.selected?d.general.selected:a.options.controlStyle.row.general.selected;default:return d.general&&d.general.normal?d.general.normal:a.options.controlStyle.row.general.normal}}else return d?d:a.options.controlStyle.row};this.getDefaultCellContentClass=function(){return"iui-treegrid-row-cell-content"};this.getDefaultCellLabelClass=function(){return"iui-treegrid-row-cell-label"};this.getDefaultCellBorderClass=function(){return"iui-treegrid-lines-both"};this.getCurrentCellStyle=function(b,c,d){var f=a.options.controlStyle.row.cell;if(c)switch(c[a.options.cellFields.style]){case "initial":break;case "parent":b&&(f=fa(a.getCurrentRowStyle(b)));break;default:c.style&&(f=c.style)}if(d)switch(d){case "content":return f.content?f.content:a.options.controlStyle.cell.content;case "disabled":return f.disabled?f.disabled:a.options.controlStyle.cell.disabled;case "focused":return f.focused?f.focused:a.options.controlStyle.cell.focused;case "hovered":return f.hovered?f.hovered:a.options.controlStyle.cell.hovered;case "selected":return f.selected?f.selected:a.options.controlStyle.cell.selected;default:return f.normal?f.normal:a.options.controlStyle.cell.normal}else return f?f:a.options.controlStyle.row.cell}}]).directive("iuiTreegrid",["$compile","$timeout","$interval","IntegralUIInternalService","IntegralUIDragDrop","$window","IntegralUIListCtrlService",function(c,d,l,h,p,g,N){return{restrict:"EA",controller:"IntegralUITreeGridController",transclude:!0,replace:!0,template:'<div class="iui-treegrid" data-element="treegrid"><div class="iui-treegrid-block"></div></div>',scope:{allowAnimation:"=",allowCellFocus:"=",allowColumnReorder:"=",allowFilter:"=",allowFocus:"=",allowDrag:"=",allowDrop:"=",animationSpeed:"=",autoExpand:"=",columns:"=",controlStyle:"=",editorSettings:"=",expandingColumnIndex:"=",fields:"=",fillSpace:"=",gridLines:"=",hoverSelection:"=",labelEdit:"=",name:"@",options:"=?",pathSeparator:"@",rowIcon:"=",rows:"=",selectedIndex:"=",selectedRow:"=",selectionMode:"@",showFooter:"=",showHeader:"=",showIcons:"=",sorting:"@",afterCollapse:"&",afterEdit:"&",afterExpand:"&",afterLabelEdit:"&",afterSelect:"&",beforeCollapse:"&",beforeEdit:"&",beforeExpand:"&",beforeLabelEdit:"&",beforeSelect:"&",cellClick:"&",cellvalueChanged:"&",cellvalueChanging:"&",clearColumns:"&",clearRows:"&",columnAdded:"&",columnAdding:"&",columnClick:"&",columnDblclick:"&",columnHover:"&",columnPoschanging:"&",columnPoschanged:"&",columnRemoved:"&",columnRemoving:"&",columnRightclick:"&",columnSizechanged:"&",dragDrop:"&",dragEnter:"&",dragLeave:"&",dragOver:"&",events:"=?",gotFocus:"&",keyDown:"&",keyPress:"&",keyUp:"&",loadComplete:"&",lostFocus:"&",rowAdded:"&",rowAdding:"&",rowClick:"&",rowDblclick:"&",rowHover:"&",rowRemoved:"&",rowRemoving:"&",rowRightclick:"&",scrollposChanged:"&",selectionChanged:"&"},link:function(f,n,Va,a,ib){var y=this,M=n.children().eq(0),F=angular.element('<div class="iui-scrollbar-vertical"><div class="iui-scroll-button-thumb-vertical"></div></div>'),z=angular.element('<div class="iui-scrollbar-horizontal"><div class="iui-scroll-button-thumb-horizontal"></div></div>'),pa=angular.element('<div class="iui-scrollbar-corner"></div>'),Y=null,T=null,ea=null,Ba=!1,x=angular.element('<input type="text" class="iui-label-editor" draggable="false" />');a.labelEditStatus=function(a){if(void 0!=a)Ba=a;else return Ba};var ua=function(){var b="iui-treegrid-block";a.options.showStatusIcons&&(b+=" "+b+"-shift-left");a.options.rtl&&(b+=" "+b+"-rtl");return b};f.$on("destroy",function(a){y.s2t();U&&U.unbind("mousedown");n.unbind("click dblclick dragenter dragleave dragend drop keydown mousedown mouseleave mousemove mousewheel scroll");angular.element(g).unbind("dragenter dragover dragend mousemove mousedown mouseup");x&&x.unbind("blur focus keydown mousedown");jb();C&&C.$destroy();u&&u.$destroy()});a.dragIcon=document.createElement("img");a.dragIcon.width=1;n.append(a.getDropMarkWindow());a.dropMark();a.addDropMark=function(){var b;b=n[0];for(var c=null;b;){if(b===document.getElementsByTagName("body")[0]){c=b;break}b=b.offsetParent}if(b=c)angular.element(b).append(a.getDropMarkWindow()),a.dropMark()};a.removeDropMark=function(){a.getDropMarkWindow().remove()};a.isDropInRange=function(b){b=a.getMousePos(b);var c=n[0].getBoundingClientRect();b.x-=angular.element(g)[0].pageXOffset;b.y-=angular.element(g)[0].pageYOffset;var d=c.top+Z,c=c.bottom-ia;O&&z&&(c-=z[0].offsetHeight);return b.y<d||b.y>c?!1:!0};a.openEditor=function(b,c){if(b)switch(b.type){case "cell":c||(c=a.getColumnById(b[a.options.cellFields.cid]));if(!c){var d=a.getCellColumnIndex(b),q=a.columnsObj.getList();q&&0<=d&&d<q.length&&(c=q[d])}if(c){var d=a.getCellType(b,a.getColumnRealIndex(c)),q=a.getCellRowIndex(b),w=a.getCellColumnIndex(b);if(q=a.getElemFromCell(q,w))switch(d){case "checkbox":break;case "combobox":break;case "incell":a.openInCellEditor(q,b,c);break;case "dropdown":a.openDropDownEditor(q,b,c);break;default:0!=b[a.options.cellFields.allowEdit]&&Ja(null,q,0)}}}};a.closeEditor=function(b,c){if(b)switch(b.type){case "cell":if(c||(c=a.getColumnById(b[a.options.cellFields.cid])),c)switch(a.getCellType(b,a.getColumnRealIndex(c))){case "incell":a.closeActiveEditor(b);break;case "dropdown":a.closeActiveEditor(b)}}else a.closeActiveEditor();K=null};var t=null,H=!1,K=null,fa=null,b=angular.element('<span class="iui-edit-mark"></span>');a.openInCellEditor=function(b,m,v){H&&a.closeActiveEditor(m,!0);e();if(m&&v&&(K=m,v='<div ng-include="'+v[a.options.columnFields.editorTemplate]+'"></div>',t=angular.element('<div class="iui-incell-editor"></div>'),t.append(c(v)(f.$parent)),0!=a.callBeforeEdit(m))){b.children().eq(0).append(t);H=!0;fa="incell";k();t.bind("mousedown",function(a){a.stopPropagation()});t.bind("mouseup",function(a){a.stopPropagation()});t.bind("click",function(a){a.stopPropagation()});t.bind("keydown",function(b){switch(b.keyCode){case 27:a.closeActiveEditor(K)}b.stopPropagation()});t.bind("keypress",function(a){a.stopPropagation()});t.bind("keyup",function(a){a.stopPropagation()});var q=d(function(){var a=h.getPadding(b[0]),c=parseInt(getComputedStyle(b[0]).width,10)-(a.left+a.right),a=parseInt(getComputedStyle(b[0]).height,10)+2;t.css("width",c+"px");t.css("height",a+"px");f.$apply();t.children&&1==t.children().length&&(c=t.children().eq(0),c.children&&1==c.children().length&&c.children().eq(0).css("height",a+"px"));d.cancel(q)},1)}};a.openDropDownEditor=function(b,m,v){H&&a.closeActiveEditor(m,!0);e();if(m&&v&&(K=m,v='<div ng-include="'+v[a.options.columnFields.editorTemplate]+'"></div>',t=angular.element('<div class="iui-dropdown-editor"></div>'),t.append(c(v)(f.$parent)),0!=a.callBeforeEdit(m)))var q=d(function(){angular.element(oa).append(t);t.bind("mousedown",function(a){a.stopPropagation()});t.bind("mouseup",function(a){a.stopPropagation()});t.bind("click",function(a){a.stopPropagation()});H=!0;fa="dropdown";var a=b[0].getBoundingClientRect(),c=angular.element(g)[0].pageXOffset,m=angular.element(g)[0].pageYOffset,v=d(function(){var q=h.getPadding(b[0]),q=parseInt(getComputedStyle(b[0]).width,10)+(q.left+q.right),e=h.getPadding(t[0]),q=q-(e.left+e.right),e=parseInt(getComputedStyle(t[0]).width,10);q<e&&(q=e);e=a.right-(q+3)+c;t.css("top",a.bottom+m+"px");t.css("left",e+"px");t.css("width",q+"px");f.$apply();d.cancel(v)},1);d.cancel(q)},1)};a.closeActiveEditor=function(b,c){H=!1;e();t&&t.remove();fa=K=null;c||a.callAfterEdit(b)};var e=function(){t&&t.unbind("click keydown keypress keyup mousedown mouseup")},X=function(a,c){a&&(b.addClass("iui-edit-mark iui-edit-mark-"+c),a.append(b),b.css("right","2px"),b.css("top",(a[0].offsetHeight-b[0].offsetHeight)/2+"px"))},k=function(){b&&("dropdown"!=fa||"dropdown"==fa&&!H)&&(b.removeAttr("class"),b.remove())},Wa=null,ta=angular.element('<div class="iui-dropdown-mark"><span></span></div>'),Xa=function(a,b){!a||va&&!b||(a.append(ta),ta.css("right",0),ta.css("height",getComputedStyle(a[0]).height))},ha=function(a){!ta||va&&!a||ta.remove()};a.getCellType=function(b,c){var d=null,q="label";b&&(d=a.getColumnById(b[a.options.cellFields.cid]));!d&&0<=c&&c<a.columnList.length&&(d=a.columnList[c]);d&&(q=d[a.options.columnFields.editorType]);return q};var oa=h.getBodyElem(n[0]),Aa=h.getUniqueId(4),P=null,va=!1,Ca=0,Gb=function(b,m,e){if(oa&&b.items&&0<b.items.length){b=h.getUniqueId(4);var q=c('<iui-list name="'+b+'" style="position:absolute;top:-99px;height:100px" items="data['+m+"].column."+a.options.columnFields.editorSettings+'.items"></iui-list>')(C);angular.element(oa).append(q);N.updateLayout(b);var w=d(function(){if(0<q.children().length){var a=q.children().eq(0);0<a.children().length&&(Ca=angular.element(a.children().eq(0))[0].offsetHeight,e&&(e.avgItemHeight=Ca))}q.remove();d.cancel(w)},1)}},qa=null,Ya=function(b,m,e,q){var w=a.getCell(e,q);if(w!=Wa&&(Wa=w,P&&P.remove(),qa&&qa.$destroy(),oa)){qa=f.$new();qa.data=a.columnList[q];K=w;var aa='<iui-list name="'+Aa+'" style="position:absolute;"',aa=aa+(' items="data.'+a.options.columnFields.editorSettings+'.items"'),aa=aa+(' item-icon="data.'+a.options.columnFields.editorSettings+'.itemIcon"'),aa=aa+(' show-icons="data.'+a.options.columnFields.editorSettings+'.showIcons"'),aa=aa+(' checkbox-settings="data.'+a.options.columnFields.editorSettings+'.checkBoxSettings"'),aa=aa+(' show-check-boxes="data.'+a.options.columnFields.editorSettings+'.checkBoxSettings.showCheckBoxes"');P=c(aa+(' nav-selection="false" before-select="onCellValueChanging(e, '+e+", "+q+')" after-select="onCellValueChanged(e, '+e+", "+q+')"></iui-list>'))(qa);Ca=0;wa&&q<wa.length&&(Ca=wa[q].avgItemHeight);var Fb=d(function(){angular.element(oa).append(P);var c=b[0].getBoundingClientRect(),q=angular.element(g)[0].pageXOffset,e=angular.element(g)[0].pageYOffset,e=c.bottom+e-1,c=c.left+q,q=b.children().eq(0),v=h.getPadding(q[0]),q=parseInt(getComputedStyle(q[0]).width,10)+(v.left+v.right),v=h.getPadding(P[0]),q=q-(v.left+v.right);void 0!=m.dropDownWidth&&q<m.dropDownWidth&&(q=m.dropDownWidth);v=void 0!=m.dropDownHeight?m.dropDownHeight:100;void 0!=m.maxDropDownItems&&(v=Ca*m.maxDropDownItems);P.css("top",e+"px");P.css("left",c+"px");P.css("width",q+"px");P.css("height",v+"px");P.css("z-index","999");w&&w[a.options.cellFields.value]&&N.selectedItem(Aa,w[a.options.cellFields.value]);N.updateLayout(Aa);var f=d(function(){if(w&&w[a.options.cellFields.value]){N.ensureVisible(Aa,w[a.options.cellFields.value]);var b=d(function(){N.focus(Aa,w[a.options.cellFields.value]);d.cancel(b)},1)}d.cancel(f)},10);ta&&(ha(!0),Xa(b,!0));va=!0;Hb();d.cancel(Fb)},1)}};a.removeDropDownList=function(a){P&&(Wa=null,P.remove(),va=!1,a||ha(),P.unbind("keydown"));qa&&qa.$destroy();K=null};var Hb=function(){P.bind("keydown",function(b){switch(b.keyCode){case 27:a.removeDropDownList(),ha()}})},Ja=function(b,c,e){a.options.labelEdit&&(void 0===e&&(e=500),T=d(function(){if(T)var a=d(function(){Ka(b,c,!0);d.cancel(a)},e);d.cancel(T)},e/3))},Da=null,Ea=null,Ka=function(b,c,e){var q=a.getRowFromChildElem(c);if(q){var w=a.getRowCurrentIndex(q),f=a.getIndexFromElem(c),g=a.getCellObject(w,f),h="",h=c.children().eq(0);if(g)if(e){if(0!=a.callBeforeLabelEdit(g)){Da=q;Ea=g;a.labelEditStatus(!0);x.unbind("blur focus keydown mousedown");b=parseInt(getComputedStyle(c[0]).width,10)-4;e=parseInt(getComputedStyle(c[0]).height,10)-3;x.css("width",b+"px");x.css("height",e+"px");h.append(x);x[0].value=g[a.options.cellFields.text];x.bind("keydown",function(b){switch(b.keyCode){case 13:g[a.options.cellFields.text]=x[0].value?x[0].value:"null";Ka(b,c,!1);break;case 27:Ka(b,c,!1)}b.stopPropagation()});x.bind("focus",function(b){var c=angular.element(this);a.callGotFocus(b,Da,Ea,!0,c[0].value)});x.bind("blur",function(a){Ka(a)});x.bind("mousedown",function(a){a.stopPropagation()});var k=d(function(){x[0].focus();x[0].select();d.cancel(k)},10)}}else h=x[0].value,a.labelEditStatus(!1),x.unbind("blur focus keydown"),x.remove(),a.updateView(),a.updateFocus(w,f),a.callAfterLabelEdit(g),a.callLostFocus(b,q,g,!0,h),Ea=Da=null}else h=x[0].value,a.labelEditStatus(!1),x.unbind("blur focus keydown mousedown"),x.remove(),a.callAfterLabelEdit(),a.updateView(),a.callLostFocus(b,Da,Ea,!0,h),Ea=Da=null};n.bind("mousemove",function(b){if(0===b.button&&ba&&L){a.getColumnCurrentIndex(L);var c=a.getMousePos(b),d=c.y+16,c=c.x+20;da.empty();da.append("<span>"+L[a.options.columnFields.headerText]+"</span>");da.css("top",d+"px");da.css("left",c+"px");da.css("display","block");kb();b.stopPropagation()}});var nb=function(){if(D&&0<D.length)for(var b=0;b<D.length;b++){var c=angular.element(D[b]);lb(c);for(var c=c.find("td"),d=0;d<c.length;d++){var q=angular.element(c[d]),e=a.getElement(q,"expandbox");e&&e.unbind("click");mb(q)}}},jb=function(){e();var b=M.find("tr");if(0<b.length)for(var c=0;c<b.length;c++){var d=angular.element(b[c]);lb(d);for(var d=d.find("td"),q=0;q<d.length;q++){var w=angular.element(d[q]);if(w){var f=a.getChildElement(w,"column-header-cell");f&&(f=a.getContentElement(f,"filter-button"))&&f.unbind("mousedown")}(f=a.getElement(w,"expandbox"))&&f.unbind("click");mb(w)}}},ba=!1,L=null,xa=-1,La=function(b,c){if(b){var d=a.getColumnCurrentIndex(b),q=a.getColumnWidth(b);return a.isColumnWithFixedWidth(d)||10<c.x&&c.x<q-10}return!1},Jb=function(b){b=b.find("td");for(var c=0;c<b.length;c++)currentElem=angular.element(b[c]),currentElem.bind("click",function(b){if(1===b.which){var c=h.getClientMousePos(b,this),d=a.getColumnFromElem(this);d&&La(d,c)&&a.callColumnClick(d,a.getMousePos(b))}b.stopPropagation()}),currentElem.bind("dblclick",function(b){b.preventDefault();if(1===b.which){var c=h.getClientMousePos(b,this),d=a.getColumnFromElem(this);d&&La(d,c)&&a.callColumnDblClick(d,a.getMousePos(b))}b.stopPropagation()}),currentElem.bind("mouseenter",function(b){if(!V&&!ca){var c=a.getColumnFromElem(this);c&&(a.hoverColumn=c,a.refresh(c),a.callColumnHover(c));if(1===b.which&&ba&&L&&a.hoverColumn&&0!=a.hoverColumn[a.options.columnFields.allowDrop]&&Q&&(Q.remove(),a.hoverColumn!=L)){var d=angular.element(this);d.append(Q);b=parseInt(getComputedStyle(d[0]).height,10);c=parseInt(getComputedStyle(Q[0]).height,10);d=h.getPadding(d[0]);Q.css("top",(b+d.top+d.bottom-c)/2+"px")}}}),currentElem.bind("mouseleave",function(b){V||ca||(a.hoverColumn=null,(b=a.getColumnFromElem(this))&&a.refresh(b),Q&&Q.remove(),V||n.css("cursor","default"))}),currentElem.bind("mousemove",function(b){var c=angular.element(this);if(1===b.which&&ba&&L&&a.hoverColumn&&a.hoverColumn!=L&&0!=a.hoverColumn[a.options.columnFields.allowDrop])c=parseInt(getComputedStyle(c[0]).width,10),Q.empty(),xa=-1,b.offsetX>c/2?(xa=2,Q.append('<span class="iui-treegrid-column-reorder-mark-right"></span>'),Q.css("left","auto"),Q.css("right","0")):(xa=1,Q.append('<span class="iui-treegrid-column-reorder-mark-left"></span>'),Q.css("left","0"),Q.css("right","auto"));else{b=h.getClientMousePos(b,this);var c=a.getIndexFromElem(this),d=a.getColumnWidth(a.columnList[c]),r=10;a.isFilteringAllowed(a.columnList[c])&&(r=0);10>b.x&&0<c&&!a.isColumnWithFixedWidth(c-1)?(n.css("cursor","ew-resize"),ga="left"):b.x>d-r&&!a.isColumnWithFixedWidth(c)?(n.css("cursor","ew-resize"),ga="right"):V||(n.css("cursor","default"),ga="none")}}),currentElem.bind("mouseup",function(b){if(1===b.which&&ba&&L&&a.hoverColumn&&a.hoverColumn!=L&&0!=a.hoverColumn[a.options.columnFields.allowDrop]&&0!=a.callColumnPosChanging(L,a.hoverColumn)){b=a.columnList[0];0<=a.options.expandColIndex&&a.options.expandColIndex<a.columnList.length&&(b=a.columnList[a.options.expandColIndex]);var c=a.getColumnCurrentIndex(L),d=a.getColumnCurrentIndex(a.hoverColumn);c!=d&&(c<d?1==xa&&d--:c>d&&2==xa&&d++,a.columnsObj.moveObject(c,d),a.updateColumnList(),b=a.getColumnCurrentIndex(b),b!=a.options.expandColIndex?(a.options.expandColIndex=b,a.updateLayout()):a.updateView(),a.callColumnPosChanged(L,a.hoverColumn))}L=null;xa=-1;V=ba=!1;n.css("cursor","default")}),currentElem.bind("mousedown",function(b){a.removeDropDownList();a.closeFilterWindow();a.closeEditor();h.getClientMousePos(b,this);var c=a.getIndexFromElem(this);if(0===b.button&&!V){switch(ga){case "left":c--;0<=c&&(V=!0);break;case "right":V=!0}!a.isColumnWithFixedWidth(c)&&V?a.setColumnResizingParams(c,ga,a.getMousePos(b).x):V=!1}if(!V&&(c=a.getColumnFromChildElem(this))){var d=h.getClientMousePos(b,this);La(c,d)&&a.columnSelection(c);switch(b.which){case 1:a.options.allowColumnReorder&&0!=c[a.options.columnFields.allowDrag]&&0==ba&&(L=c,a.getMousePos(b),ba=!0,(c=h.getBodyElem(n[0]))&&angular.element(c).append(da));break;case 3:La(c,d)&&a.callColumnRightClick(c,a.getMousePos(b))}}b.stopPropagation()}),function(b){b&&(b=a.getChildElement(b,"column-header-cell"))&&(b=a.getContentElement(b,"filter-button"))&&b.bind("mousedown",function(a){1==a.which&&Ib(this);a.stopPropagation()})}(currentElem)},U=null,Ib=function(b){a.closeFilterWindow();var e=a.getColumnFromChildElem(b);if(e){var v=angular.element(b),q=v.parent().parent();if(oa){b='<div ng-include="'+e[a.options.columnFields.filterTemplate]+'"></div>';U=angular.element('<div class="iui-filter-window"></div>');U.append(c(b)(f.$parent));var w=d(function(){angular.element(oa).append(U);U.bind("mousedown",function(a){a.stopPropagation()});v[0].getBoundingClientRect();var a=q[0].getBoundingClientRect(),b=angular.element(g)[0].pageXOffset,c=angular.element(g)[0].pageYOffset,r=d(function(){var q=a.bottom+c,e=a.right-(parseInt(getComputedStyle(U[0]).width,10)+3)+b;U.css("top",q+"px");U.css("left",e+"px");d.cancel(r)},1);d.cancel(w)},1)}}};a.closeFilterWindow=function(){U&&(U.unbind("mousedown"),U.remove())};var lb=function(a){a&&a.unbind("blur dragover dragend focus keydown keyup keypress mousedown mouseenter mouseleave")},Kb=function(b){b&&(b.bind("dragover",function(b){var c=a.getRowFromElem(this);if(c&&a.isRowEnabled(c)){if(a.isScrollBarVisible("vertical")){var c=a.getMousePos(b),d=n[0].getBoundingClientRect();c.x-=angular.element(g)[0].pageXOffset;c.y-=angular.element(g)[0].pageYOffset;var e=d.top+Z+25,d=d.bottom-ia-25;O&&z&&(d-=z[0].offsetHeight);c.y<e?Ma(!1):c.y>d?Ma(!0):ya()}else ya();b.stopPropagation()}}),b.bind("dragend",function(b){var c=a.getRowFromElem(this);c&&a.isRowEnabled(c)&&(b.preventDefault(),a.dragDropStatus(!1),a.dropMark(),p.getData().source||p.clearData())}),b.bind("mouseenter",function(b){if(!ca){var c=a.getRowFromElem(this);c&&a.isRowEnabled(c)&&!ba&&(a.hoverRow=c,a.refresh(c),a.callRowHover(c),a.options.hoverSelection&&(ea=d(function(){ea&&a.rowSelection(c,b.shiftKey,b.ctrlKey)},500)))}}),b.bind("mouseleave",function(b){ca||(a.hoverRow=null,(b=a.getRowFromElem(this))&&a.isRowEnabled(b)&&a.refresh(b),ea&&(d.cancel(ea),ea=null))}),b.bind("keydown",function(b){var c=a.getRowFromElem(this);if(c&&a.isRowEnabled(c)){var d=!0;a.callKeyDown(b,c);var e=a.getRowCurrentIndex(c);switch(b.keyCode){case 9:ob(b,c,e);break;case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;case 27:d=!1;break;case 33:pb(b,e);break;case 34:qb(b,e);break;case 35:rb(b,e);break;case 36:sb(b,e);break;case 37:tb(b,c,e);break;case 32:b.preventDefault();Za(void 0,void 0);a.rowSelection(c,b.shiftKey,b.ctrlKey,c.selected);f.$apply();break;case 38:$a(b,e);break;case 39:ub(b,c,e);break;case 40:ab(b,e);break;default:(b.ctrlKey||b.metaKey)&&a.updateSelectionStatus("ctrl"),b.shiftKey&&a.updateSelectionStatus("shift")}d&&b.stopPropagation()}}),b.bind("keyup",function(b){var c=a.getRowFromElem(this);if(c&&a.isRowEnabled(c)){switch(b.keyCode){case 16:a.multiSelection(!1);break;case 17:a.multiSelection(!1);break;default:b.ctrlKey||b.metaKey||a.multiSelection(!1),b.shiftKey||a.multiSelection(!1)}a.callKeyUp(b,c)}}),b.bind("keypress",function(b){var c=a.getRowFromElem(this);c&&a.isRowEnabled(c)&&a.callKeyPress(b,c)}),b.bind("mousedown",function(b){a.removeDropDownList();a.closeFilterWindow();a.closeEditor()}),b.bind("focus",function(b){var c=a.getRowFromElem(this);c&&a.isRowEnabled(c)?a.callGotFocus(b,c):a.updateFocus()}),b.bind("blur",function(b){var c=a.getRowFromElem(this);c&&a.isRowEnabled(c)&&a.callLostFocus(b,c)}))},Lb=function(b){b&&b.bind("click",function(b){var c=a.getRowFromChildElem(this);c&&a.isRowEnabled(c)&&(a.toggle(c),a.updateFocus(a.getRowCurrentIndex(c),a.options.expandColIndex),b.stopPropagation())})},Mb=function(b,c,e){b&&(b.bind("dragstart",function(b){if(a.labelEditStatus())b.preventDefault();else{p.clearData();var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c))if(T&&(d.cancel(T),T=null),a.isDragAllowed(c)){a.dragDropStatus(!0);a.addDropMark();b.dataTransfer?(b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text",c[a.options.rowFields.id]?c[a.options.rowFields.id].toString():"")):b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed="move",b.originalEvent.dataTransfer.setData("text",c[a.options.rowFields.id]?c[a.options.rowFields.id].toString():""));b={source:c,sourceCtrl:a,sourceCollection:a.rowsObj};switch(a.options.selectionMode){case "multi-simple":b.source=a.options.selectedRows;break;case "multi-extended":b.source=a.options.selectedRows}p.setData(b)}else b.dataTransfer?b.dataTransfer.effectAllowed="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed="none")}}),b.bind("dragover",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){var d=angular.element(this);b.preventDefault();var e=!0;b.dataTransfer?e="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(e="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(e&&(c=a.getRowFromChildElem(d))){var e=d[0].getBoundingClientRect(),r=angular.element(g)[0].pageXOffset,m=angular.element(g)[0].pageYOffset,f=a.getMousePos(b);f.x-=e.left+r;f.y-=e.top+m;d=p.getDropPos(f,{x:0,y:0,width:d[0].offsetWidth,height:d[0].offsetHeight});r=p.getData();e=a.isDropAllowed(r.source,c,d);m={sourceTree:r.sourceCtrl?r.sourceCtrl.getTreeName():"",dragRow:r.source,targetTree:a.getTreeName(),targetRow:c,isDropAllowed:e,dropPos:d,mousePos:a.getMousePos(b)};m=a.callDragOver(m);if(e&&!1!==m){m=a.getMousePos(b);b=m.y+16;m=m.x+20;f=a.getDropMarkWindow();f.empty();var v="iui-drop-marker-move-in";switch(d){case 1:v="iui-drop-marker-move-up";break;case 2:v="iui-drop-marker-move-down"}f.append("<span class='"+v+"'></span><span class='iui-drop-marker-title'>"+c[a.options.rowFields.text]+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:b,left:m});a.dropMark(e);p.setData({source:r.source,sourceList:r.sourceList,target:c,dropPos:d})}else b.dataTransfer?b.dataTransfer.dropEffect="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect="none"),a.dropMark()}}}),b.bind("drop",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){var e=angular.element(this);b.preventDefault();Y&&(d.cancel(Y),Y=null);a.dropMark();c=!0;b.dataTransfer?c="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(c="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(c){var r=a.getRowFromChildElem(e);if(r){var e=p.getData(),m=e.source;m||(m=a.getDnDSource(b));if(c=a.isDropAllowed(m,r,e.dropPos))a.toggle(r,!0),m&&(c={sourceTree:e.sourceCtrl?e.sourceCtrl.getTreeName():"",dragRow:m,targetTree:a.getTreeName(),targetRow:r,isDropAllowed:c,dropPos:e.dropPos,mousePos:a.getMousePos(b)},!1!==a.callDragDrop(c)&&(a.drop(e),f.$$phase||f.$apply()))}}p.clearData();b.stopPropagation()}}),b.bind("dragenter",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){b.preventDefault();if(a.options.autoExpand)var e=d(function(){Y||(Y=d(function(){Y&&a.toggle(c,!0)},750));d.cancel(e)},1);var r=p.getData();r.source||(r.source=a.getDnDSource(b));r={sourceTree:r.sourceCtrl?r.sourceCtrl.getTreeName():"",dragRow:r.source,targetTree:a.getTreeName(),targetRow:r.target,mousePos:a.getMousePos(b)};a.callDragEnter(r);b.stopPropagation()}}),b.bind("dragleave",function(b){a.hoverRow=null;var c=a.getRowFromChildElem(this);c&&a.isRowEnabled(c)&&(b.preventDefault(),Y&&(d.cancel(Y),Y=null),c=p.getData(),c.source||(c.source=a.getDnDSource(b)),c={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragRow:c.source,targetTree:a.getTreeName(),targetRow:c.target,mousePos:a.getMousePos(b)},a.callDragLeave(c),b.stopPropagation())}),b.bind("dblclick",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){b.preventDefault();if(1===b.which){var d=a.getRowCurrentIndex(c),e=parseInt(a.getIndexFromElem(this),10),r=a.getCell(d,e),m=a.getCellType(r,e),f=null,g=a.options.editorSettings;r&&(f=a.getColumnById(r[a.options.cellFields.cid]));!f&&0<=e&&e<a.columnList.length&&(f=a.columnList[e]);var v="dblclick"==a.options.editorSettings.activate;f&&f[a.options.columnFields.editorSettings]&&(g=f[a.options.columnFields.editorSettings],v=void 0!=g.activate?"dblclick"==g.activate:v);switch(m){case "checkbox":break;case "combobox":r&&0!=r[a.options.cellFields.allowEdit]&&f&&v?Ya(angular.element(this),g,d,e):a.removeDropDownList();break;default:a.removeDropDownList(),r&&0!=r[a.options.cellFields.allowEdit]&&v&&Ja(b,angular.element(this),0)}0!=a.callRowDblClick(c,a.getMousePos(b))&&"checkbox"!=m&&"checkbox"!=m&&r&&!v&&(a.toggle(c),a.updateFocus(d,e))}b.stopPropagation()}}),b.bind("mouseenter",function(b){if(!ca&&(b=a.getRowFromChildElem(this))&&a.isRowEnabled(b)&&!ba){var c=a.getRowCurrentIndex(b);b=parseInt(a.getIndexFromElem(this),10);if(c=a.getCell(c,b)){a.hoverCell=c;var d=angular.element(this);if(c&&0!=c[a.options.cellFields.allowEdit])switch(b=a.getCellType(c,b),b){case "combobox":va||Xa(d);break;case "incell":H&&c==K||X(d,b);break;case "dropdown":H&&c!=K||X(d,b);break;default:ha(),k()}else ha()}}}),b.bind("mouseleave",function(b){if(!ca&&(a.hoverCell=null,(b=a.getRowFromChildElem(this))&&a.isRowEnabled(b))){b=a.getRowCurrentIndex(b);var c=parseInt(a.getIndexFromElem(this),10);a.getCell(b,c)&&(ha(),k())}}),b.bind("keydown",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){var d=!0,e=angular.element(this);a.callKeyDown(b,c);var r=a.getRowCurrentIndex(c),m=parseInt(a.getIndexFromElem(this),10),g=a.getCell(r,m),v=a.getCellType(g,m),h=a.getColumnById(g[a.options.cellFields.cid]);!h&&0<=m&&m<a.columnList.length&&(h=a.columnList[m]);switch(b.keyCode){case 9:ob(b,c,r,m);break;case 13:switch(v){case "checkbox":Za(g,m);break;case "combobox":g&&0!=g[a.options.cellFields.allowEdit]?h&&Ya(angular.element(this),h[a.options.columnFields.editorSettings],r,m):a.removeDropDownList();break;case "incell":!H&&g&&0!=g[a.options.cellFields.allowEdit]&&a.openInCellEditor(e,g,h);break;case "dropdown":!H&&g&&0!=g[a.options.cellFields.allowEdit]&&a.openDropDownEditor(e,g,h);break;default:g&&0!=g[a.options.cellFields.allowEdit]&&Ja(b,angular.element(this),0)}break;case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;case 27:d=!1;break;case 33:pb(b,r,m);break;case 34:qb(b,r,m);break;case 35:rb(b,r,m);break;case 36:sb(b,r,m);break;case 37:tb(b,c,r,m);break;case 32:b.preventDefault();Za(g,m);a.rowSelection(c,b.shiftKey,b.ctrlKey,c.selected);f.$apply();break;case 38:$a(b,r,m);break;case 39:ub(b,c,r,m);break;case 40:ab(b,r,m);break;default:(b.ctrlKey||b.metaKey)&&a.updateSelectionStatus("ctrl"),b.shiftKey&&a.updateSelectionStatus("shift")}d&&b.stopPropagation()}}),b.bind("keyup",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){switch(b.keyCode){case 16:a.multiSelection(!1);break;case 17:a.multiSelection(!1);break;default:b.ctrlKey||b.metaKey||a.multiSelection(!1),b.shiftKey||a.multiSelection(!1)}a.callKeyUp(b,c);b.stopPropagation()}}),b.bind("keypress",function(b){var c=a.getRowFromChildElem(this);c&&a.isRowEnabled(c)&&(a.callKeyPress(b,c),b.stopPropagation())}),b.bind("click",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){if(1===b.which){var d=a.getRowCurrentIndex(c),e=parseInt(a.getIndexFromElem(this),10),d=a.getCell(d,e);a.callCellClick(c,d,a.getMousePos(b));a.callRowClick(c,a.getMousePos(b))}b.stopPropagation()}}),b.bind("mousedown",function(b){a.closeFilterWindow();var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){var d=angular.element(this);a.mouseButtonStatus(!0);switch(b.which){case 1:var e=a.getRowCurrentIndex(c),r=parseInt(a.getIndexFromElem(this),10),m=a.getCell(e,r),f=a.getCellType(m,r),g=null,v=a.options.editorSettings;m&&(g=a.getColumnById(m[a.options.cellFields.cid]));!g&&0<=r&&r<a.columnList.length&&(g=a.columnList[r]);var h="click"==a.options.editorSettings.activate;g&&g[a.options.columnFields.editorSettings]&&(v=g[a.options.columnFields.editorSettings],h=void 0!=v.activate?"click"==v.activate:h);m&&m!=K?a.closeEditor(K):a.closeEditor();switch(f){case "checkbox":break;case "combobox":a.rowSelection(c,b.shiftKey,b.ctrlKey);m&&0!=m[a.options.cellFields.allowEdit]&&g&&h?Ya(angular.element(this),v,e,r):a.removeDropDownList();break;case "incell":a.rowSelection(c,b.shiftKey,b.ctrlKey);!H&&m&&0!=m[a.options.cellFields.allowEdit]&&h&&a.openInCellEditor(d,m,g);break;case "dropdown":a.rowSelection(c,b.shiftKey,b.ctrlKey);!H&&m&&0!=m[a.options.cellFields.allowEdit]&&h&&a.openDropDownEditor(d,m,g);break;default:a.rowSelection(c,b.shiftKey,b.ctrlKey),a.removeDropDownList(),m&&0!=m[a.options.cellFields.allowEdit]&&h&&Ja(b,angular.element(this))}break;case 3:a.rowSelection(c,b.shiftKey,b.ctrlKey),a.callRowRightClick(c,a.getMousePos(b))}b.stopPropagation()}}),b.bind("mouseup",function(b){a.mouseButtonStatus(!1);var c=a.getRowFromChildElem(this);c&&a.isRowEnabled(c)&&a.updateSelection(c,b.shiftKey);1===b.which&&T&&(d.cancel(T),T=null)}),b.bind("focus",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){var d=a.getRowCurrentIndex(c),e=parseInt(a.getIndexFromElem(this),10),d=a.getCell(d,e);a.callGotFocus(b,c,d);if(d&&0!=d[a.options.cellFields.allowEdit])switch(b=angular.element(this),e=a.getCellType(d,e),e){case "combobox":va||Xa(b);break;case "incell":H||X(b,e);break;case "dropdown":H||X(b,e);break;default:ha()}else ha()}}),b.bind("blur",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){var d=a.getRowCurrentIndex(c),e=parseInt(a.getIndexFromElem(this),10),d=a.getCell(d,e);a.callLostFocus(b,c,d)}}))},mb=function(a){a&&a.unbind("blur click dragstart dragover drop dragenter dragleave dblclick focus keydown keypress keyup mouseenter mouseleave mousemove mousedown mouseup")};a.getFooterElem=function(){return W};a.getHeaderElem=function(){return I};a.getRowElems=function(){return D?D.find("tr"):null};var ob=function(b,c,d,e){var f=a.currentList.length;0<f&&(b.shiftKey?h.isEqual(c[a.options.rowFields.id],a.currentList[0][a.options.rowFields.id])||$a(b,d,e):h.isEqual(c[a.options.rowFields.id],a.currentList[f-1][a.options.rowFields.id])||ab(b,d,e))},ab=function(b,c,e){b.preventDefault();focusDelayTime=0;var f=c,g=B+ja-2,g=g<a.currentList.length-1?g:a.currentList.length-1;f>=g&&E&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(n[0].clientHeight/4)}),focusDelayTime=1);if(f=a.getNextRow(f)){c=a.getRowCurrentIndex(f);c>g&&E&&(a.ensureVisible(f,"bottom"),focusDelayTime=100);a.rowSelection(f,b.shiftKey,b.ctrlKey);var h=d(function(){a.updateFocus(c,e);d.cancel(h)},focusDelayTime)}},$a=function(b,c,e){b.preventDefault();focusDelayTime=0;var f=B,f=0<f?f:0;c==f&&E&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-Math.floor(n[0].clientHeight/4)}),focusDelayTime=1);var g=a.getPrevRow(c);if(g){c=a.getRowCurrentIndex(g);c<f&&E&&(a.ensureVisible(g,"bottom"),focusDelayTime=100);a.rowSelection(g,b.shiftKey,b.ctrlKey);var h=d(function(){a.updateFocus(c,e);d.cancel(h)},focusDelayTime)}},ub=function(b,c,e,f){b.preventDefault();if((void 0===f||0<=f&&f==a.options.expandColIndex)&&!a.isRowExpanded(c)&&c[a.options.rowFields.rows]&&0<c[a.options.rowFields.rows].length)a.toggle(c,!0),a.updateFocus(e,f);else if(0<=f){focusDelayTime=0;var g=f+1;b=a.columnList.length-1;g===b&&(focusDelayTime=1);if(0<=g&&g<=b)var h=d(function(){a.updateFocus(e,g);d.cancel(h)},focusDelayTime)}},tb=function(b,c,e,f){b.preventDefault();if((void 0===f||0<=f&&f==a.options.expandColIndex)&&a.isRowExpanded(c)&&c[a.options.rowFields.rows]&&0<c[a.options.rowFields.rows].length)a.toggle(c,!1),a.updateFocus(e,f);else if(0<=f){focusDelayTime=0;var g=1<f?f-1:0;if(0<=g)var h=d(function(){a.updateFocus(e,g);d.cancel(h)},focusDelayTime)}},pb=function(b,c,e){b.preventDefault();var g=c-ja,g=0<g?g:0;if(g!==c){focusDelayTime=1;var w=a.getPrevRow(g+1);if(w){a.scrollTo(w);a.rowSelection(w,b.shiftKey,b.ctrlKey);f.$apply();var h=d(function(){a.updateFocus(a.getRowCurrentIndex(w),e);d.cancel(h)},focusDelayTime)}}},qb=function(b,c,e){b.preventDefault();var g=c+ja;a.options.showHeader&&g--;a.options.showFooter&&g--;g=g<a.currentList.length-1?g:a.currentList.length-1;if(g!==c){focusDelayTime=1;var w=a.getNextRow(g-1);if(w){a.scrollTo(w,"bottom");a.rowSelection(w,b.shiftKey,b.ctrlKey);f.$apply();var h=d(function(){a.updateFocus(a.getRowCurrentIndex(w),e);d.cancel(h)},focusDelayTime)}}},rb=function(b,c,e){b.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:R.y});var f=a.getLastRow();if(f){a.rowSelection(f,b.shiftKey,b.ctrlKey);var g=d(function(){a.updateFocus(a.getRowCurrentIndex(f),e);d.cancel(g)},1)}},sb=function(b,c,e){b.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:0});var f=a.getFirstRow();if(f){a.rowSelection(f,b.shiftKey,b.ctrlKey);var g=d(function(){a.updateFocus(a.getRowCurrentIndex(f),e);d.cancel(g)},1)}},Za=function(b,c){if(b&&0!=b[a.options.cellFields.allowEdit]){var d=a.getColumnById(b[a.options.cellFields.cid]);!d&&0<=c&&c<a.columnList.length&&(d=a.columnList[c]);if(d){var e=b[a.options.cellFields.value];if((d=d[a.options.columnFields.editorSettings])&&1==d.threeState)switch(h.isString(e)||(e="unchecked"),e){case "checked":e="unchecked";break;case "indeterminate":e="checked";break;default:e="indeterminate"}else e=h.isBoolean(e)?!e:!0;b[a.options.cellFields.value]=e;f.$apply()}}},D=null,I=null,W=null,B=0,C=null,u=null,A=100,S=0,ja=0,ka=0,Fa=0,Z=0,ia=0,ra=0,Na=!1,ca=!1,Ga=9,Ha=9,Oa=0,la=0,sa=0,Ia=1,Pa=0,Qa=0,ma=0,za=0,Ra=1,G=null,J=null,O=!1,E=!1;this.scrollMousePos=null;var R={x:0,y:0},wa=[];f.verScrollVisibility=!1;f.$watch("verScrollVisibility",function(b,c){b!=c&&a.updateCurrentLayout()});a.getColumnWidth=function(b){var c=100;b&&b[a.options.columnFields.width]&&(c=b[a.options.columnFields.width],h.isPercent(c)?(b=n[0].clientWidth-2*a.columnList.length,E&&F&&(b-=F[0].offsetWidth),c=Math.floor(parseInt(c,10)/100*b)):h.isString&&(c=parseInt(c,10)));return c};a.updateViewSize=function(){var b=d(function(){ra=0;var c=n[0].clientWidth;E&&F&&(c-=F[0].offsetWidth);O=!1;if(0<a.columnList.length){var e=a.getHeaderElem();if(e&&(e=e.find("td"))&&0<e.length)for(var g=0;g<e.length;g++){var w=angular.element(e[g]);ra+=w[0].offsetWidth}ra>c&&(z.unbind("mousedown"),n.append(z),z.bind("mousedown",function(b){a.removeDropDownList();a.closeFilterWindow();a.closeEditor();b=h.getClientMousePos(b,this);var c=Math.floor(n[0].clientWidth);G&&(b.x<G[0].offsetLeft?a.setScrollPos({x:a.scrollPos.x-c,y:a.scrollPos.y}):b.x>G[0].offsetLeft+G[0].offsetWidth&&a.setScrollPos({x:a.scrollPos.x+c,y:a.scrollPos.y}))}),G=angular.element(z.children().eq(0)),O=!0,G.bind("mousedown",function(b){a.removeDropDownList();a.closeFilterWindow();a.closeEditor();1===b.which&&(y.scrollMousePos=a.getMousePos(b),Na=!0);b.stopPropagation()}))}E=!1;f.verScrollVisibility=!1;0<a.currentList.length&&A<a.currentList.length+1&&(F.unbind("mousedown"),n.append(F),F.bind("mousedown",function(b){a.removeDropDownList();a.closeFilterWindow();a.closeEditor();b=h.getClientMousePos(b,this);var c=Math.floor(n[0].clientHeight);J&&(b.y<J[0].offsetTop?(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-c}),Ma(!1,c)):b.y>J[0].offsetTop+J[0].offsetHeight&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+c}),Ma(!0,c)))}),J=angular.element(F.children().eq(0)),E=!0,f.verScrollVisibility=!0,J.bind("mousedown",function(b){a.removeDropDownList();a.closeFilterWindow();a.closeEditor();1===b.which&&(y.scrollMousePos=a.getMousePos(b),ca=!0);b.stopPropagation()}));O||(z.unbind("mousedown"),z.remove());E||(F.unbind("mousedown"),F.remove());O&&E?n.append(pa):pa.remove();d.cancel(b);!O&&0<a.scrollPos.x&&a.setScrollPos({x:0,y:a.scrollPos.y});!E&&0<a.scrollPos.y&&a.setScrollPos({x:a.scrollPos.x,y:0})},1)};a.updateScrollView=function(){bb()};var bb=function(){var b=d(function(){ka=n[0].offsetWidth-2;Fa=n[0].offsetHeight-2;O&&(Fa-=z[0].offsetHeight);E&&(ka-=F[0].offsetWidth);M.css("width",ka+"px");M.css("height",Fa+"px");O&&(z.css("left","0px"),z.css("bottom","0px"),z.css("width",ka-2+"px"));E&&(F.css("top","0px"),F.css("right","0px"),F.css("height",Fa-2+"px"));O&&E&&(pa.css("left","auto"),pa.css("right","0px"));var c=d(function(){O&&ka<ra&&(la=2,sa=z[0].clientWidth-4,Oa=0,sa>la&&(Oa=sa-la),Ga=Math.floor(Oa*ka/ra),9>Ga&&(Ga=9),G.css("width",Ga+"px"),R.x=ra-ka,Ia=R.x/(Oa-Ga-2));var b=a.currentList.length+1;E&&0<a.currentList.length&&A<b&&(ma=2,za=F[0].clientHeight-4,Pa=0,za>ma&&(Pa=za-ma),Ha=Math.floor(Pa*A/b),9>Ha&&(Ha=9),J.css("height",Ha+"px"),Ra=(b-A+1)/(Pa-Ha-2),R.y=Math.floor((b-A+1)*S),0>R.y&&(R.y=0),0==B?J.css("top",ma+"px"):B+A-1==a.currentList.length&&J.css("top",za-J[0].offsetHeight+"px"));d.cancel(c)},1);d.cancel(b)},5)};a.updateColumnWidth=function(){if(a.options.fillSpace){for(var b=0,c=0;c<a.columnList.length;c++)b+=a.getColumnWidth(a.columnList[c])+4;if(b<n[0].clientWidth){for(var b=(n[0].clientWidth-b)/a.columnList.length,d=0,c=0;c<a.columnList.length;c++)d=a.getColumnWidth(a.columnList[c])+b,a.columnList[c][a.options.columnFields.width]=d;return!0}}return!1};f.onCellValueChanging=function(b,c,d){var e=c+B,f=a.getCell(e,d);if(f&&0==f[a.options.cellFields.allowEdit])return!1;var f=!0,g=a.getColumnObject(d),h="label",k=null;g&&(h=g[a.options.columnFields.editorType],k=g[a.options.columnFields.editorSettings]);g=null;switch(h){case "checkbox":g=k&&1==k.threeState?b.checkState:b.checked;f=a.callCellValueChanging(a.getRowObject(e),a.getCellObject(e,d),g);break;case "combobox":f=a.callCellValueChanging(a.getRowObject(c),a.getCellObject(c,d),b.item)}return f};f.onCellValueChanged=function(b,c,d){var e=c+B,g=a.getColumnObject(d),h="label",k=null;g&&(h=g[a.options.columnFields.editorType],k=g[a.options.columnFields.editorSettings]);g=null;switch(h){case "checkbox":g=k&&1==k.threeState?b.checkState:b.checked;a.callCellValueChanged(a.getRowObject(e),a.getCellObject(e,d),g);break;case "combobox":if(e=a.getCell(c,d))e[a.options.cellFields.value]=b.item,f.$apply();a.removeDropDownList(!0);a.updateFocus(c,d);a.callCellValueChanged(a.getRowObject(c),a.getCellObject(c,d),b.item)}};f.onEditorClick=function(b,c,d){c+=B;var e=a.getColumnObject(d),f="label";e&&(f=e[a.options.columnFields.editorType]);switch(f){case "checkbox":a.callCellClick(a.getRowObject(c),a.getCellObject(c,d),a.getMousePos(b))}};a.setDefaultCellValue=function(b,c,d){if(void 0==b[a.options.cellFields.value]){var e=void 0;switch(c){case "checkbox":e=d&&1==d.threeState?"unchecked":!1;break;case "image":e=""}void 0!=e&&(b[a.options.cellFields.value]=e)}};var Nb=function(){for(var b=0;b<a.columnList.length;b++){var c={columnID:void 0!=a.columnList[b][a.options.columnFields.id]?a.columnList[b][a.options.columnFields.id]:b,avgItemHeight:0};switch(a.columnList[b][a.options.columnFields.editorType]){case "combobox":Gb(a.columnList[b].editorSettings,b,c);wa.push(c);break;default:wa.push(c)}}},vb=function(b){for(var c='<table cellpadding="0" cellspacing="0" style="position:absolute;',c=(b?c+'bottom:0;">':c+'top:0;">')+"<tr>",d=0;d<a.columnList.length;d++)b?(c+='<td iui-class="{{data['+d+'].style.footer.general}}" data-index="'+d+'" data-element="column-footer">',c+='<div iui-class="{{data['+d+'].style.footer.cell}}" data-element="column-footer-cell"'):(c+='<td iui-class="{{data['+d+'].style.header.general}}" data-index="'+d+'" data-element="column-header">',c+='<div iui-class="{{data['+d+'].style.header.cell}}" data-element="column-header-cell"'),c+=' iui-contextmenu menu-items="data['+d+"].column."+a.options.columnFields.contextMenu+'"',b?(c+=' iui-style="overflow:hidden;width:{{data['+d+"].width}}px;text-align:{{data["+d+'].footerAlignment}}">',a.columnList[d][a.options.columnFields.footerTemplate]?c+='<div ng-include="'+a.columnList[d][a.options.columnFields.footerTemplate]+'" style="margin:0;padding:0"></div>':(c+='<span iui-class="{{data['+d+'].style.footer.content}}" data-element="cell-content">',c+="{{data["+d+"].column."+a.options.columnFields.footerText+"}}</span>")):(c+=' iui-style="overflow:hidden;width:{{data['+d+"].width}}px;text-align:{{data["+d+'].headerAlignment}}">',a.columnList[d][a.options.columnFields.headerTemplate]?c+='<div ng-include="'+a.columnList[d][a.options.columnFields.headerTemplate]+'" style="margin:0;padding:0"></div>':(c+='<span iui-class="{{data['+d+'].style.header.content}}" data-element="cell-content">',c+="{{data["+d+"].column."+a.options.columnFields.headerText+"}}</span>"),c+='<span iui-class="{{data['+d+'].style.filtering}}" data-index="'+d+'" data-element="filter-button" ng-show="data['+d+'].showFiltering"></span>',c+='<span iui-class="{{data['+d+'].style.sorting}}" data-index="'+d+'" data-element="sort-button" ng-show="data['+d+'].showSorting"></span>'),c+="</div>",c+="</td>";return c+="</tr></table>"},wb=function(b,c){var d='<tr iui-class="{{data['+b+'].style}}" data-index="{{data['+b+'].index}}" tabindex="{{data['+b+'].tabindex}}"';c&&(d+=' style="position:absolute;top:-9999px"');for(var d=d+">",e=0;e<a.columnList.length;e++){var d=d+('<td iui-class="{{data['+b+"].cells["+e+'].style.cell}}" data-element="cell" data-index="'+e+'" draggable="{{data['+b+'].draggable}}" tabindex="{{data['+b+"].cells["+e+'].tabindex}}">'),d=d+('<div ng-show="data['+b+'].visible"'),d=d+(' iui-class="{{data['+b+"].cells["+e+'].style.content}}" data-element="cell-content"'),d=d+(' iui-contextmenu menu-items="data['+b+"].row."+a.options.rowFields.contextMenu+'" menu-update="{{data['+b+'].updateContextMenu}}"'),d=d+(' iui-style="width:{{data['+b+"].cells["+e+"].width}}px;text-align:{{data["+b+"].cells["+e+"].alignment}};"),d=e===a.options.expandColIndex?d+("padding-left:{{data["+b+"].cells["+e+'].indent}}px;">'):d+'">',f=b,g=e,k="";g===a.options.expandColIndex&&(k+='<span iui-class="{{data['+f+'].expandBox}}" data-element="expandbox"></span>',k+='<span iui-class="{{data['+f+'].icon}}" data-element="icon" ng-show="data['+f+'].iconVisible"></span>');var l=a.columnList[g][a.options.columnFields.editorSettings];switch(a.columnList[g][a.options.columnFields.editorType]){case "checkbox":k+='<iui-checkbox name="cb-'+h.getUniqueId(4)+'"';l&&1==l.threeState?(k+=' check-state="data['+f+"].cells["+g+"].related."+a.options.cellFields.value+'"',k+=' checkstate-changing="onCellValueChanging(e, '+f+", "+g+')"',k+=' checkstate-changed="onCellValueChanged(e, '+f+", "+g+')"',k+=' three-state="true"'):(k+=' checked="data['+f+"].cells["+g+"].related."+a.options.cellFields.value+'"',k+=' checked-changing="onCellValueChanging(e, '+f+", "+g+')"',k+=' checked-changed="onCellValueChanged(e, '+f+", "+g+')"');k+=' click="onEditorClick(e, '+f+", "+g+')"';l&&l.style&&(k+=' control-style="data['+f+"].cells["+g+'].editorStyle"');k+=' enabled="data['+f+"].cells["+g+"].related."+a.options.cellFields.enabled+'"';k+=' style="vertical-align:middle;" iui-show="{{data['+f+"].cells["+g+'].visible}}"></iui-checkbox>';break;case "combobox":k+='<span iui-class="{{data['+f+"].cells["+g+'].style.label}}" data-element="content">';k+="{{data["+f+"].cells["+g+"].related."+a.options.cellFields.value+".text}}";k+="</span>";break;case "image":k+='<img data-element="image" style="vertical-align:middle" src="{{data['+f+"].cells["+g+"].related."+a.options.cellFields.value+'}}"  iui-show="{{data['+f+"].cells["+g+'].visible}}" show-default="true" />';break;default:k+='<span iui-class="{{data['+f+"].cells["+g+'].style.label}}" data-element="content">',k+="{{data["+f+"].cells["+g+"].related."+a.options.cellFields.text+"}}",k+="</span>"}d+=k;d+="</div>";d+="</td>"}return d+"</tr>"},Ob=function(){S=0;if(0<a.currentList.length&&u){var b=wb(0,!0),e=c(b)(u);n.append(e);var f=d(function(){S=e[0].offsetHeight;e.remove();d.cancel(f)},1)}},Pb=function(){var b=0;wa.length=0;var e=d(function(){jb();Na||ca||bb();M.empty();W=D=I=null;C&&C.$destroy();u&&u.$destroy();0<a.columnList.length&&(C=f.$new(),C.data=xb(),a.refreshColumns(),C.$apply());d.cancel(e)},1),g=d(function(){var e="";ia=Z=0;if(0<a.columnList.length){Nb();if(a.options.showHeader){e=vb();I=c(e)(C);M.append(I);Z=I[0].offsetHeight;Jb(I);var e=0,m=I.find("td");if(m&&0<m.length)for(var h=0;h<m.length;h++)var k=angular.element(m[h]),e=e+k[0].offsetWidth;e>n[0].clientWidth&&(e=angular.element('<div class="iui-scrollbar-horizontal"><div class="iui-scroll-button-thumb-horizontal"></div></div>'),e.css("bottom","-9999px"),n.append(e),b=e[0].offsetHeight,e.remove())}a.options.showFooter&&(e=vb(!0),W=c(e)(C),M.append(W),ia=W[0].offsetHeight);var l=d(function(){if(0<a.columnList.length){if(a.options.showHeader){Z=I[0].offsetHeight;var e=0,g=I.find("td");if(g&&0<g.length)for(var m=0;m<g.length;m++)var h=angular.element(g[m]),e=e+h[0].offsetWidth;e>n[0].clientWidth&&(e=angular.element('<div class="iui-scrollbar-horizontal"><div class="iui-scroll-button-thumb-horizontal"></div></div>'),e.css("bottom","-9999px"),n.append(e),b=e[0].offsetHeight,e.remove())}a.options.showFooter&&(ia=W[0].offsetHeight);if(0<a.columnList.length&&0<a.currentList.length){u=f.$new();u.data=yb();a.refreshRows();u.$apply();Ob();var q=d(function(){D&&(nb(),D.remove());A=Math.floor((n[0].clientHeight-(Z+ia)-b)/S)+1;ja=0;for(var e="",f=0;f<A;f++)e+=wb(f),ja++;if(0<ja){D=angular.element('<table cellpadding="0" cellspacing="0" style="position:absolute;top:'+Z+'px;"></table>');D.append(c(e)(u));I?I.after(D):M.append(D);var g=d(function(){a.allowEvents=!0;if(0<a.currentList.length){nb();var b=M.find("tr");if(0<b.length){var c=null,c=0,e=b.length-1;a.options.showHeader&&c++;a.options.showFooter&&e--;for(var f=c;f<=e;f++){c=angular.element(b[f]);Kb(c);for(var r=c.find("td"),m=0;m<r.length;m++){var h=angular.element(r[m]);Lb(a.getElement(h,"expandbox"));Mb(h,a.getRowFromElem(c),m)}}}}d.cancel(g)},1)}d.cancel(q)},1)}zb()}d.cancel(l)},1)}d.cancel(g)},1)};a.updateStatus=0;a.updateLayout=function(b){if(a.allowUpdate&&(a.updateStatus++,1==a.updateStatus)){a.allowEvents=!1;n.removeClass("iui-treegrid-block-rtl");a.options.rtl&&n.addClass("iui-treegrid-block-rtl");M.removeClass("iui-treegrid-block-shift-left iui-treegrid-block-rtl");M.addClass(ua());S=0;A=100;ia=Z=0;a.updateColumnList();a.updateCurrentList();Pb();var c=d(function(){a.updateViewSize();a.updateViewSize();a.updateScrollView();a.updateStatus--;0<a.updateStatus&&(a.updateStatus=0,a.updateLayout());a.callLoadComplete();d.cancel(c)},100)}};a.updateCurrentLayout=function(){if(a.allowUpdate)if(0==a.currentList.length)a.updateLayout();else{a.updateCurrentList();a.updateView();var b=d(function(){a.updateViewSize();a.updateViewSize();a.updateScrollView();d.cancel(b)},1)}};var Ab=function(b,c){var d="left";return d=c?b[a.options.columnFields.footerAlignment]:b[a.options.columnFields.headerAlignment]},Qb=function(b,c){var d=Ab(b),e=Ab(b,!0),f=a.isFilteringAllowed(b),g=a.isSortingAllowed()&&b==a.sortColumn,h=a.getColumnWidth(b),h=0<=h?h:0,k=cb(b);h<k.min&&(h=k.min);h>k.max&&(h=k.max);return{headerAlignment:d,footerAlignment:e,index:c,column:b,showFiltering:f,showSorting:g,style:{header:{},footer:{}},width:h}},Rb=function(b,c,d){for(var e=[],f=0;f<a.columnList.length;f++){var g,k=f;if(d){var l=a.columnList[f][a.options.columnFields.id];l&&(k=a.getCellIndexById(a.currentList[c][a.options.rowFields.cells],f,l))}g=k;if(d)a:{if(0<=g&&(k=a.currentList[c][a.options.rowFields.cells],g<k.length)){k=k[g];break a}k={}}else k={};var l=a.columnList[f][a.options.columnFields.contentAlignment]?a.columnList[f][a.options.columnFields.contentAlignment]:"left",n;n=(n=a.columnList[f][a.options.columnFields.editorSettings])&&n.style?n.style:null;var p;if(d){if(p=0,f==a.options.expandColIndex){p=c;var t=0,u=a.columnList[a.options.expandColIndex],y=a.getColumnWidth(u),x=y-a.indentList[p],x=0<=x?x:0,t={top:0,right:0,bottom:0,left:0};(u=a.getElemFromColumn(u))&&(u=a.getChildElement(u,"column-header-cell"))&&(t=h.getPadding(u[0]));t=t.left+a.indentList[p];0==x&&(t=y);p=t}}else p=0;y=g;d?(x=c,t=f,x=1==a.options.allowFocus&&1==a.options.allowCellFocus&&a.isRowEnabled(a.currentList[x])&&0<=t?a.getTabIndex().toString()+(x+1).toString()+t.toString():""):x="";if(d)a:{if(0<=g&&(t=a.currentList[c][a.options.rowFields.cells],g<t.length)){t=t[g][a.options.cellFields.text];break a}t=""}else t="";if(d)a:{if(0<=g&&(u=a.currentList[c][a.options.rowFields.cells],g<u.length)){u=u[g][a.options.cellFields.value];break a}u=null}else u=null;g=d?0<=g?!0:!1:!1;var B;if(d){B=c;var C=f,A=a.columnList[C],z=a.getColumnWidth(A),A=cb(A);z<A.min&&(z=A.min);z>A.max&&(z=A.max);C==a.options.expandColIndex&&(z-=a.indentList[B]);B=z=0<=z?z:0}else B=0;e.push({related:k,alignment:l,editorStyle:n,indent:p,index:y,style:{},tabindex:x,text:t,value:u,visible:g,width:B})}if(d){f="";k=a.defaultStyle.row.expandBox.general;a.options.controlStyle.row.expandBox.general!=k&&(k+=" "+a.options.controlStyle.row.expandBox.general);l=a.getCurrentRowStyle(b);l=a.getExpandBoxStyle(l.expandBox);if(a.isThereChildRows||b&&b[a.options.rowFields.hasChildren])f=k;b&&(b[a.options.rowFields.hasChildren]||b[a.options.rowFields.rows]&&0<b[a.options.rowFields.rows].length&&a.isThereVisibleChildren(b))&&(a.options.loadRow&&h.isEqual(b[a.options.rowFields.id],a.options.loadRow[a.options.rowFields.id])?f+=" "+l.animated:(f=b[a.options.rowFields.hasChildren]&&void 0===b[a.options.rowFields.expanded]?f+(" "+l.expanded):!1!==b[a.options.rowFields.expanded]?f+(" "+l.collapsed):f+(" "+l.expanded),!0===a.options.rtl&&(f+="-rtl"),a.isRowEnabled(b)||(f+="-disabled")))}else f="";k=d?a.isRowEnabled(b)&&a.isDragAllowed(b):!1;d?(l="",b.icon?l=b.icon:a.options.rowIcon&&(l=a.options.rowIcon)):l="";n=d?0!=a.options.showIcons&&(b.icon||a.options.rowIcon):!1;g=d?1==a.options.allowFocus&&0==a.options.allowCellFocus&&a.isRowEnabled(a.currentList[c])?a.getTabIndex().toString()+(c+1).toString():"":"";return{cells:e,expandBox:f,draggable:k,icon:l,iconVisible:n,index:c,row:d?b:{},style:{},tabindex:g,updateContextMenu:d?null!=b[a.options.rowFields.contextMenu]:!1,visible:d}},xb=function(){for(var b=[],c=0;c<a.columnList.length;c++)b.push(Qb(a.columnList[c],c));return b},yb=function(){for(var b=[],c=B;c<B+A;c++)b.push(Rb(a.currentList[c],c,c<a.currentList.length));return b},zb=function(){for(var b=0;b<a.columnList.length;b++)if(a.isFilteringAllowed(a.columnList[b])){var c=a.getElemFromColumn(a.columnList[b]);c&&(c=a.getChildElement(c,"column-header-cell"))&&(c=a.getContentElement(c,"filter-button"))&&(c.css("top",(Z-parseInt(getComputedStyle(c[0]).height,10))/2-1+"px"),c.css("right","2px"))}a.isSortingAllowed()&&a.sortColumn&&(b=a.getElemFromColumn(a.sortColumn))&&(c=a.getChildElement(b,"column-header-cell"))&&(c=a.getContentElement(c,"sort-button"))&&(c.css("top",(Z-parseInt(getComputedStyle(c[0]).height,10))/2-1+"px"),a.isFilteringAllowed(a.sortColumn)?c.css("right","22px"):c.css("right","2px"))};a.getRowScope=function(){return u};a.updateView=function(){var b=d(function(){u&&(a.allowEvents=!1,Bb(!1),0<a.columnList.length&&(C.data=xb(),u.data=yb(),a.options.selectedRow&&!a.isRowEnabled(a.options.selectedRow)&&(a.options.selectedRow[a.options.rowFields.selected]=!1,a.options.selectedRow=null,a.updateSelectionList()),a.refresh(null,null,!1),C.$apply(),u.$apply(),zb(),a.allowEvents=!0));d.cancel(b)},1)};var Cb=function(b,c,d){var e={cell:"",content:"",general:"",label:""},f="";switch(c){case "column":d?(f=a.defaultStyle.column.footer.normal,a.options.controlStyle.column.footer.normal!=f&&(f+=" "+a.options.controlStyle.column.footer.normal),e.general=f,e.cell="iui-treegrid-column-footer-cell",f=a.defaultStyle.column.footer.content,a.options.controlStyle.column.footer.content!=f&&(f+=" "+a.options.controlStyle.column.footer.content)):(f=a.defaultStyle.column.header.normal,a.options.controlStyle.column.header.normal!=f&&(f+=" "+a.options.controlStyle.column.header.normal),e.general=f,e.cell="iui-treegrid-column-header-cell",f=a.defaultStyle.column.header.content,a.options.controlStyle.column.header.content!=f&&(f+=" "+a.options.controlStyle.column.header.content));e.content=f;break;case "row":f=a.defaultStyle.row.general.normal;a.options.controlStyle.row.general.normal!=f&&(f+=" "+a.options.controlStyle.row.general.normal);e.general=f;break;case "cell":f=a.defaultStyle.row.cell.normal;a.options.controlStyle.row.cell.normal!=f&&(f+=" "+a.options.controlStyle.row.cell.normal);switch(a.options.gridLines){case "none":f=b==B+A-1||b==a.currentList.length-1?f+" iui-treegrid-lines-horizontal":f+" iui-treegrid-lines-none";break;case "horizontal":f+=" iui-treegrid-lines-horizontal";break;case "vertical":f=b==B+A-1||b==a.currentList.length-1?f+" iui-treegrid-lines-both":f+" iui-treegrid-lines-vertical";break;default:f+=" iui-treegrid-lines-both"}e.general=f;f=a.defaultStyle.row.cell.content;a.options.controlStyle.row.cell.content!=f&&(f+=" "+a.options.controlStyle.row.cell.content);e.content=f;e.label=a.getDefaultCellLabelClass()}return e},Sa=function(b,c,d,e){var f=a.getObjState(b);d=Cb(d,b.type,e);switch(b.type){case "column":e?(c=a.getCurrentColumnStyle(b,"footer",f),c!=a.options.controlStyle.column.footer.normal&&(d.general+=" "+c),b=a.getCurrentColumnStyle(b,"footer","content"),b!=a.options.controlStyle.column.footer.content&&(d.content+=" "+b)):(c=a.getCurrentColumnStyle(b,"header",f),c!=a.options.controlStyle.column.header.normal&&(d.general+=" "+c),b=a.getCurrentColumnStyle(b,"header","content"),b!=a.options.controlStyle.column.header.content&&(d.content+=" "+b));break;case "row":b=a.getCurrentRowStyle(b,f);b!=a.options.controlStyle.row.general.normal&&(d.general+=" "+b);break;case "cell":e=a.getCurrentCellStyle(c,b,f),e!=a.options.controlStyle.row.cell.normal&&(d.general+=" "+e),b=a.getCurrentCellStyle(c,b,"content"),b!=a.options.controlStyle.row.cell.content&&(d.content+=" "+b)}return d},db=function(a,b,c){u.data[a].cells[b].style.cell=c.general;u.data[a].cells[b].style.content=c.content;u.data[a].cells[b].style.label=c.label},Db=function(b){if(u&&(b-=B,0<=b&&b<u.data.length&&u.data[b].visible)){u.data[b].style=a.defaultStyle.row.general.normal;for(var c=0;c<a.columnList.length;c++)u.data[b].cells[c].style.cell=a.defaultStyle.row.cell.normal+" iui-treegrid-cell-empty"}};a.refreshColumns=function(){for(var b=0;b<a.columnList.length;b++)a.refresh(a.columnList[b],null,!1)};a.refreshRows=function(){for(var b=B;b<B+A;b++)b<a.currentList.length?a.refresh(a.currentList[b],null,!1):Db(b)};a.refresh=function(b,c,d){if(b)switch(b.type){case "column":if(C&&(c=a.getColumnCurrentIndex(b),0<=c&&c<C.data.length)){1==a.options.showHeader&&(C.data[c].style.header=Sa(b));1==a.options.showFooter&&(C.data[c].style.footer=Sa(b,null,-1,!0));var e=C.data[c].style,f="";if(a.isFilteringAllowed(b)){var g=a.getObjState(b),f="iui-filtering";"selected"==g?f+=" iui-filtering-selected":"hovered"==g&&(f+=" iui-filtering-hovered")}e.filtering=f;c=C.data[c].style;e="";a.isSortingAllowed()&&b==a.sortColumn&&(b=a.getObjState(b),"ascending"==a.options.sorting?(e="iui-sort-ascending","selected"==b?e+=" iui-sort-ascending-selected":"hovered"==b&&(e+=" iui-sort-ascending-hovered")):(e="iui-sort-descending","selected"==b?e+=" iui-sort-descending-selected":"hovered"==b&&(e+=" iui-sort-descending-hovered")));c.sorting=e;void 0==d&&C&&C.$apply()}break;case "row":if(u&&(c=a.getRowCurrentIndex(b),e=c-B,0<=e&&e<u.data.length&&u.data[e].visible)){u.data[e].style=Sa(b).general;f=Cb(c,"cell");for(g=0;g<a.columnList.length&&g<u.data[e].cells.length;g++){var h=u.data[e].cells[g].index;if(0<=h){var k=b[a.options.rowFields.cells];h<k.length?(h=Sa(k[h],b,c),db(e,g,h)):db(e,g,f)}else db(e,g,f)}void 0==d&&u&&u.$apply()}}else{for(g=0;g<a.columnList.length;g++)a.refresh(a.columnList[g],null,!1);for(b=B;b<B+A;b++)b<a.currentList.length?a.refresh(a.currentList[b],null,!1):Db(b);1==d&&u&&u.$apply()}};var ga="none",V=!1,Ta=-1,ga="none",eb=0,fb=0;f.$watch(function(){return n[0].offsetWidth},function(b,c){100==A?a.updateLayout():b!=c&&a.updateCurrentLayout()});f.$watch(function(){return n[0].offsetHeight},function(b,c){b!=c&&a.updateLayout()});a.isColumnWithFixedWidth=function(b){var c=a.columnList;return c&&0<=b&&b<c.length?c[b][a.options.columnFields.fixedWidth]?c[b][a.options.columnFields.fixedWidth]:!1:!1};a.setColumnResizingParams=function(b,c,d){0<=b&&b<a.columnList.length&&(Ta=b,ga=c,fb=d,eb=a.getColumnWidth(a.columnList[b]))};a.resizeColumn=function(b,c){0>c&&(c=0);var d=null;I&&(d=angular.element(I.find("tr")),a.resizeColumnCells(d,b,c));if(D){var d={top:0,right:0,bottom:0,left:0},e=a.getElemFromColumn(a.columnList[b]);e&&(e=a.getChildElement(e,"column-header-cell"))&&(d=h.getPadding(e[0]));for(var e=D.find("tr"),f=0;f<e.length;f++)angular.element(e[f]),a.resizeColumnCells(angular.element(e[f]),b,c,!0,d)}W&&(d=angular.element(W.find("tr")),a.resizeColumnCells(d,b,c));0<=b&&b<a.columnList.length&&a.callColumnSizeChanged(a.columnList[b])};a.resizeColumnCells=function(b,c,d,e,f){if(b){var g=-1;e&&(g=a.getRowCurrentIndex(a.getRowFromElem(b)));e=e=0;0<=g&&(e=a.indentList[g]);b=b.find("td");0<=c&&c<b.length&&(b=angular.element(b[c]),0<b.children().length&&(b=b.children().eq(0)))&&(e=a.options.rtl?f?f.right+e:e:f?f.left+e:e,f=d,0<=g&&c==a.options.expandColIndex&&(f-=e),f=0<=f?f:0,b.css("width",f+"px"),c==a.options.expandColIndex&&(a.options.rtl?0==f?b.css("padding-right",d+"px"):b.css("padding-right",e+"px"):0==f?b.css("padding-left",d+"px"):b.css("padding-left",e+"px")))}};angular.element(g).bind("dragover",function(a){ya()});var Q=angular.element('<div class="iui-treegrid-column-reorder-mark"><span></span></div>'),da=angular.element('<div class="iui-treegrid-column-reorder-tooltip"><span></span></div>'),kb=function(b){var c="initial";ba&&L&&(!a.hoverColumn||L==a.hoverColumn||a.hoverColumn&&0==a.hoverColumn.allowDrop)&&(c="not-allowed",b&&da&&da.css("display","none"));n.css("cursor",c);document.body.style.cursor=c},cb=function(b){return b?{min:h.isFieldAvailable(b[a.options.columnFields.minWidth],0),max:h.isFieldAvailable(b[a.options.columnFields.maxWidth],9999999)}:{min:0,max:9999999}};angular.element(g).bind("mousemove",function(b){if(0===b.button&&0<=Ta&&"none"!=ga){var c=a.getMousePos(b),d=Ta,c=eb+c.x-fb,c=0<=c?c:0,e=a.columnList;if(0<=d&&d<e.length){var f=cb(e[d]);c>=f.min&&c<=f.max&&(e[d][a.options.columnFields.width]=c,a.resizeColumn(d,c),a.updateViewSize(),bb())}}Na?1===b.which&&(G[0].getBoundingClientRect(),b=a.getMousePos(b),y.scrollMousePos||(y.scrollMousePos=b),d=G[0].offsetLeft+(b.x-y.scrollMousePos.x),d<la?d=la:d+G[0].offsetWidth>sa&&(d=sa-G[0].offsetWidth),G.css("left",d+"px"),y.scrollMousePos=b,a.scrollPos.x=!1!==a.options.rtl?parseInt((sa-G[0].offsetLeft-G[0].offsetWidth)*Ia,10):parseInt((G[0].offsetLeft-la)*Ia,10),Eb(),a.callScrollPosChanged()):ca&&1===b.which&&(J[0].getBoundingClientRect(),b=a.getMousePos(b),y.scrollMousePos||(y.scrollMousePos=b),d=J[0].offsetTop+(b.y-y.scrollMousePos.y),d<ma?d=ma:d+J[0].offsetHeight>za&&(d=za-J[0].offsetHeight),J.css("top",d+"px"),y.scrollMousePos=b,Qa=d-ma,a.scrollPos.y=Math.floor(Qa*Ra*S),newIndex=0<S?Math.floor(a.scrollPos.y/S):0,newIndex+A-1>a.currentList.length&&(newIndex=a.currentList.length-A+1,newIndex+=5),0>newIndex&&(newIndex=0),newIndex!==B&&(B=newIndex,a.updateView()),a.callScrollPosChanged())});angular.element(g).bind("mousedown",function(b){a.removeDropDownList();a.closeEditor(K);a.closeFilterWindow();k()});angular.element(g).bind("mouseup",function(b){kb(!0);da&&da.remove();ba=!1;Ta=-1;ga="none";fb=eb=0;V=!1;n.css("cursor","default");a.dropMark();ca&&a.updateView();ya();y.scrollMousePos=null;ca=Na=!1;n.css("cursor","default")});var gb=!1,na=0,Ua=null,hb=.5;a.isScrollBarVisible=function(a){switch(a){case "horizontal":return O;case "vertical":return E}return O&&E};a.scrollPos={x:0,y:0};a.getScrollPos=function(){return a.scrollPos};a.setScrollPos=function(b){if(b){0>b.x&&(b.x=0);b.x>R.x&&(b.x=R.x);0>b.y&&(b.y=0);b.y>R.y&&(b.y=R.y);a.scrollPos=b;Qa=Math.floor(a.scrollPos.y/(S*Ra));b=0;var c=ma+Qa;b=!1!==a.options.rtl?Math.floor(a.scrollPos.x/Ia)-(sa-G[0].offsetWidth-la):Math.floor(a.scrollPos.x/Ia)+la;O&&G&&G.css("left",b+"px");E&&J&&J.css("top",c+"px");Eb();Bb();a.callScrollPosChanged()}};var Ma=function(b,c,d){gb||(a.updateFocus(),na=0,gb=!0,Ua=l(function(){var d=c,e=a.getScrollPos();d||(0===na&&(na=5),na+=5+Ra,hb+=.5,d=na+=Math.floor(hb));e.y=b?e.y+d:e.y-d;a.setScrollPos(e);(0>=e.y||a.getScrollPos().y<e.y)&&ya()},d?d:100))},ya=function(){Ua&&(l.cancel(Ua),Ua=null);gb=!1;na=0};a.cancelScrollTimer=function(){ya()};a.scrollTo=function(b,c){if(b){var d=a.getRowCurrentIndex(b);if(a.isRowIndexInRange(d)){var e=0,e=d;switch(c){case "center":e=Math.floor(ja/2)-1;e=d>e?d-e:0;break;case "bottom":e=ja-2,a.options.showHeader&&e--,a.options.showFooter&&e--,e=d>e?d-e:0}a.setScrollPos({x:a.scrollPos.x,y:e*S})}}};var Eb=function(){var b=a.scrollPos.x;0>b&&(b=0);b>R.x&&(b=R.x);b*=-1;!1!==a.options.rtl?(I&&I.css("right",b+"px"),W&&W.css("right",b+"px"),D&&D.css("right",b+"px")):(I&&I.css("left",b+"px"),W&&W.css("left",b+"px"),D&&D.css("left",b+"px"))},Bb=function(b){if(!(0==b&&0>=S)){newIndex=0<S?Math.floor(a.scrollPos.y/S):0;a.scrollPos.y==R.y&&newIndex--;if(a.currentList.length>=A&&newIndex+A-1>a.currentList.length){newIndex=a.currentList.length-A+1;var c=a.getRowElems();c&&0<c.length&&(c=angular.element(c[c.length-1]),c[0].offsetTop+c[0].offsetHeight>n[0].clientHeight-(Z+ia)&&newIndex++)}0>newIndex&&(newIndex=0);newIndex!=B&&(B=newIndex,0!=b&&a.updateView(!0))}};n.bind("scroll",function(a){n[0].scrollTop=0;n[0].scrollLeft=0});n.bind("mousewheel",function(b){b.preventDefault();if(E){document.activeElement&&document.activeElement.blur();a.removeDropDownList();a.closeEditor(K);a.closeFilterWindow();k();var c=a.hoverRow;a.hoverRow=null;a.refresh(c);c=0;b.wheelDelta?c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail)):b.originalEvent&&(c=Math.max(-1,Math.min(1,b.originalEvent.wheelDelta||-b.originalEvent.detail)));a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(n[0].clientHeight/4)*c*-1})}});y=this;this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var b;b="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";b+=a[1]+a[4]+a[2]+a[0]+a[3];return b+="</div>"};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(y.tpar));this.tmp=300;this.twp=200*tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",n[0].scrollTop+"px"),this.$tw.css("left",n[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",n[0].scrollTop+"px"),this.$tw.css("left",n[0].scrollLeft+"px"))};this.s1t=function(a){this.trlTime=d(function(){y.trActive||(y.trCount=0,y.trActive=!0,y.trId=l(function(){y.animTr()},1E3))},a)};this.s2t=function(){this.trId&&(l.clear(this.trId),this.trId=null);this.trlTime&&(d.cancel(this.trlTime),this.trlTime=null);this.trActive=!1;this.$tw.remove()};n.append(this.$tw);this.s1t(this.twp);angular.isDefined(f.options)?a.updateOptions(f.options):(0==f.allowAnimation&&(a.options.allowAnimation=f.allowAnimation),0==f.allowCellFocus&&(a.options.allowCellFocus=f.allowCellFocus),1==f.allowColumnReorder&&(a.options.allowColumnReorder=f.allowColumnReorder),angular.isDefined(f.controlStyle)&&a.updateControlStyle(f.controlStyle),1==f.allowDrag&&(a.options.allowDrag=f.allowDrag),0==f.allowDrop&&(a.options.allowDrop=f.allowDrop),1==f.allowFilter&&(a.options.allowFilter=f.allowFilter),0==f.allowFocus&&(a.options.allowFocus=f.allowFocus),0==f.autoExpand&&(a.options.autoExpand=f.autoExpand),angular.isDefined(f.animationSpeed)&&200!==f.animationSpeed&&(a.options.animationSpeed=f.animationSpeed),angular.isDefined(f.editorSettings)&&a.updateEditorSettings(f.editorSettings),angular.isDefined(f.expandingColumnIndex)&&(a.options.expandColIndex=f.expandingColumnIndex),angular.isDefined(f.fields)&&(a.updateDataFields(f.fields),a.updateData()),1==f.fillSpace&&(a.options.fillSpace=f.fillSpace),angular.isDefined(f.gridLines)&&(a.options.gridLines=f.gridLines),1==f.hoverSelection&&(a.options.hoverSelection=f.hoverSelection),angular.isDefined(f.rowIcon)&&(a.options.rowIcon=f.rowIcon),angular.isDefined(f.labelEdit)&&(a.options.labelEdit=f.labelEdit),1==f.rtl&&(a.options.rtl=f.rtl),angular.isDefined(f.selectedIndex)&&(a.options.selectedIndex=f.selectedIndex),angular.isDefined(f.selectedRow)&&(a.options.selectedRow=f.selectedRow),angular.isDefined(f.selectionMode)&&(a.options.selectionMode=f.selectionMode),0==f.showFooter&&(a.options.showFooter=f.showFooter),0==f.showHeader&&(a.options.showHeader=f.showHeader),0==f.showIcons&&(a.options.showIcons=f.showIcons),angular.isDefined(f.sorting)&&(a.options.sorting=f.sorting));a.updateLayout()}}}]);