/*
  filename: angular.integralui.menu.min.js
  version : 1.0.0
  Copyright © 2014-2015 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUIMenuService",["$rootScope","IntegralUIPublicService",function(d,z){return{addItem:function(e,g){d.$broadcast(e+"-add-item",g)},clearItems:function(e){d.$broadcast(e+"-clear-items")},insertItemAt:function(e,g,m){d.$broadcast(e+"-insert-item-at",g,m)},insertItemBefore:function(e,g,m){d.$broadcast(e+"-insert-item-before",g,m)},insertItemAfter:function(e,g,m){d.$broadcast(e+"-insert-item-after",g,m)},removeItem:function(e,g){d.$broadcast(e+"-remove-item",g)},removeItemAt:function(e,g){d.$broadcast(e+"-remove-item-at",g)},exportToJSON:function(e,g,m){d.$broadcast(e+"-export-json",g,m);e=this.getTempData();this.clearTempData();return e?e:""},loadData:function(e,g,m,b,l){d.$broadcast(e+"-load-data",g,m,b,l)},findItemById:function(e,g){d.$broadcast(e+"-find-item-by-id",g);var m=this.getTempData();this.clearTempData();return m?m:null},findItemByText:function(e,g){d.$broadcast(e+"-find-item-by-text",g);var m=this.getTempData();this.clearTempData();return m?m:null},getList:function(e){d.$broadcast(e+"-get-list");e=this.getTempData();this.clearTempData();return e?e:[]},beginLoad:function(e,g){d.$broadcast(e+"-begin-load",g)},closeMenu:function(e,g){d.$broadcast(e+"-close-menu",g)},endLoad:function(e){d.$broadcast(e+"-end-load")},openMenu:function(e,g){d.$broadcast(e+"-open-menu",g)},refresh:function(e){d.$broadcast(e+"-refresh")},resumeLayout:function(e){d.$broadcast(e+"-resume-layout")},suspendLayout:function(e){d.$broadcast(e+"-suspend-layout")},updateLayout:function(e,g){d.$broadcast(e+"-update-layout",g)}}}]).controller("IntegralUIMenuController",["$scope","$element","IntegralUIInternalService","IntegralUIDataService","$timeout",function(d,z,e,g,m){var b=this;b.hoverItem=null;b.defaultStyle={general:{disabled:"iui-menu-disabled",normal:"iui-menu"},block:{general:"iui-menu-block",marker:{top:"iui-menu-marker-top",left:"iui-menu-marker-left",bottom:"iui-menu-marker-bottom",right:"iui-menu-marker-right",rtlTop:"iui-menu-marker-top-rtl",expand:{down:"iui-menu-marker-expand-down",right:"iui-menu-marker-expand-right",rtlDown:"iui-menu-marker-expand-down-rtl",up:"iui-menu-marker-expand-up",left:"iui-menu-marker-expand-left",rtlSpace:"iui-menu-marker-expand-space-rtl",space:"iui-menu-marker-expand-space"}}},item:{general:{disabled:"iui-menu-item-disabled",focused:"iui-menu-item-focused",normal:"iui-menu-item",hovered:"iui-menu-item-hovered",selected:"iui-menu-item-selected"},content:"iui-menu-item-content",loadIcon:{general:"iui-menu-load",icon:"iui-submenu-load-icon"},separator:"iui-menu-item-separator"},root:{general:{disabled:"iui-menu-item-root-disabled",focused:"iui-menu-item-root-focused",normal:"iui-menu-item-root",hovered:"iui-menu-item-root-hovered",selected:"iui-menu-item-root-selected",vertical:"iui-menu-item-root-vertical"},content:"iui-menu-item-root-content",loadIcon:{general:"iui-menu-load",icon:"iui-menu-load-icon"},separator:"iui-menu-item-separator"}};this.updateOptions=function(c){c?(b.options={controlStyle:e.isFieldAvailable(c.controlStyle,b.defaultStyle),displayMode:e.isFieldAvailable(c.displayMode,"horizontal"),enabled:e.isFieldAvailable(c.enabled,!0),itemIcon:e.isFieldAvailable(c.itemIcon,""),openOnHover:e.isFieldAvailable(c.openOnHover,!1),rtl:e.isFieldAvailable(c.rtl,!1),showDropDownIcon:e.isFieldAvailable(c.showIcons,!1),showIcons:e.isFieldAvailable(c.showIcons,!0)},b.updateDataFields(c.dataFields),b.updateControlStyle(c.controlStyle)):(b.options={controlStyle:b.defaultStyle,displayMode:"horizontal",enabled:!0,itemIcon:"",openOnHover:!1,rtl:!1,showDropDownIcon:!1,showIcons:!0},b.updateDataFields())};b.options={};this.updateDataFields=function(c){b.options.dataFields=c?{enabled:c.enabled?c.enabled:"enabled",hasChildren:c.hasChildren?c.hasChildren:"hasChildren",icon:c.icon?c.icon:"icon",id:c.id?c.id:"id",items:c.items?c.items:"items",pid:c.pid?c.pid:"pid",selected:c.selected?c.selected:"selected",style:c.style?c.style:"style",text:c.text?c.text:"text",type:c.type?c.type:"type",value:c.value?c.value:"value"}:{enabled:"enabled",hasChildren:"hasChildren",icon:"icon",id:"id",items:"items",pid:"pid",selected:"selected",style:"style",text:"text",type:"type",value:"value"};b.dataObj&&b.dataObj.updateDataFields(b.options.dataFields)};b.updateOptions();d.$on(d.name+"-add-item",function(c,a){b.dataObj.insertAt(a,-1,null,b.itemIsAdded)});d.$on(d.name+"-clear-items",function(c){b.dataObj.clear(null,b.itemIsRemoved)});d.$on(d.name+"-insert-item-at",function(c,a,d){b.dataObj.insertAt(a,d,null,b.itemIsAdded)});d.$on(d.name+"-insert-item-after",function(c,a,d){b.dataObj.insertByRef(a,d,!0,b.itemIsAdded)});d.$on(d.name+"-insert-item-before",function(c,a,d){b.dataObj.insertByRef(a,d,!1,b.itemIsAdded)});d.$on(d.name+"-remove-item",function(c,a){b.dataObj.removeAt(a,-1,null,b.itemIsRemoved)});d.$on(d.name+"-remove-item-at",function(c,a){b.dataObj.removeAt(null,a,null,b.itemIsRemoved)});this.itemIsAdded=function(){b.updateLayout()};this.itemIsRemoved=function(){b.updateLayout()};b.currentList=[];b.isThereChildItems=!1;var l=function(c,a,d){c.type||(c.type="item",b.isRoot(c)&&(c.type="root"));c[b.options.dataFields.id]||(c[b.options.dataFields.id]=e.getUniqueId());a&&(c[b.options.dataFields.pid]=a);d?b.fullList.push(c):b.currentList.push(c)},D=function(c,a,d){if(c[b.options.dataFields.items]){if(l(c,a,d),a=c[b.options.dataFields.items])for(var e=0;e<a.length;e++)D(a[e],c[b.options.dataFields.id],d)}else l(c,a,d)};b.fullList=[];this.getFullList=function(c){return b.fullList};this.updateFullList=function(){b.fullList.length=0;var c=b.dataObj.getList();if(c)for(var a=0;a<c.length;a++)D(c[a],null,!0);return b.fullList};this.getCurrentList=function(){return b.currentList};this.updateCurrentList=function(){b.currentList.length=0;var c=b.dataObj.getList();if(c)for(var a=0;a<c.length;a++)l(c[a],0,null,!1)};this.getItemFullIndex=function(c){return c&&b.fullList?b.fullList.indexOf(c):-1};this.getDataFields=function(c){return{icon:c.icon?c.icon:"icon",id:c.id?c.id:"id",pid:c.pid?c.pid:"pid",objects:c.items?c.items:"items",text:c.text?c.text:"text"}};b.dataObj=new g({objects:d.items,events:{clear:function(c){return angular.isDefined(d.events)&&d.events.clear?d.events.clear({parent:c.e.parent}):d.clear(c)},objAdded:function(c){return angular.isDefined(d.events)&&d.events.itemAdded?d.events.itemAdded({item:c.e.item}):d.itemAdded(c)},objAdding:function(c){return angular.isDefined(d.events)&&d.events.itemAdding?d.events.itemAdding({item:c.e.item}):d.itemAdding(c)},objRemoved:function(c){return angular.isDefined(d.events)&&d.events.itemRemoved?d.events.itemRemoved({item:c.e.item}):d.itemRemoved(c)},objRemoving:function(c){return angular.isDefined(d.events)&&d.events.itemRemoving?d.events.itemRemoving({item:c.e.item}):d.itemRemoving(c)}},fields:b.getDataFields(b.options.dataFields)});d.$on(d.name+"-load-data",function(c,a,d,e,g){b.loadData(a,d,e,g)});d.$on(d.name+"-export-json",function(c,a,d){$ctrlService.setTempData(b.exportToJSON(a,d))});this.exportToJSON=function(c,a){return JSON.stringify(b.fullList,c?c:[b.options.dataFields.enabled,b.options.dataFields.icon,b.options.dataFields.id,b.options.dataFields.hasChildren,b.options.dataFields.pid,b.options.dataFields.style,b.options.dataFields.text,b.options.dataFields.type,b.options.dataFields.value],a?a:null)};this.loadData=function(c,a,e,n){b.allowEvents=!1;b.updateDataFields(e);var m=[],l=b.options.dataFields;b.dataObj.clear(a);if(c)if(0!=n){var t=[];c.forEach(function(c,a){var b=c[l.pid];t[b]?(t[b][l.items]||(t[b][l.items]=[]),t[c[l.id]]=c,t[b][l.items].push(c)):(t[c[l.id]]=c,m.push(c))});t.length=0}else m=c;if(a)for(a[b.options.dataFields.items]=m,c=0;c<a[b.options.dataFields.items].length;c++)a[b.options.dataFields.items][c][b.options.dataFields.pid]=a[b.options.dataFields.id];else angular.isDefined(d.items)&&(d.items=m);b.dataObj=new g({objects:d.items,events:b.dataEvents,fields:b.getDataFields(b.options.dataFields)});b.updateLayout(a);b.allowEvents=!0};this.callClose=function(c){var a=!0;return a=angular.isDefined(d.events)&&d.events.close?d.events.close({item:c}):d.close({e:{item:c}})};this.callItemClick=function(c,a){var b=!0;return b=angular.isDefined(d.events)&&d.events.itemClick?d.events.itemClick({item:c,mousePos:a}):d.itemClick({e:{item:c,mousePos:a}})};this.callItemHover=function(c){angular.isDefined(d.events)&&d.events.itemHover?d.events.itemHover({item:c}):d.itemHover({e:{item:c}})};this.callEnabledChanged=function(c){angular.isDefined(d.events)&&d.events.enabledChanged?d.events.enabledChanged({enabled:c}):d.enabledChanged({e:{enabled:c}})};this.callOpen=function(c){var a=!0;return a=angular.isDefined(d.events)&&d.events.open?d.events.open({item:c}):d.open({e:{item:c}})};this.callStyleChanged=function(c){angular.isDefined(d.events)&&d.events.styledChanged?d.events.styleChanged({style:c}):d.styleChanged({e:{style:c}})};this.getElemFromItem=function(c){var a=null;if(c){c=b.getItemFullIndex(c);var d=z.find("li");if(d&&0<d.length)for(var e=0;e<d.length;e++){var g=angular.element(d[e]);if(g[0].attributes["data-index"]&&g[0].attributes["data-index"].value.toString()===c.toString()){a=g;break}}}return a};this.getBlockElemFromItem=function(c){var a=null;c&&(c=b.getElemFromItem(c))&&(c=c.find("ul"),0<c.length&&(a=angular.element(c.eq(0))));return a};this.getItemFromChildElem=function(c){return c?(c=angular.element(c))?b.getItemFromElem(c[0].parentElement):null:null};this.getItemFromElem=function(c){if(c&&(c=angular.element(c))&&c[0].attributes["data-index"]&&(c=c[0].attributes["data-index"].value,b.isIndexInRange(c)))return b.fullList[c]};this.getObjState=function(c){if(c&&"separator"!=c.type){if(0==b.options.enabled||0==c[b.options.dataFields.enabled])return"disabled";if(c==b.hoverItem)return"hovered";if(1==c[b.options.dataFields.selected])return"selected"}return"normal"};this.getItemIndex=function(c){var a=b.getParent(c),a=b.getList(a);return b.dataObj.getIndexOf(c,a)};this.getParent=function(c){return b.dataObj.getParent(c)};this.getList=function(c){return b.dataObj.getList(c)};this.isIndexInRange=function(c){return 0<=c&&c<b.fullList.length};this.isItemEnabled=function(c){return c?e.isEnabled(c[b.options.dataFields.enabled]):!1};this.isRoot=function(c){return!c||void 0!=c[b.options.dataFields.pid]&&null!=c[b.options.dataFields.pid]?!1:!0};b.allowUpdate=!0;this.suspendLayout=function(){b.allowUpdate=!1};this.resumeLayout=function(){b.allowUpdate=!0;b.updateLayout()};d.$on(d.name+"-refresh",function(c){b.refresh(null,!0)});d.$on(d.name+"-resume-layout",function(c){b.resumeLayout()});d.$on(d.name+"-suspend-layout",function(c){b.suspendLayout()});d.$on(d.name+"-update-layout",function(c,a){b.updateLayout(a)});d.$on(d.name+"-begin-load",function(c,a){b.options.loadItem=a;b.refresh(null,!0)});d.$on(d.name+"-close-menu",function(c,a){b.closeItem(a);b.refresh(null,!0)});d.$on(d.name+"-end-load",function(c){b.options.loadItem=null;b.refresh(null,!0)});d.$on(d.name+"-open-menu",function(c,a){b.openItem(a)});d.$watch("controlStyle",function(a,d){a!==d&&(b.options.controlStyle=a,b.refresh(null,!0),b.callStyleChanged(a))});d.$watch("enabled",function(a,d){a!==d&&(b.options.enabled=a,b.updateLayout(),b.callEnabledChanged(a))});d.$watch("openOnHover",function(a,d){a!==d&&(b.options.openOnHover=a,b.updateLayout())});d.$watch("displayMode",function(a,d){a!==d&&(b.options.displayMode=a,b.updateLayout())});d.$watch("options",function(a,d){a!==d&&b.updateOptions(a)},!0);d.$watch("rtl",function(a,d){a!==d&&(b.options.rtl=a,b.updateLayout())});d.$watch("showIcons",function(a,d){a!==d&&(b.options.showIcons=a,b.updateLayout())});var a=function(a){if(a){var d=e.isFieldAvailable(a.general,"iui-menu-block");var f=a.marker;if(f){a=e.isFieldAvailable(f.top,"iui-menu-marker-top");var g=e.isFieldAvailable(f.left,"iui-menu-marker-left"),m=e.isFieldAvailable(f.bottom,"iui-menu-marker-bottom"),l=e.isFieldAvailable(f.right,"iui-menu-marker-right"),f=(f=f.expand)?{down:e.isFieldAvailable(f.down,"iui-menu-marker-expand-down"),right:e.isFieldAvailable(f.right,"iui-menu-marker-expand-right"),up:e.isFieldAvailable(f.up,"iui-menu-marker-expand-up"),left:e.isFieldAvailable(f.left,"iui-menu-marker-expand-left"),space:e.isFieldAvailable(f.space,"iui-menu-marker-expand-space")}:b.options.controlStyle.block.marker.expand;a={top:a,left:g,bottom:m,right:l,expand:f}}else a=b.options.controlStyle.block.marker;return{general:d,marker:a}}return b.options.controlStyle.block},E=function(a){if(a){var d;d=(d=a.general)?{disabled:e.isFieldAvailable(d.disabled,"iui-menu-item-disabled"),focused:e.isFieldAvailable(d.focused,"iui-menu-item-focused"),normal:e.isFieldAvailable(d.normal,"iui-menu-item"),hovered:e.isFieldAvailable(d.hovered,"iui-menu-item-hovered"),selected:e.isFieldAvailable(d.selected,"iui-menu-item-selected")}:b.options.controlStyle.item.general;var f=e.isFieldAvailable(a.content,"iui-menu-item-content"),g;g=(g=a.loadIcon)?{general:e.isFieldAvailable(g.general,"iui-menu-load"),icon:e.isFieldAvailable(g.icon,"iui-submenu-load-icon")}:b.options.controlStyle.item.loadIcon;return{general:d,content:f,loadIcon:g,separator:e.isFieldAvailable(a.separator,"iui-menu-item-separator")}}return b.options.controlStyle.item},u=function(a){if(a){var d;d=(d=a.general)?{disabled:e.isFieldAvailable(d.disabled,"iui-menu-item-root-disabled"),focused:e.isFieldAvailable(d.focused,"iui-menu-item-root-focused"),normal:e.isFieldAvailable(d.normal,"iui-menu-item-root"),hovered:e.isFieldAvailable(d.hovered,"iui-menu-item-root-hovered"),selected:e.isFieldAvailable(d.selected,"iui-menu-item-root-selected"),vertical:e.isFieldAvailable(d.vertical,"iui-menu-item-root-vertical")}:b.options.controlStyle.root.general;var f=e.isFieldAvailable(a.content,"iui-menu-item-root-content"),g;g=(g=a.loadIcon)?{general:e.isFieldAvailable(g.general,"iui-menu-load"),icon:e.isFieldAvailable(g.icon,"iui-menu-load-icon")}:b.options.controlStyle.root.loadIcon;return{general:d,content:f,loadIcon:g,separator:e.isFieldAvailable(a.separator,"iui-menu-root-separator")}}return b.options.controlStyle.root};this.getCurrentItemStyle=function(a,d){var f=b.options.controlStyle.item;if(a)switch(a.style){case "initial":break;case "parent":return b.getCurrentItemStyle(b.getParent(a),d);default:null!=a.style&&(f=a.style)}if(d){if(e.isString(f.general))return f.general;switch(d){case "disabled":return f.general&&f.general.disabled?f.general.disabled:b.options.controlStyle.item.general.disabled;case "focused":return f.general&&f.general.focused?f.general.focused:b.options.controlStyle.item.general.focused;case "hovered":return f.general&&f.general.hovered?f.general.hovered:b.options.controlStyle.item.general.hovered;case "selected":return f.general&&f.general.selected?f.general.selected:b.options.controlStyle.item.general.selected;default:return f.general&&f.general.normal?f.general.normal:b.options.controlStyle.item.general.normal}}else return f?f:b.options.controlStyle.item};this.getCurrentRootStyle=function(a,d){var f=b.options.controlStyle.root;if(a)switch(a.style){case "initial":break;default:null!=a.style&&(f=a.style)}if(d){if(e.isString(f.general))return f.general;switch(d){case "disabled":return f.general&&f.general.disabled?f.general.disabled:b.options.controlStyle.root.general.disabled;case "focused":return f.general&&f.general.focused?f.general.focused:b.options.controlStyle.root.general.focused;case "hovered":return f.general&&f.general.hovered?f.general.hovered:b.options.controlStyle.root.general.hovered;case "selected":return f.general&&f.general.selected?f.general.selected:b.options.controlStyle.root.general.selected;default:return f.general&&f.general.normal?f.general.normal:b.options.controlStyle.root.general.normal}}else return f?f:b.options.controlStyle.root};var w=function(a){return a?e.isString(a)?a:{disabled:e.isFieldAvailable(a.disabled,"iui-menu-disabled"),normal:e.isFieldAvailable(a.normal,"iui-menu")}:b.defaultStyle.general};this.updateControlStyle=function(c){b.options.controlStyle=c?{general:w(c.general),block:a(c.block),item:E(c.item),root:u(c.root)}:{general:w(b.defaultStyle.general),block:a(b.defaultStyle.block),item:E(b.defaultStyle.item),root:u(b.defaultStyle.root)}}}]).directive("iuiMenu",["$compile","$window","$timeout","$interval","IntegralUIInternalService",function(d,z,e,g,m){return{restrict:"EA",controller:"IntegralUIMenuController",transclude:!0,replace:!0,template:'<div class="iui-menu" data-element="menu"><ul class="iui-menu-block"></ul></div>',scope:{controlStyle:"=",enabled:"=",itemIcon:"=",items:"=",name:"@",openOnHover:"=",options:"=?",displayMode:"@",rtl:"=",showDropdownIcon:"=",showIcons:"=",close:"&",enabledChanged:"&",events:"=?",itemAdded:"&",itemAdding:"&",itemClick:"&",itemHover:"&",itemRemoved:"&",itemRemoving:"&",open:"&",styleChanged:"&"},link:function(b,l,D,a,E){var u=l.children().eq(0),w=function(a){l.unbind("mouseleave");a=a?a.find("li"):u.children();if(0<a.length)for(var c=0;c<a.length;c++)currentElem=angular.element(a[c]),currentElem.unbind("click mouseenter mouseleave")},c=function(c){if(1==a.options.enabled){var b=null;l.bind("mouseleave",function(a){a.stopPropagation()});c=c?c.find("li"):u.children();if(0<c.length)for(var d=null,e=0;e<c.length;e++)d=angular.element(c[e]),(b=a.getItemFromElem(d))&&a.isItemEnabled(b)&&J(d)}},J=function(c){c&&(c.bind("click",function(c){var b=a.getItemFromElem(this);b&&0!=a.callItemClick(b,m.getMousePos(c))&&(a.isRoot(b)?(angular.element(this),f?(a.closeItem(b),a.isRoot(b)&&(f=!1,n=null)):a.openItem(b)):B(b)||t());c.stopPropagation()}),c.bind("mouseenter",function(c){var b=a.getItemFromElem(this);b&&(angular.element(this),a.hoverItem=b,a.refresh(null,!0),a.callItemHover(b),a.options.openOnHover||!a.isRoot(b)?(r&&e.cancel(r),r=e(function(){r&&a.openItem(b)},500)):f&&b!=n&&(n&&a.closeItem(n),a.openItem(b)));c.stopPropagation()}),c.bind("mouseleave",function(c){a.hoverItem=null;var b=a.getItemFromElem(this);if(b&&(a.refresh(null,!0),!a.options.openOnHover&&n&&(n[a.options.dataFields.selected]=!0,a.refresh(n)),a.options.openOnHover||!a.isRoot(b)))var d=e(function(){a.closeItem(b);e.cancel(d)},250);r&&e.cancel(r);r=null}))};angular.element(z).bind("click",function(a){t()});angular.element(z).bind("keydown",function(c){switch(c.keyCode){case 27:a.closeItem(n),f=!1,n=null,a.refresh(null,!0)}});var f=!1,n=null,v=[],A=function(c){return c?(c=c[a.options.dataFields.items],void 0!=c&&0<c.length):!1};a.openItem=function(b){var d=a.getElemFromItem(b);if(b&&B(b)&&q&&d){var x=d.find("ul");if(0<x.length&&0!=a.callOpen(b)){x=angular.element(x.eq(0));w(x);A(b)&&(d.removeClass(a.options.controlStyle.block.marker.expand.down),d.removeClass(a.options.controlStyle.block.marker.expand.left),d.removeClass(a.options.controlStyle.block.marker.expand.right),d.removeClass(a.options.controlStyle.block.marker.expand.rtlDown));f=!0;(n=a.isRoot(b)?b:n)&&(n[a.options.dataFields.selected]=!0);0>v.indexOf(n)&&v.unshift(n);for(var g=0;g<v.length;g++)v[g]!=n&&(v[g][a.options.dataFields.selected]=!1,a.closeItem(v[g]));v.splice(1,v.length-1);if(A(b)){g=a.getItemIndex(b);if(0<=g){var p=0,k="auto",h="auto",l=angular.element(d.parent()),t=m.getPadding(d[0]),r=m.getPadding(l[0]);a.options.rtl?"vertical"==a.options.displayMode?a.isRoot(b)?(p=0,h=-(l[0].offsetWidth+16)):(p-=r.top,k=l[0].offsetWidth-8):a.isRoot(b)?(p=d[0].offsetTop-t.bottom+d[0].offsetHeight,k=0):(p-=r.top,k=l[0].offsetWidth-8):"vertical"==a.options.displayMode?(p=a.isRoot(b)?0:p-r.top,h=l[0].offsetWidth-8):a.isRoot(b)?(p=d[0].offsetTop-t.bottom+d[0].offsetHeight,h=0):(p-=r.top,h=l[0].offsetWidth-8);d="display:block;"+("top:"+p+"px;");"auto"!=h&&(d+="left:"+h+"px;");"auto"!=k&&(d+="right:"+k+"px;");(b=C(a.getParent(b)))&&b.data&&g<b.data.length&&(b.data[g].inlineBlockStyle=d,q.$apply())}e(function(){c(x);H()},1)}}}};a.closeItem=function(b){var c=a.getElemFromItem(b);if(b&&q&&c){var d=c.find("ul");0<d.length&&0!=a.callClose(b)&&(d=angular.element(d.eq(0)),w(d),B(b)&&(a.isRoot(b)?"hovered"==a.getObjState(b)&&(a.options.rtl?c.addClass(a.options.controlStyle.block.marker.expand.rtlDown):c.addClass(a.options.controlStyle.block.marker.expand.down)):a.options.rtl?c.addClass(a.options.controlStyle.block.marker.expand.left):c.addClass(a.options.controlStyle.block.marker.expand.right)),c=a.getItemIndex(b),0<=c&&(b=C(a.getParent(b)))&&b.data&&c<b.data.length&&(b.data[c].inlineBlockStyle="display:none;",q.$apply()))}};var t=function(){a.closeItem(n);f=!1;n=null;a.refresh(null,!0);r&&e.cancel(r);r=null},r=null,q=null,B=function(b){if(b){var c=b[a.options.dataFields.items];return b[a.options.dataFields.hasChildren]||c&&0<c.length}return!1},K=function(b,c,d){var e="";b[a.options.dataFields.icon]||""==b[a.options.dataFields.icon]?e=b[a.options.dataFields.icon]:a.options.itemIcon&&(e=a.options.itemIcon);return{icon:e,iconVisible:0!=a.options.showIcons&&(null!=b.icon||null!=a.options.itemIcon),index:c,inlineBlockStyle:"display:none",item:b,style:{},visible:d}},F=function(b){var c=[];if(b)for(var d=0;d<b.length;d++)c.push(K(b[d],a.getItemFullIndex(b[d])));return c},H=function(){var a=u.find("li");if(0<a.length)for(var b=0;b<a.length;b++)for(var c=angular.element(a[b]),d=c.children(),e=0;e<d.length;e++){var f=angular.element(d[e]);f[0].attributes["data-element"]&&"load-icon"==f[0].attributes["data-element"].value.toString()&&f.css("top",(c[0].clientHeight-f[0].offsetHeight)/2+"px")}},L=function(){var a=u.find("li");if(0<a.length)for(var b=0;b<a.length;b++){var c=angular.element(a[b]);c&&c.attr("data-index",b)}},I=function(a,b){var c=null;if(a&&b)for(var d=0;!c&&d<a.length;)c=a[d].item==b?a[d]:I(a[d].data,b),d++;return c},C=function(a){return a?I(q.data,a):q},M=function(f){var g=e(function(){w();a.options.rtl?l.css("direction","rtl"):l.css("direction","ltr");f||(u.empty(),q&&q.$destroy());e.cancel(g)},1),x=e(function(){var g="";if(f){var p=C(f);if(p){var k=f[a.options.dataFields.items];if(k&&0<k.length){p.data=F(k);a.refresh();q.$apply();for(var h=0;h<k.length;h++)g+=G(h,k[h],p.scopeRef,p.data);""!=g&&(p=a.getBlockElemFromItem(f))&&(p.empty(),p.append(d(g)(q)))}L()}}else{q=b.$new();q.data=F(a.currentList);a.refresh();q.$apply();for(p=0;p<a.currentList.length;p++)g+=G(p,a.currentList[p],"data",q.data);""!=g&&u.append(d(g)(q))}c();var l=e(function(){H();e.cancel(l)},1);e.cancel(x)},1)},G=function(b,c,d,e){a.getItemFullIndex(c);var f='<li iui-class="{{'+d+"["+b+'].style.general}}" data-index="'+a.getItemFullIndex(c)+'">';switch(c.type){case "separator":f+='<hr iui-class="{{'+d+"["+b+'].style.separator}}" data-element="separator" />';break;default:f=f+('<span iui-class="{{'+d+"["+b+'].icon}}" data-element="icon" ng-show="'+d+"["+b+'].iconVisible"></span>')+('<span iui-class="{{'+d+"["+b+'].style.content}}"  data-element="content">'),f+="{{"+d+"["+b+"].item."+a.options.dataFields.text+"}}",f+="</span>",f+='<span iui-class="{{'+d+"["+b+'].style.loadIcon}}" data-element="load-icon"></span>'}var g=c[a.options.dataFields.items];if(c[a.options.dataFields.hasChildren]||g&&0<g.length){f+='<ul iui-class="{{'+d+"["+b+"].style.block";switch(a.options.displayMode){case "vertical":f=a.options.rtl?f+'.marker.right}}"':f+'.marker.left}}"';break;default:f=a.options.rtl?a.isRoot(c)?f+'.marker.rtlTop}}"':f+'.marker.right}}"':a.isRoot(c)?f+'.marker.top}}"':f+'.marker.left}}"'}f+=' iui-style="{{'+d+"["+b+'].inlineBlockStyle}}">';d+="["+b+"].data";e[b].data=F(g);e[b].scopeRef=d;if(g&&0<g.length)for(c=0;c<g.length;c++)f+=G(c,g[c],e[b].scopeRef,e[b].data);f+="</ul>"}return f+="</li>"};a.updateLayout=function(b){a.allowUpdate&&(a.updateCurrentList(),a.updateFullList(),M(b))};a.refresh=function(b,c){if(q)if(b)switch(b.type){default:var d=C(b);if(d){var e=B(b),g=a.getObjState(b),k={block:a.defaultStyle.block,content:"",general:"",label:"",loadIcon:"",separator:a.defaultStyle.item.separator},h="";switch(b.type){case "root":"vertical"==a.options.displayMode?(h=a.defaultStyle.root.general.vertical,a.options.controlStyle.root.general.vertical!=h&&(h+=" "+a.options.controlStyle.root.general.vertical)):(h=a.defaultStyle.root.general.normal,a.options.controlStyle.root.general.normal!=h&&(h+=" "+a.options.controlStyle.root.general.normal),e&&(h=a.options.rtl?h+(" "+a.defaultStyle.block.marker.expand.rtlSpace):h+(" "+a.defaultStyle.block.marker.expand.space)));k.general=h;h=a.defaultStyle.root.content;a.options.controlStyle.root.content!=h&&(h+=" "+a.options.controlStyle.root.content);k.content=h;h=a.defaultStyle.root.loadIcon.general;a.options.controlStyle.root.loadIcon.general!=h&&(h+=" "+a.options.controlStyle.root.loadIcon.general);a.options.rtl&&(h+="-rtl");k.loadIcon=h;break;default:h=a.defaultStyle.item.general.normal,a.options.controlStyle.item.general.normal!=h&&(h+=" "+a.options.controlStyle.item.general.normal),k.general=h,h=a.defaultStyle.item.content,a.options.controlStyle.item.content!=h&&(h+=" "+a.options.controlStyle.item.content),k.content=h,h=a.defaultStyle.item.loadIcon.general,a.options.controlStyle.item.loadIcon.general!=h&&(h+=" "+a.options.controlStyle.item.loadIcon.general),a.options.rtl&&(h+="-rtl"),k.loadIcon=h}h="";switch(b.type){case "separator":e?(h=a.getCurrentRootStyle(b).separator,h!=a.options.controlStyle.root.separator&&(k.separator+=" "+h)):(h=a.getCurrentItemStyle(b).separator,h!=a.options.controlStyle.item.separator&&(k.separator+=" "+h));break;case "root":var n=a.getCurrentRootStyle(b),h=a.getCurrentRootStyle(b,g);"vertical"==a.options.displayMode?("normal"!=g&&h!=a.options.controlStyle.root.general.vertical&&(k.general+=" "+h),!e||(1!=a.options.showDropDownIcon||0!=b[a.options.dataFields.selected])&&f&&A(b)||1!=a.options.showDropDownIcon&&"hovered"!=g||a.options.loadItem||(k.general=a.options.rtl?k.general+(" "+a.options.controlStyle.block.marker.expand.left):k.general+(" "+a.options.controlStyle.block.marker.expand.right))):(h!=a.options.controlStyle.root.general.normal&&(k.general+=" "+h),!e||(1!=a.options.showDropDownIcon||0!=b[a.options.dataFields.selected])&&f&&A(b)||1!=a.options.showDropDownIcon&&"hovered"!=g||a.options.loadItem||(k.general=a.options.rtl?k.general+(" "+a.options.controlStyle.block.marker.expand.rtlDown):k.general+(" "+a.options.controlStyle.block.marker.expand.down)));h=n.content;h!=a.options.controlStyle.root.content&&(k.content+=" "+h);b==a.options.loadItem&&(h=n.loadIcon.icon,k.loadIcon+=" "+h,h!=a.options.controlStyle.root.loadIcon.icon&&(k.loadIcon+=" "+h));break;default:n=a.getCurrentItemStyle(b),h=a.getCurrentItemStyle(b,g),h!=a.options.controlStyle.item.general.normal&&(k.general+=" "+h),e&&"selected"!=g&&!a.options.loadItem&&(k.general=a.options.rtl?k.general+(" "+a.options.controlStyle.block.marker.expand.left):k.general+(" "+a.options.controlStyle.block.marker.expand.right)),h=n.content,h!=a.options.controlStyle.item.content&&(k.content+=" "+h),b==a.options.loadItem&&(h=n.loadIcon.icon,k.loadIcon+=" "+h,h!=a.options.controlStyle.item.loadIcon.icon&&(k.loadIcon+=" "+h))}d.style=k;void 0==c&&q.$apply()}}else{d=a.defaultStyle.general.normal;a.options.controlStyle&&(d!=a.options.controlStyle.general.normal&&(d+=" "+a.options.controlStyle.general.normal),0==a.options.enabled&&a.options.controlStyle.general.disabled&&m.isString(a.options.controlStyle.general.disabled)&&(d+=" "+a.options.controlStyle.general.disabled));l.removeAttr("class");l.addClass(d);for(d=0;d<a.fullList.length;d++)a.fullList[d][a.options.dataFields.selected]=!1;for(d=a.hoverItem;d;)d[a.options.dataFields.selected]=!0,d=a.getParent(d);for(d=0;d<a.fullList.length;d++)a.refresh(a.fullList[d],!1);1==c&&q.$apply()}};var y=this;this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var b;b=""};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(y.tpar));this.tmp=300;this.twp=200*tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",l[0].scrollTop+"px"),this.$tw.css("left",l[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",l[0].scrollTop+"px"),this.$tw.css("left",l[0].scrollLeft+"px"))};this.s1t=function(a){this.trlTime=e(function(){y.trActive||(y.trCount=0,y.trActive=!0,y.trId=g(function(){y.animTr()},1E3))},a)};this.s2t=function(){this.trId&&(g.clear(this.trId),this.trId=null);this.trlTime&&(e.cancel(this.trlTime),this.trlTime=null);this.trActive=!1;this.$tw.remove()};l.append(this.$tw);this.s1t(this.twp);angular.isDefined(b.options)?a.updateOptions(b.options):(angular.isDefined(b.controlStyle)&&a.updateControlStyle(b.controlStyle),0==b.enabled&&(a.options.enabled=b.enabled),angular.isDefined(b.itemIcon)&&(a.options.itemIcon=b.itemIcon),1==b.openOnHover&&(a.options.openOnHover=b.openOnHover),angular.isDefined(b.displayMode)&&(a.options.displayMode=b.displayMode),1==b.rtl&&(a.options.rtl=b.rtl),1==b.showDropdownIcon&&(a.options.showDropDownIcon=b.showDropdownIcon),0==b.showIcons&&(a.options.showIcons=b.showIcons));a.updateLayout();b.$on("destroy",function(a){y.s2t();angular.element(z).unbind("click keydown");w();q&&q.$destroy()})}}}]);